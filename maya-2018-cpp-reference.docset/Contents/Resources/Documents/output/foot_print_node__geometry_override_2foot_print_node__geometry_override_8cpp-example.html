<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
<head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="MAYAUL" name="product"><meta content="2018" name="release"><meta content="Developer" name="book"><meta content="2017-06-22" name="created"><meta content="GUID-02DEF634-1E7B-48C6-8ACD-2C934CA97887" name="topicid"><meta content="concept" name="topic-type">
<title>footPrintNode_GeometryOverride/footPrintNode_GeometryOverride.cpp</title>
<meta content="C++" name="topic-subtype"/></meta></meta></meta></meta></meta></meta></meta></head>
<body height="100%"><div class="body_content" id="body-content"><link href="cpp_ref/navtree.css" rel="stylesheet" type="text/css"><link href="cpp_ref/doxygen.css" rel="stylesheet" type="text/css"><link href="cpp_ref/tabs.css" rel="stylesheet" type="text/css"><link href="style/adsk.cpm.css" rel="stylesheet" type="text/css"><script language="javascript">var index = 'index.html';</script><script>$(document).ready(function() { yepnope.injectJs("./scripts/ac_common.js"); });</script><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('foot_print_node__geometry_override_2foot_print_node__geometry_override_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>$("div#WidgetFloaterPanels,link[href*='microsofttranslator.com'],script[src*='microsofttranslator.com'],script[src*='bing.com']").remove();</script><script type="text/javascript">$("div#navigation,div#breadcrumbs,div#banner").attr("translate","no"); var mtLocation = ((location && location.href && location.href.indexOf('https') == 0)?'https://ssl.microsofttranslator.com':'http://www.microsofttranslator.com')+'/ajax/v3/WidgetV3.ashx?ctf=True&ui=true&settings=Manual&from=en&hidelanguages='; yepnope.injectJs(mtLocation, function() {}, { charset:'utf-8', type:'text/javascript' } );</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script><!-- begin MT -->
<div class="Dark" id="MicrosoftTranslatorWidget" style="float:right;z-index:100;color:white;background-color:#bbbbbb;height:58px;overflow:hidden"></div>
<div>
<div class="head">
<h1>footPrintNode_GeometryOverride/footPrintNode_GeometryOverride.cpp</h1>
</div>
<div id="top"><!-- Generated by Doxygen 1.8.10 -->
<div class="tabs" id="navrow1">
<ul class="tablist">
<li><a href="./index.html"><span>MainÂ Page</span></a></li>
<li><a href="./pages.html"><span>Topics</span></a></li>
<li><a href="./modules.html"><span>Modules</span></a></li>
<li><a href="./namespaces.html"><span>Namespaces</span></a></li>
<li><a href="./annotated.html"><span>Classes</span></a></li>
<li><a href="./examples.html"><span>Examples</span></a></li>
</ul>
</div>
</div><!-- top -->
<div class="ui-resizable side-nav-resizable" id="side-nav">
<div id="nav-tree">
<div id="nav-tree-contents">
<div class="sync" id="nav-sync"></div>
</div>
</div>
<div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;">
</div>
</div>
<div id="doc-content">
<div class="header">
<div class="headertitle">
<div class="title">footPrintNode_GeometryOverride/footPrintNode_GeometryOverride.cpp</div> </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//-</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">// Copyright 2015 Autodesk, Inc.  All rights reserved.</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk license agreement</span></div>
<div class="line"><span class="comment">// provided at the time of installation or download, or which otherwise</span></div>
<div class="line"><span class="comment">// accompanies this software in either electronic or hard copy form.</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">//+</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// DESCRIPTION:</span></div>
<div class="line"><span class="comment">// </span></div>
<div class="line"><span class="comment">// This plug-in demonstrates how to draw a simple mesh like foot Print in an efficient way.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This efficient way is supported in Viewport 2.0.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// For comparison, you can also reference a Maya Developer Kit sample named footPrintNode.</span></div>
<div class="line"><span class="comment">// In that sample, we draw the footPrint using the MUIDrawManager primitives in footPrintDrawOverride::addUIDrawables()</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// For comparison, you can also reference another Maya Developer Kit sample named rawfootPrintNode.</span></div>
<div class="line"><span class="comment">// In that sample, we draw the footPrint with OpenGL\DX in method rawFootPrintDrawOverride::draw().</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Note the method:</span></div>
<div class="line"><span class="comment">//   footPrint::draw() </span></div>
<div class="line"><span class="comment">// is only called in legacy default viewport to draw the foot print.</span></div>
<div class="line"><span class="comment">// while the methods: </span></div>
<div class="line"><span class="comment">//   FootPrintGeometryOverride::updateDG() </span></div>
<div class="line"><span class="comment">//   FootPrintGeometryOverride::updateRenderItems() </span></div>
<div class="line"><span class="comment">//   FootPrintGeometryOverride::populateGeometry()</span></div>
<div class="line"><span class="comment">// are only called in Viewport 2.0 to prepare and draw the foot print.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Example usage is to load the plug-in and create the node using</span></div>
<div class="line"><span class="comment">// the createNode command:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// loadPlugin footPrint_GeometryOverride;</span></div>
<div class="line"><span class="comment">// createNode footPrint_GeometryOverride;</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPxLocatorNode.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MString.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MTypeId.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPlug.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MVector.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDataBlock.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDataHandle.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MColor.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/M3dView.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnPlugin.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDistance.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnUnitAttribute.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGlobal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MEvaluationNode.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Viewport 2.0 includes</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDrawRegistry.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPxGeometryOverride.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MUserData.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDrawContext.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MShaderManager.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MHWGeometry.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MHWGeometryUtilities.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPointArray.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;unordered_map&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace</span></div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Foot Data</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordtype">float</span> sole[][3] = { {  0.00f, 0.0f, -0.70f },</div>
<div class="line">                        {  0.04f, 0.0f, -0.69f },</div>
<div class="line">                        {  0.09f, 0.0f, -0.65f },</div>
<div class="line">                        {  0.13f, 0.0f, -0.61f },</div>
<div class="line">                        {  0.16f, 0.0f, -0.54f },</div>
<div class="line">                        {  0.17f, 0.0f, -0.46f },</div>
<div class="line">                        {  0.17f, 0.0f, -0.35f },</div>
<div class="line">                        {  0.16f, 0.0f, -0.25f },</div>
<div class="line">                        {  0.15f, 0.0f, -0.14f },</div>
<div class="line">                        {  0.13f, 0.0f,  0.00f },</div>
<div class="line">                        {  0.00f, 0.0f,  0.00f },</div>
<div class="line">                        { -0.13f, 0.0f,  0.00f },</div>
<div class="line">                        { -0.15f, 0.0f, -0.14f },</div>
<div class="line">                        { -0.16f, 0.0f, -0.25f },</div>
<div class="line">                        { -0.17f, 0.0f, -0.35f },</div>
<div class="line">                        { -0.17f, 0.0f, -0.46f },</div>
<div class="line">                        { -0.16f, 0.0f, -0.54f },</div>
<div class="line">                        { -0.13f, 0.0f, -0.61f },</div>
<div class="line">                        { -0.09f, 0.0f, -0.65f },</div>
<div class="line">                        { -0.04f, 0.0f, -0.69f },</div>
<div class="line">                        { -0.00f, 0.0f, -0.70f } };</div>
<div class="line"> <span class="keywordtype">float</span> heel[][3] = { {  0.00f, 0.0f,  0.06f },</div>
<div class="line">                        {  0.13f, 0.0f,  0.06f },</div>
<div class="line">                        {  0.14f, 0.0f,  0.15f },</div>
<div class="line">                        {  0.14f, 0.0f,  0.21f },</div>
<div class="line">                        {  0.13f, 0.0f,  0.25f },</div>
<div class="line">                        {  0.11f, 0.0f,  0.28f },</div>
<div class="line">                        {  0.09f, 0.0f,  0.29f },</div>
<div class="line">                        {  0.04f, 0.0f,  0.30f },</div>
<div class="line">                        {  0.00f, 0.0f,  0.30f },</div>
<div class="line">                        { -0.04f, 0.0f,  0.30f },</div>
<div class="line">                        { -0.09f, 0.0f,  0.29f },</div>
<div class="line">                        { -0.11f, 0.0f,  0.28f },</div>
<div class="line">                        { -0.13f, 0.0f,  0.25f },</div>
<div class="line">                        { -0.14f, 0.0f,  0.21f },</div>
<div class="line">                        { -0.14f, 0.0f,  0.15f },</div>
<div class="line">                        { -0.13f, 0.0f,  0.06f },</div>
<div class="line">                        { -0.00f, 0.0f,  0.06f } };</div>
<div class="line"> <span class="keywordtype">int</span> soleCount = 21;</div>
<div class="line"> <span class="keywordtype">int</span> heelCount = 17;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Viewport 2.0 specific data</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keyword">const</span> <a name="_a0"></a><a class="code" href="./class_m_string.html">MString</a> colorParameterName_ = <span class="stringliteral">"solidColor"</span>;</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_string.html">MString</a> wireframeItemName_  = <span class="stringliteral">"footPrintLocatorWires"</span>;</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_string.html">MString</a> shadedItemName_     = <span class="stringliteral">"footPrintLocatorTriangles"</span>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Maintain a mini cache for 3d solid shaders in order to reuse the shader</span></div>
<div class="line"> <span class="comment">// instance whenever possible. This can allow Viewport 2.0 optimization e.g.</span></div>
<div class="line"> <span class="comment">// the GPU instancing system and the consolidation system to be leveraged.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keyword">struct </span>MColorHash</div>
<div class="line">    {</div>
<div class="line">        std::size_t operator()(<span class="keyword">const</span> <a name="_a1"></a><a class="code" href="./class_m_color.html">MColor</a>&amp; color)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"> </span>{</div>
<div class="line">            std::size_t seed = 0;</div>
<div class="line">            CombineHashCode(seed, color.<a name="a2"></a><a class="code" href="./class_m_color.html#a4788d82c901b9367dd5c0daff8a7616b">r</a>);</div>
<div class="line">            CombineHashCode(seed, color.<a name="a3"></a><a class="code" href="./class_m_color.html#a8cf17d727651616de6f2b79ef32170cd">g</a>);</div>
<div class="line">            CombineHashCode(seed, color.<a name="a4"></a><a class="code" href="./class_m_color.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>);</div>
<div class="line">            CombineHashCode(seed, color.<a name="a5"></a><a class="code" href="./class_m_color.html#a4aec1a5be9d9a4a394a2e49e9744286e">a</a>);</div>
<div class="line"> <span class="keywordflow">return</span> seed;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">void</span> CombineHashCode(std::size_t&amp; seed, <span class="keywordtype">float</span> v)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"> </span>{</div>
<div class="line">            std::hash&lt;float&gt; hasher;</div>
<div class="line">            seed ^= hasher(v) + 0x9e3779b9 + (seed &lt;&lt; 6) + (seed &gt;&gt; 2);</div>
<div class="line">        }</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    std::unordered_map&lt;MColor, MHWRender::MShaderInstance*, MColorHash&gt; the3dSolidShaders;</div>
<div class="line"></div>
<div class="line"> <a name="_a6"></a><a class="code" href="./class_m_h_w_render_1_1_m_shader_instance.html">MHWRender::MShaderInstance</a>* get3dSolidShader(<span class="keyword">const</span> <a class="code" href="./class_m_color.html">MColor</a>&amp; color)</div>
<div class="line">    {</div>
<div class="line"> <span class="comment">// Return the shader instance if exists.</span></div>
<div class="line"> <span class="keyword">auto</span> it = the3dSolidShaders.find(color);</div>
<div class="line"> <span class="keywordflow">if</span> (it != the3dSolidShaders.end())</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">return</span> it-&gt;second;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_h_w_render_1_1_m_shader_instance.html">MHWRender::MShaderInstance</a>* shader = NULL;</div>
<div class="line"></div>
<div class="line"> <a name="_a7"></a><a class="code" href="./class_m_h_w_render_1_1_m_renderer.html">MHWRender::MRenderer</a>* renderer = <a name="a8"></a><a class="code" href="./class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>();</div>
<div class="line"> <span class="keywordflow">if</span> (renderer)</div>
<div class="line">        {</div>
<div class="line"> <span class="keyword">const</span> <a name="_a9"></a><a class="code" href="./class_m_h_w_render_1_1_m_shader_manager.html">MHWRender::MShaderManager</a>* shaderMgr = renderer-&gt;<a name="a10"></a><a class="code" href="./class_m_h_w_render_1_1_m_renderer.html#a4603e18a1b89b798a2e4a4f36d9b5125">getShaderManager</a>();</div>
<div class="line"> <span class="keywordflow">if</span> (shaderMgr)</div>
<div class="line">            {</div>
<div class="line">                shader = shaderMgr-&gt;<a name="a11"></a><a class="code" href="./class_m_h_w_render_1_1_m_shader_manager.html#a8e4ad27d691969622af2b05d8c6213d9">getStockShader</a>(<a name="a12"></a><a class="code" href="./class_m_h_w_render_1_1_m_shader_manager.html#a1f7c5db8a3b5804c6ffce5f305bf51a8a7a0eb28b48e8f9ed6f666b52a27a45f5">MHWRender::MShaderManager::k3dSolidShader</a>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (shader)</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordtype">float</span> solidColor[] = { color.<a class="code" href="./class_m_color.html#a4788d82c901b9367dd5c0daff8a7616b">r</a>, color.<a class="code" href="./class_m_color.html#a8cf17d727651616de6f2b79ef32170cd">g</a>, color.<a class="code" href="./class_m_color.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>, 1.0f };</div>
<div class="line">            shader-&gt;<a name="a13"></a><a class="code" href="./class_m_h_w_render_1_1_m_shader_instance.html#aa17e2c9a17b86064950103066fa307ef">setParameter</a>(colorParameterName_, solidColor);</div>
<div class="line"></div>
<div class="line">            the3dSolidShaders[color] = shader;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> shader;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <a name="_a14"></a><a class="code" href="./class_m_status.html">MStatus</a> releaseShaders()</div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_h_w_render_1_1_m_renderer.html">MHWRender::MRenderer</a>* renderer = <a class="code" href="./class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>();</div>
<div class="line"> <span class="keywordflow">if</span> (renderer)</div>
<div class="line">        {</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_h_w_render_1_1_m_shader_manager.html">MHWRender::MShaderManager</a>* shaderMgr = renderer-&gt;<a class="code" href="./class_m_h_w_render_1_1_m_renderer.html#a4603e18a1b89b798a2e4a4f36d9b5125">getShaderManager</a>();</div>
<div class="line"> <span class="keywordflow">if</span> (shaderMgr)</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = the3dSolidShaders.begin(); it != the3dSolidShaders.end(); it++)</div>
<div class="line">                {</div>
<div class="line">                    shaderMgr-&gt;<a name="a15"></a><a class="code" href="./class_m_h_w_render_1_1_m_shader_manager.html#a0c7deb55edc231cbb2365b271ecd55f8">releaseShader</a>(it-&gt;second);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                the3dSolidShaders.clear();</div>
<div class="line"> <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line">    }</div>
<div class="line">} <span class="comment">// anonymous namespace</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//---------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//---------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Node implementation with standard viewport draw</span></div>
<div class="line"><span class="comment">//---------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//---------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>footPrint : <span class="keyword">public</span> <a name="_a16"></a><a class="code" href="./class_m_px_locator_node.html">MPxLocatorNode</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    footPrint();</div>
<div class="line">    ~footPrint() <span class="keyword">override</span>;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> <a name="a17"></a><a class="code" href="./class_m_px_node.html#a6e1aa1e50774080d5aee55f20ffa5503">compute</a>( <span class="keyword">const</span> <a name="_a18"></a><a class="code" href="./class_m_plug.html">MPlug</a>&amp; plug, <a name="_a19"></a><a class="code" href="./class_m_data_block.html">MDataBlock</a>&amp; data ) <span class="keyword">override</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">void</span> <a name="a20"></a><a class="code" href="./class_m_px_locator_node.html#a999efab3ad8289b53bc370aaeb7d6146">draw</a>( <a name="_a21"></a><a class="code" href="./class_m3d_view.html">M3dView</a> &amp; view, <span class="keyword">const</span> <a name="_a22"></a><a class="code" href="./class_m_dag_path.html">MDagPath</a> &amp; path,</div>
<div class="line"> <a class="code" href="./class_m3d_view.html#a1b68f8823b8e275a4b548fdd27263e8a">M3dView::DisplayStyle</a> style,</div>
<div class="line"> <a class="code" href="./class_m3d_view.html#ad9c34c5373567566950642c16a7c4bca">M3dView::DisplayStatus</a> status ) <span class="keyword">override</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">bool</span> <a name="a23"></a><a class="code" href="./class_m_px_locator_node.html#a4254418493ef1ab6847b9e5f395fa3de">isBounded</a>() <span class="keyword">const override</span>;</div>
<div class="line"> <a name="_a24"></a><a class="code" href="./class_m_bounding_box.html">MBoundingBox</a> <a name="a25"></a><a class="code" href="./class_m_px_locator_node.html#a762dab569a9d88aa731f3c7229803e1e">boundingBox</a>() <span class="keyword">const override</span>;</div>
<div class="line"></div>
<div class="line"> <a name="_a26"></a><a class="code" href="./class_m_selection_mask.html">MSelectionMask</a> <a name="a27"></a><a class="code" href="./class_m_px_locator_node.html#acedd5e97c21aacfc5f976499438c7fa8">getShapeSelectionMask</a>() <span class="keyword">const override</span>;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> <a name="a28"></a><a class="code" href="./class_m_px_node.html#ad40cff55ba4000788eda78c8b4258b3d">preEvaluation</a>(<span class="keyword">const</span> <a name="_a29"></a><a class="code" href="./class_m_d_g_context.html">MDGContext</a>&amp; context, <span class="keyword">const</span> <a name="_a30"></a><a class="code" href="./class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode) <span class="keyword">override</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keyword">static</span> <span class="keywordtype">void</span> *          creator();</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_status.html">MStatus</a>         initialize();</div>
<div class="line"></div>
<div class="line"> <span class="keyword">static</span> <a name="_a31"></a><a class="code" href="./class_m_object.html">MObject</a>         size;         <span class="comment">// The size of the foot</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> <span class="keyword">static</span> <a name="_a32"></a><a class="code" href="./class_m_type_id.html">MTypeId</a>     id;</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_string.html">MString</a>     drawDbClassification;</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_string.html">MString</a>     drawRegistrantId;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_object.html">MObject</a> footPrint::size;</div>
<div class="line"><a class="code" href="./class_m_type_id.html">MTypeId</a> footPrint::id( 0x00080033 );</div>
<div class="line"><a class="code" href="./class_m_string.html">MString</a> footPrint::drawDbClassification(<span class="stringliteral">"drawdb/geometry/light/footPrint_GeometryOverride"</span>);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> sMakeFootPrintDirLight = (getenv(<span class="stringliteral">"MAYA_FOOTPRINT_GEOMETRY_OVERRIDE_AS_DIRLIGHT"</span>) != NULL);</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="./class_m_string.html">MString</a> lightClassification(<span class="stringliteral">"light:drawdb/geometry/light/footPrint_GeometryOverride:drawdb/light/directionalLight"</span>); </div>
<div class="line"><a class="code" href="./class_m_string.html">MString</a> footPrint::drawRegistrantId(<span class="stringliteral">"FootprintNode_GeometryOverridePlugin"</span>);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> sUseLegacyDraw = (getenv(<span class="stringliteral">"MAYA_ENABLE_VP2_PLUGIN_LOCATOR_LEGACY_DRAW"</span>) != NULL);</div>
<div class="line"></div>
<div class="line">footPrint::footPrint() {}</div>
<div class="line">footPrint::~footPrint() {}</div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> footPrint::compute( <span class="keyword">const</span> <a class="code" href="./class_m_plug.html">MPlug</a>&amp; <span class="comment">/*plug*/</span>, <a class="code" href="./class_m_data_block.html">MDataBlock</a>&amp; <span class="comment">/*data*/</span> )</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">return</span> MS::kUnknownParameter;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// called by legacy default viewport</span></div>
<div class="line"><span class="keywordtype">void</span> footPrint::draw( <a class="code" href="./class_m3d_view.html">M3dView</a> &amp; view, <span class="keyword">const</span> <a class="code" href="./class_m_dag_path.html">MDagPath</a> &amp; <span class="comment">/*path*/</span>,</div>
<div class="line"> <a class="code" href="./class_m3d_view.html#a1b68f8823b8e275a4b548fdd27263e8a">M3dView::DisplayStyle</a> style,</div>
<div class="line"> <a class="code" href="./class_m3d_view.html#ad9c34c5373567566950642c16a7c4bca">M3dView::DisplayStatus</a> status )</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Get the size</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> thisNode = thisMObject();</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug( thisNode, size );</div>
<div class="line"> <a name="_a33"></a><a class="code" href="./class_m_distance.html">MDistance</a> sizeVal;</div>
<div class="line">    plug.getValue( sizeVal );</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">float</span> multiplier = (float) sizeVal.<a name="a34"></a><a class="code" href="./class_m_distance.html#ace39ab92685b0f5ab1a2925e748efb1f">asCentimeters</a>();</div>
<div class="line"></div>
<div class="line">    view.<a name="a35"></a><a class="code" href="./class_m3d_view.html#a0e318e5634c7aaf31c4eb7232d2013d4">beginGL</a>();</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( ( style == <a name="a36"></a><a class="code" href="./class_m3d_view.html#a1b68f8823b8e275a4b548fdd27263e8aa7914d385424ca72fdf84654b735a5a50">M3dView::kFlatShaded</a> ) ||</div>
<div class="line">         ( style == <a name="a37"></a><a class="code" href="./class_m3d_view.html#a1b68f8823b8e275a4b548fdd27263e8aa620925ec70781a5f5de890d906660d24">M3dView::kGouraudShaded</a> ) )</div>
<div class="line">    { </div>
<div class="line"> <span class="comment">// Push the color settings</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">        glPushAttrib( GL_CURRENT_BIT );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( status == <a name="a38"></a><a class="code" href="./class_m3d_view.html#ad9c34c5373567566950642c16a7c4bcaab6a8784b4cf96692e0d71d19c44ce732">M3dView::kActive</a> ) {</div>
<div class="line">            view.<a name="a39"></a><a class="code" href="./class_m3d_view.html#aaf6fd568acc50d57be00639f773c1d73">setDrawColor</a>( 13, <a name="a40"></a><a class="code" href="./class_m3d_view.html#a9b24d632cd80af03d971c58ce0b8df6aa18362fb06caee77a9bae15aa90e06d1c">M3dView::kActiveColors</a> );</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            view.<a class="code" href="./class_m3d_view.html#aaf6fd568acc50d57be00639f773c1d73">setDrawColor</a>( 13, <a name="a41"></a><a class="code" href="./class_m3d_view.html#a9b24d632cd80af03d971c58ce0b8df6aa466739773561fe25487724d1b7a16234">M3dView::kDormantColors</a> );</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        glBegin( GL_TRIANGLE_FAN );</div>
<div class="line"> <span class="keywordtype">int</span> i;</div>
<div class="line"> <span class="keywordtype">int</span> last = soleCount - 1;</div>
<div class="line"> <span class="keywordflow">for</span> ( i = 0; i &lt; last; ++i ) {</div>
<div class="line">                glVertex3f( sole[i][0] * multiplier,</div>
<div class="line">                            sole[i][1] * multiplier,</div>
<div class="line">                            sole[i][2] * multiplier );</div>
<div class="line">            }</div>
<div class="line">        glEnd();</div>
<div class="line">        glBegin( GL_TRIANGLE_FAN );</div>
<div class="line">            last = heelCount - 1;</div>
<div class="line"> <span class="keywordflow">for</span> ( i = 0; i &lt; last; ++i ) {</div>
<div class="line">                glVertex3f( heel[i][0] * multiplier,</div>
<div class="line">                            heel[i][1] * multiplier,</div>
<div class="line">                            heel[i][2] * multiplier );</div>
<div class="line">            }</div>
<div class="line">        glEnd();</div>
<div class="line"></div>
<div class="line">        glPopAttrib();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Draw the outline of the foot</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">    glBegin( GL_LINES );</div>
<div class="line"> <span class="keywordtype">int</span> i;</div>
<div class="line"> <span class="keywordtype">int</span> last = soleCount - 1;</div>
<div class="line"> <span class="keywordflow">for</span> ( i = 0; i &lt; last; ++i ) {</div>
<div class="line">            glVertex3f( sole[i][0] * multiplier,</div>
<div class="line">                        sole[i][1] * multiplier,</div>
<div class="line">                        sole[i][2] * multiplier );</div>
<div class="line">            glVertex3f( sole[i+1][0] * multiplier,</div>
<div class="line">                        sole[i+1][1] * multiplier,</div>
<div class="line">                        sole[i+1][2] * multiplier );</div>
<div class="line">        }</div>
<div class="line">        last = heelCount - 1;</div>
<div class="line"> <span class="keywordflow">for</span> ( i = 0; i &lt; last; ++i ) {</div>
<div class="line">            glVertex3f( heel[i][0] * multiplier,</div>
<div class="line">                        heel[i][1] * multiplier,</div>
<div class="line">                        heel[i][2] * multiplier );</div>
<div class="line">            glVertex3f( heel[i+1][0] * multiplier,</div>
<div class="line">                        heel[i+1][1] * multiplier,</div>
<div class="line">                        heel[i+1][2] * multiplier );</div>
<div class="line">        }</div>
<div class="line">    glEnd();</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    view.<a name="a42"></a><a class="code" href="./class_m3d_view.html#ab810c5a46d728df70ff5f44b604559f4">endGL</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> footPrint::isBounded()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_bounding_box.html">MBoundingBox</a> footPrint::boundingBox()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <span class="comment">// Get the size</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> thisNode = thisMObject();</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug( thisNode, size );</div>
<div class="line"> <a class="code" href="./class_m_distance.html">MDistance</a> sizeVal;</div>
<div class="line">    plug.getValue( sizeVal );</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">double</span> multiplier = sizeVal.<a class="code" href="./class_m_distance.html#ace39ab92685b0f5ab1a2925e748efb1f">asCentimeters</a>();</div>
<div class="line"></div>
<div class="line"> <a name="_a43"></a><a class="code" href="./class_m_point.html">MPoint</a> corner1( -0.17, 0.0, -0.7 );</div>
<div class="line"> <a class="code" href="./class_m_point.html">MPoint</a> corner2( 0.17, 0.0, 0.3 );</div>
<div class="line"></div>
<div class="line">    corner1 = corner1 * multiplier;</div>
<div class="line">    corner2 = corner2 * multiplier;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> <a class="code" href="./class_m_bounding_box.html">MBoundingBox</a>( corner1, corner2 );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_selection_mask.html">MSelectionMask</a> footPrint::getShapeSelectionMask()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <span class="keywordflow">return</span> <a class="code" href="./class_m_selection_mask.html">MSelectionMask</a>(<span class="stringliteral">"footPrintSelection"</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Called before this node is evaluated by Evaluation Manager</span></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> footPrint::preEvaluation(</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_d_g_context.html">MDGContext</a>&amp; context,</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode)</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">if</span> (context.<a name="a44"></a><a class="code" href="./class_m_d_g_context.html#a761a03ae58bbf2942f90578a0e61ada7">isNormal</a>())</div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <span class="keywordflow">if</span> (evaluationNode.<a name="a45"></a><a class="code" href="./class_m_evaluation_node.html#aad069e4fae5beaab80d421a1e18505aa">dirtyPlugExists</a>(size, &amp;status) &amp;&amp; status)</div>
<div class="line">        {</div>
<div class="line"> <a name="a46"></a><a class="code" href="./class_m_h_w_render_1_1_m_renderer.html#ab2843a350b76cdcbf16dd70d884f9766">MHWRender::MRenderer::setGeometryDrawDirty</a>(thisMObject());</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> <a name="a47"></a><a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MStatus::kSuccess</a>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span>* footPrint::creator()</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">new</span> footPrint();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//---------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//---------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Viewport 2.0 override implementation</span></div>
<div class="line"><span class="comment">//---------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//---------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>FootPrintGeometryOverride : <span class="keyword">public</span> <a name="_a48"></a><a class="code" href="./class_m_h_w_render_1_1_m_px_geometry_override.html">MHWRender::MPxGeometryOverride</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_h_w_render_1_1_m_px_geometry_override.html">MHWRender::MPxGeometryOverride</a>* Creator(<span class="keyword">const</span> <a class="code" href="./class_m_object.html">MObject</a>&amp; obj)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">new</span> FootPrintGeometryOverride(obj);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ~FootPrintGeometryOverride() <span class="keyword">override</span>;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./namespace_m_h_w_render.html#ad970d5c990d4803d0e9d73c1ff4fda49">MHWRender::DrawAPI</a> <a name="a49"></a><a class="code" href="./class_m_h_w_render_1_1_m_px_geometry_override.html#a9c43d7192e56c01d8dde77fabd843a0e">supportedDrawAPIs</a>() <span class="keyword">const override</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">bool</span> <a name="a50"></a><a class="code" href="./class_m_h_w_render_1_1_m_px_geometry_override.html#a05c70618c28196399681a784a3686b50">hasUIDrawables</a>()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">void</span> <a name="a51"></a><a class="code" href="./class_m_h_w_render_1_1_m_px_geometry_override.html#a66874f312bfb87c0159dfbfacafbc3fd">updateDG</a>() <span class="keyword">override</span>;</div>
<div class="line"> <span class="keywordtype">bool</span> <a name="a52"></a><a class="code" href="./class_m_h_w_render_1_1_m_px_geometry_override.html#a2bd5a3515d1cf5223d6b0851dec33aa2">isIndexingDirty</a>(<span class="keyword">const</span> <a name="_a53"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item.html">MHWRender::MRenderItem</a> &amp;item)<span class="keyword"> override </span>{ <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"> <span class="keywordtype">bool</span> <a name="a54"></a><a class="code" href="./class_m_h_w_render_1_1_m_px_geometry_override.html#a45aa4d75f1caf5b4783871b4996b38b6">isStreamDirty</a>(<span class="keyword">const</span> <a name="_a55"></a><a class="code" href="./class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html">MHWRender::MVertexBufferDescriptor</a> &amp;desc)<span class="keyword"> override </span>{ <span class="keywordflow">return</span> mMultiplierChanged; }</div>
<div class="line"> <span class="keywordtype">void</span> <a name="a56"></a><a class="code" href="./class_m_h_w_render_1_1_m_px_geometry_override.html#abad8e8b1f0e06eea32e2be8f97200941">updateRenderItems</a>(<span class="keyword">const</span> <a class="code" href="./class_m_dag_path.html">MDagPath</a> &amp;path, <a name="_a57"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item_list.html">MHWRender::MRenderItemList</a>&amp; list) <span class="keyword">override</span>;</div>
<div class="line"> <span class="keywordtype">void</span> <a name="a58"></a><a class="code" href="./class_m_h_w_render_1_1_m_px_geometry_override.html#a37c7a59c1e34ed5e0528fe0ac351b519">populateGeometry</a>(<span class="keyword">const</span> <a name="_a59"></a><a class="code" href="./class_m_h_w_render_1_1_m_geometry_requirements.html">MHWRender::MGeometryRequirements</a> &amp;requirements, <span class="keyword">const</span> <a class="code" href="./class_m_h_w_render_1_1_m_render_item_list.html">MHWRender::MRenderItemList</a> &amp;renderItems, <a name="_a60"></a><a class="code" href="./class_m_h_w_render_1_1_m_geometry.html">MHWRender::MGeometry</a> &amp;data) <span class="keyword">override</span>;</div>
<div class="line"> <span class="keywordtype">void</span> <a name="a61"></a><a class="code" href="./class_m_h_w_render_1_1_m_px_geometry_override.html#aa4c938a24a336e5ca1c28372bc6972d7">cleanUp</a>()<span class="keyword"> override </span>{};</div>
<div class="line"> </div>
<div class="line"> <span class="comment">/*  </span></div>
<div class="line"><span class="comment">        Tracing will look something like the following when in shaded mode:</span></div>
<div class="line"><span class="comment"> </span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: Geometry override DG update: footPrint1</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: Start geometry override render item update: |transform1|footPrint1</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: - Call API to update render items</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: End geometry override render item update: |transform1|footPrint1</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: Start geometry override update stream and indexing data: footPrint1</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: - Update render item: soleLocatorTriangles</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: - Update render item: heelLocatorTriangles</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: End geometry override stream and indexing data: footPrint1</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: End geometry override clean up: footPrint1</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">        at creation time.   </span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: Geometry override DG update: footPrint1</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: Start geometry override render item update: |transform1|footPrint1</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: - Call API to update render items</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: End geometry override render item update: |transform1|footPrint1</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: End geometry override clean up: footPrint1</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">        on selection change.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: Geometry override DG update: footPrint1</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: Start geometry override render item update: |transform1|footPrint1</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: - Call API to update render items</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: End geometry override render item update: |transform1|footPrint1</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: Geometry override dirty stream check: footPrint1</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: Start geometry override update stream and indexing data: footPrint1</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: End geometry override stream and indexing data: footPrint1</span></div>
<div class="line"><span class="comment">        footPrintGeometryOverride: End geometry override clean up: footPrint1</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">        for footprint size change.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">        This is based on the existing stream and indexing dirty flags being used</span></div>
<div class="line"><span class="comment">        which attempts to minimize the amount of render item, vertex buffer and indexing update.</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line"> <span class="keywordtype">bool</span> <a name="a62"></a><a class="code" href="./class_m_h_w_render_1_1_m_px_geometry_override.html#a498335c9c0b0ff5dce6efc063769eb3b">traceCallSequence</a>()<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword"> </span>{</div>
<div class="line"> <span class="comment">// Return true if internal tracing is desired.</span></div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordtype">void</span> <a name="a63"></a><a class="code" href="./class_m_h_w_render_1_1_m_px_geometry_override.html#a4ff99ebf5c2ae4a67e7ea54547c2e10b">handleTraceMessage</a>( <span class="keyword">const</span> <a class="code" href="./class_m_string.html">MString</a> &amp;message )<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword"> </span>{</div>
<div class="line"> <a name="a64"></a><a class="code" href="./class_m_global.html#a3d14e9f9ed022a80f664eac0136c2f7a">MGlobal::displayInfo</a>(<span class="stringliteral">"footPrintGeometryOverride: "</span> + message);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Some simple custom message formatting.</span></div>
<div class="line">        fputs(<span class="stringliteral">"footPrintGeometryOverride: "</span>,stderr);</div>
<div class="line">        fputs(message.<a name="a65"></a><a class="code" href="./class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(),stderr);</div>
<div class="line">        fputs(<span class="stringliteral">"\n"</span>,stderr);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    FootPrintGeometryOverride(<span class="keyword">const</span> <a class="code" href="./class_m_object.html">MObject</a>&amp; obj);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> mLocatorNode;</div>
<div class="line"> <span class="keywordtype">float</span> mMultiplier;</div>
<div class="line"> <span class="keywordtype">bool</span> mMultiplierChanged;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">FootPrintGeometryOverride::FootPrintGeometryOverride(<span class="keyword">const</span> <a class="code" href="./class_m_object.html">MObject</a>&amp; obj)</div>
<div class="line">: <a class="code" href="./namespace_m_h_w_render.html">MHWRender</a>::MPxGeometryOverride(obj)</div>
<div class="line">, mLocatorNode(obj)</div>
<div class="line">, mMultiplier(0.0f)</div>
<div class="line">, mMultiplierChanged(true)</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">FootPrintGeometryOverride::~FootPrintGeometryOverride()</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="./namespace_m_h_w_render.html#ad970d5c990d4803d0e9d73c1ff4fda49">MHWRender::DrawAPI</a> FootPrintGeometryOverride::supportedDrawAPIs()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <span class="comment">// this plugin supports both GL and DX</span></div>
<div class="line"> <span class="keywordflow">return</span> (<a name="a66"></a><a class="code" href="./namespace_m_h_w_render.html#ad970d5c990d4803d0e9d73c1ff4fda49a72361be679c1aca1c1be5f9b500a3315">MHWRender::kOpenGL</a> | <a name="a67"></a><a class="code" href="./namespace_m_h_w_render.html#ad970d5c990d4803d0e9d73c1ff4fda49a90bc0a1678af7ac4d1e62e2e954be4e5">MHWRender::kDirectX11</a> | <a name="a68"></a><a class="code" href="./namespace_m_h_w_render.html#ad970d5c990d4803d0e9d73c1ff4fda49aaebf48c70b63878eff38483392f19fb7">MHWRender::kOpenGLCoreProfile</a>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> FootPrintGeometryOverride::updateDG()</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(mLocatorNode, footPrint::size);</div>
<div class="line"> <span class="keywordtype">float</span> newScale = 1.0f;</div>
<div class="line"> <span class="keywordflow">if</span> (!plug.isNull())</div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_distance.html">MDistance</a> sizeVal;</div>
<div class="line"> <span class="keywordflow">if</span> (plug.getValue(sizeVal))</div>
<div class="line">        {</div>
<div class="line">            newScale = (float)sizeVal.<a class="code" href="./class_m_distance.html#ace39ab92685b0f5ab1a2925e748efb1f">asCentimeters</a>();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (newScale != mMultiplier)</div>
<div class="line">    {</div>
<div class="line">        mMultiplier = newScale;</div>
<div class="line">        mMultiplierChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> FootPrintGeometryOverride::updateRenderItems( <span class="keyword">const</span> <a class="code" href="./class_m_dag_path.html">MDagPath</a>&amp; path, <a class="code" href="./class_m_h_w_render_1_1_m_render_item_list.html">MHWRender::MRenderItemList</a>&amp; list )</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_color.html">MColor</a> color = <a name="a69"></a><a class="code" href="./class_m_h_w_render_1_1_m_geometry_utilities.html#a6221bc7407b14246b14f79a751496276">MHWRender::MGeometryUtilities::wireframeColor</a>(path);</div>
<div class="line"> <a class="code" href="./class_m_h_w_render_1_1_m_shader_instance.html">MHWRender::MShaderInstance</a>* shader = get3dSolidShader(color);</div>
<div class="line"> <span class="keywordflow">if</span> (!shader) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> depthPriority;</div>
<div class="line"> <span class="keywordflow">switch</span> (<a name="a70"></a><a class="code" href="./class_m_h_w_render_1_1_m_geometry_utilities.html#aa2838b92c9f7db4a810690a986199134">MHWRender::MGeometryUtilities::displayStatus</a>(path))</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">case</span> <a name="a71"></a><a class="code" href="./namespace_m_h_w_render.html#ad9c34c5373567566950642c16a7c4bcaa1606a62e097fcfa55af6251a83b44243">MHWRender::kLead</a>:</div>
<div class="line"> <span class="keywordflow">case</span> <a name="a72"></a><a class="code" href="./namespace_m_h_w_render.html#ad9c34c5373567566950642c16a7c4bcaab6a8784b4cf96692e0d71d19c44ce732">MHWRender::kActive</a>:</div>
<div class="line"> <span class="keywordflow">case</span> <a name="a73"></a><a class="code" href="./namespace_m_h_w_render.html#ad9c34c5373567566950642c16a7c4bcaa88694d85749c9c85738c56c4912c385a">MHWRender::kHilite</a>:</div>
<div class="line"> <span class="keywordflow">case</span> <a name="a74"></a><a class="code" href="./namespace_m_h_w_render.html#ad9c34c5373567566950642c16a7c4bcaa1d8e358d420ca7c9f6888faf51f4ec75">MHWRender::kActiveComponent</a>:</div>
<div class="line">        depthPriority = <a name="a75"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#adb484c507442ebce56eac38bd07cac07">MHWRender::MRenderItem::sActiveWireDepthPriority</a>;</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"> <span class="keywordflow">default</span>:</div>
<div class="line">        depthPriority = <a name="a76"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#ae591b9bc3a27641c854ab0703a90cab1">MHWRender::MRenderItem::sDormantFilledDepthPriority</a>;</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_h_w_render_1_1_m_render_item.html">MHWRender::MRenderItem</a>* wireframeItem = NULL;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">int</span> index = list.<a name="a77"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item_list.html#a4cfe9fc51a24bca06d2619a55542f689">indexOf</a>(wireframeItemName_);</div>
<div class="line"> <span class="keywordflow">if</span> (index &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        wireframeItem = <a name="a78"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MHWRender::MRenderItem::Create</a>(</div>
<div class="line">            wireframeItemName_,</div>
<div class="line"> <a name="a79"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#a688a4360e982358b90610f58d4eef49eab87ea4b9433d4e99398728f2cf29b881">MHWRender::MRenderItem::DecorationItem</a>,</div>
<div class="line"> <a name="a80"></a><a class="code" href="./class_m_h_w_render_1_1_m_geometry.html#a08260379b97fd733e30ea92e891ede1ea9808e481c6346dfc333afb4c52890ac9">MHWRender::MGeometry::kLines</a>);</div>
<div class="line">        wireframeItem-&gt;<a name="a81"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>(<a name="a82"></a><a class="code" href="./class_m_h_w_render_1_1_m_geometry.html#a9a325db332d24e6105fe3b48a94604c3a62a997a862929eb62b0273d1db9e8e0d">MHWRender::MGeometry::kWireframe</a>);</div>
<div class="line">        list.<a name="a83"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item_list.html#a238f55e85f694b4f74535aaedc6ebe01">append</a>(wireframeItem);</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        wireframeItem = list.<a name="a84"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item_list.html#a82ed5d7ae96a2890f5f54f697bb0bab0">itemAt</a>(index);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>(wireframeItem)</div>
<div class="line">    {</div>
<div class="line">        wireframeItem-&gt;<a name="a85"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(shader);</div>
<div class="line">        wireframeItem-&gt;<a name="a86"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#a6e865e2cf5c9d818b1cbb99af2360c47">depthPriority</a>(depthPriority);</div>
<div class="line">        wireframeItem-&gt;<a name="a87"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#a1e9d2a5708b2231a8e72d22dc3be53fe">enable</a>(<span class="keyword">true</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_h_w_render_1_1_m_render_item.html">MHWRender::MRenderItem</a>* shadedItem = NULL;</div>
<div class="line"></div>
<div class="line">    index = list.<a class="code" href="./class_m_h_w_render_1_1_m_render_item_list.html#a4cfe9fc51a24bca06d2619a55542f689">indexOf</a>(shadedItemName_);</div>
<div class="line"> <span class="keywordflow">if</span> (index &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        shadedItem = <a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MHWRender::MRenderItem::Create</a>(</div>
<div class="line">            shadedItemName_,</div>
<div class="line"> <a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#a688a4360e982358b90610f58d4eef49eab87ea4b9433d4e99398728f2cf29b881">MHWRender::MRenderItem::DecorationItem</a>,</div>
<div class="line"> <a name="a88"></a><a class="code" href="./class_m_h_w_render_1_1_m_geometry.html#a08260379b97fd733e30ea92e891ede1eaa2c70dd76c8172a9298334473c914304">MHWRender::MGeometry::kTriangles</a>);</div>
<div class="line">        shadedItem-&gt;<a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>((<a class="code" href="./class_m_h_w_render_1_1_m_geometry.html#a9a325db332d24e6105fe3b48a94604c3">MHWRender::MGeometry::DrawMode</a>)(<a name="a89"></a><a class="code" href="./class_m_h_w_render_1_1_m_geometry.html#a9a325db332d24e6105fe3b48a94604c3a3ba47eb2caff6eea24d37de5f572f769">MHWRender::MGeometry::kShaded</a> | <a name="a90"></a><a class="code" href="./class_m_h_w_render_1_1_m_geometry.html#a9a325db332d24e6105fe3b48a94604c3a17e882561d8db0dedc215d0d4978e887">MHWRender::MGeometry::kTextured</a>));</div>
<div class="line">        list.<a class="code" href="./class_m_h_w_render_1_1_m_render_item_list.html#a238f55e85f694b4f74535aaedc6ebe01">append</a>(shadedItem);</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        shadedItem = list.<a class="code" href="./class_m_h_w_render_1_1_m_render_item_list.html#a82ed5d7ae96a2890f5f54f697bb0bab0">itemAt</a>(index);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>(shadedItem)</div>
<div class="line">    {</div>
<div class="line">        shadedItem-&gt;<a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(shader);</div>
<div class="line">        shadedItem-&gt;<a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#a6e865e2cf5c9d818b1cbb99af2360c47">depthPriority</a>(depthPriority);</div>
<div class="line">        shadedItem-&gt;<a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#a1e9d2a5708b2231a8e72d22dc3be53fe">enable</a>(<span class="keyword">true</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> FootPrintGeometryOverride::populateGeometry(</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_h_w_render_1_1_m_geometry_requirements.html">MHWRender::MGeometryRequirements</a>&amp; requirements,</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_h_w_render_1_1_m_render_item_list.html">MHWRender::MRenderItemList</a>&amp; renderItems,</div>
<div class="line"> <a class="code" href="./class_m_h_w_render_1_1_m_geometry.html">MHWRender::MGeometry</a>&amp; data)</div>
<div class="line">{</div>
<div class="line"> <a name="_a91"></a><a class="code" href="./class_m_h_w_render_1_1_m_vertex_buffer.html">MHWRender::MVertexBuffer</a>* verticesBuffer       = NULL;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">float</span>* vertices                     = NULL;</div>
<div class="line"></div>
<div class="line"> <span class="keyword">const</span> <a name="_a92"></a><a class="code" href="./class_m_h_w_render_1_1_m_vertex_buffer_descriptor_list.html">MHWRender::MVertexBufferDescriptorList</a>&amp; vertexBufferDescriptorList = requirements.<a name="a93"></a><a class="code" href="./class_m_h_w_render_1_1_m_geometry_requirements.html#a960f411f65fde2d97da465a6b276d774">vertexRequirements</a>();</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">int</span> numberOfVertexRequirments = vertexBufferDescriptorList.<a name="a94"></a><a class="code" href="./class_m_h_w_render_1_1_m_vertex_buffer_descriptor_list.html#a57b988236ee6a3a5e572d126d3fbccc1">length</a>();</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html">MHWRender::MVertexBufferDescriptor</a> vertexBufferDescriptor;</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> requirmentNumber = 0; requirmentNumber &lt; numberOfVertexRequirments; ++requirmentNumber)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (!vertexBufferDescriptorList.<a name="a95"></a><a class="code" href="./class_m_h_w_render_1_1_m_vertex_buffer_descriptor_list.html#ab5970217cd80acac6aa900cc1daec6b8">getDescriptor</a>(requirmentNumber, vertexBufferDescriptor))</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">switch</span> (vertexBufferDescriptor.<a name="a96"></a><a class="code" href="./class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html#abc8db8e8585a67a40d57c26811aaf8e2">semantic</a>())</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">case</span> <a name="a97"></a><a class="code" href="./class_m_h_w_render_1_1_m_geometry.html#a5a5b1d8320f94d3c3d142753f5527fc4aa20581584e5f9447cb96afb4f2e10703">MHWRender::MGeometry::kPosition</a>:</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">if</span> (!verticesBuffer)</div>
<div class="line">                {</div>
<div class="line">                    verticesBuffer = data.<a name="a98"></a><a class="code" href="./class_m_h_w_render_1_1_m_geometry.html#acf6369e390e9831c0e180cc60c7db618">createVertexBuffer</a>(vertexBufferDescriptor);</div>
<div class="line"> <span class="keywordflow">if</span> (verticesBuffer)</div>
<div class="line">                    {</div>
<div class="line">                        vertices = (<span class="keywordtype">float</span>*)verticesBuffer-&gt;<a name="a99"></a><a class="code" href="./class_m_h_w_render_1_1_m_vertex_buffer.html#aff9e3c2ed40ad0c0f0fe55668670d071">acquire</a>(soleCount+heelCount);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"> <span class="keywordflow">default</span>:</div>
<div class="line"> <span class="comment">// do nothing for stuff we don't understand</span></div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">int</span> verticesPointerOffset = 0;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// We concatenate the heel and sole positions into a single vertex buffer.</span></div>
<div class="line"> <span class="comment">// The index buffers will decide which positions will be selected for each render items.</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> currentVertex = 0 ; currentVertex &lt; soleCount+heelCount; ++currentVertex)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span>(vertices)</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">if</span> (currentVertex &lt; heelCount)</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordtype">int</span> heelVtx = currentVertex;</div>
<div class="line">                vertices[verticesPointerOffset++] = heel[heelVtx][0] * mMultiplier;</div>
<div class="line">                vertices[verticesPointerOffset++] = heel[heelVtx][1] * mMultiplier;</div>
<div class="line">                vertices[verticesPointerOffset++] = heel[heelVtx][2] * mMultiplier;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line"> <span class="keywordtype">int</span> soleVtx = currentVertex - heelCount;</div>
<div class="line">                vertices[verticesPointerOffset++] = sole[soleVtx][0] * mMultiplier;</div>
<div class="line">                vertices[verticesPointerOffset++] = sole[soleVtx][1] * mMultiplier;</div>
<div class="line">                vertices[verticesPointerOffset++] = sole[soleVtx][2] * mMultiplier;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>(verticesBuffer &amp;&amp; vertices)</div>
<div class="line">    {</div>
<div class="line">        verticesBuffer-&gt;<a name="a100"></a><a class="code" href="./class_m_h_w_render_1_1_m_vertex_buffer.html#aafb3736206f8a73c0fc74757919cfb83">commit</a>(vertices);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; renderItems.<a name="a101"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item_list.html#a57b988236ee6a3a5e572d126d3fbccc1">length</a>(); ++i)</div>
<div class="line">    {</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_h_w_render_1_1_m_render_item.html">MHWRender::MRenderItem</a>* item = renderItems.<a class="code" href="./class_m_h_w_render_1_1_m_render_item_list.html#a82ed5d7ae96a2890f5f54f697bb0bab0">itemAt</a>(i);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (!item)</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <a name="_a102"></a><a class="code" href="./class_m_h_w_render_1_1_m_index_buffer.html">MHWRender::MIndexBuffer</a>* indexBuffer = data.<a name="a103"></a><a class="code" href="./class_m_h_w_render_1_1_m_geometry.html#a649d0f008cdfbd368a4157dcd47ede67">createIndexBuffer</a>(<a name="a104"></a><a class="code" href="./class_m_h_w_render_1_1_m_geometry.html#ad8ed01ff3ff33333d8e19db4d2818bb6aa93f90f58b3077bdbedeb9506e0143fd">MHWRender::MGeometry::kUnsignedInt32</a>);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (item-&gt;<a name="a105"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#aca2cba4630391c78dcf1a828986160da">name</a>() == wireframeItemName_ )</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordtype">int</span> primitiveIndex = 0;</div>
<div class="line"> <span class="keywordtype">int</span> startIndex = 0;</div>
<div class="line"> <span class="keywordtype">int</span> numPrimitive = heelCount + soleCount - 2;</div>
<div class="line"> <span class="keywordtype">int</span> numIndex = numPrimitive * 2;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* indices = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*)indexBuffer-&gt;<a name="a106"></a><a class="code" href="./class_m_h_w_render_1_1_m_index_buffer.html#aff9e3c2ed40ad0c0f0fe55668670d071">acquire</a>(numIndex);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numIndex; )</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">if</span> (i &lt; (heelCount - 1) * 2)</div>
<div class="line">                {</div>
<div class="line">                    startIndex = 0;</div>
<div class="line">                    primitiveIndex = i / 2;</div>
<div class="line">                }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    startIndex = heelCount;</div>
<div class="line">                    primitiveIndex = i / 2 - heelCount + 1;</div>
<div class="line">                }</div>
<div class="line">                indices[i++] = startIndex + primitiveIndex;</div>
<div class="line">                indices[i++] = startIndex + primitiveIndex + 1;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            indexBuffer-&gt;<a name="a107"></a><a class="code" href="./class_m_h_w_render_1_1_m_index_buffer.html#aafb3736206f8a73c0fc74757919cfb83">commit</a>(indices);</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (item-&gt;<a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#aca2cba4630391c78dcf1a828986160da">name</a>() == shadedItemName_ )</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordtype">int</span> primitiveIndex = 0;</div>
<div class="line"> <span class="keywordtype">int</span> startIndex = 0;</div>
<div class="line"> <span class="keywordtype">int</span> numPrimitive = heelCount + soleCount - 4;</div>
<div class="line"> <span class="keywordtype">int</span> numIndex = numPrimitive * 3;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* indices = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*)indexBuffer-&gt;<a class="code" href="./class_m_h_w_render_1_1_m_index_buffer.html#aff9e3c2ed40ad0c0f0fe55668670d071">acquire</a>(numIndex);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numIndex; )</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">if</span> (i &lt; (heelCount - 2) * 3)</div>
<div class="line">                {</div>
<div class="line">                    startIndex = 0;</div>
<div class="line">                    primitiveIndex = i / 3;</div>
<div class="line">                }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    startIndex = heelCount;</div>
<div class="line">                    primitiveIndex = i / 3 - heelCount + 2;</div>
<div class="line">                }</div>
<div class="line">                indices[i++] = startIndex;</div>
<div class="line">                indices[i++] = startIndex + primitiveIndex + 1;</div>
<div class="line">                indices[i++] = startIndex + primitiveIndex + 2;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            indexBuffer-&gt;<a class="code" href="./class_m_h_w_render_1_1_m_index_buffer.html#aafb3736206f8a73c0fc74757919cfb83">commit</a>(indices);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        item-&gt;<a name="a108"></a><a class="code" href="./class_m_h_w_render_1_1_m_render_item.html#a7d0f067f76206a54f4f716f63bcb6b19">associateWithIndexBuffer</a>(indexBuffer);</div>
<div class="line">    }</div>
<div class="line">    mMultiplierChanged = <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//---------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//---------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Plugin Registration</span></div>
<div class="line"><span class="comment">//---------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//---------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> footPrint::initialize()</div>
<div class="line">{</div>
<div class="line"> <a name="_a109"></a><a class="code" href="./class_m_fn_unit_attribute.html">MFnUnitAttribute</a> unitFn;</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a>          stat;</div>
<div class="line"></div>
<div class="line">    size = unitFn.<a name="a110"></a><a class="code" href="./class_m_fn_unit_attribute.html#a31f804de81a968aa11b510a6231e7874">create</a>( <span class="stringliteral">"size"</span>, <span class="stringliteral">"sz"</span>, <a name="a111"></a><a class="code" href="./class_m_fn_unit_attribute.html#a1d1cfd8ffb84e947f82999c682b666a7a1925172d8d6f77cdb98f7f486f706024">MFnUnitAttribute::kDistance</a> );</div>
<div class="line">    unitFn.<a name="a112"></a><a class="code" href="./class_m_fn_unit_attribute.html#a02a46e1b4ae48c38d85678a8611e3e77">setDefault</a>( 1.0 );</div>
<div class="line"></div>
<div class="line">    stat = addAttribute( size );</div>
<div class="line"> <span class="keywordflow">if</span> (!stat) {</div>
<div class="line">        stat.<a name="a113"></a><a class="code" href="./class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">"addAttribute"</span>);</div>
<div class="line"> <span class="keywordflow">return</span> stat;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> initializePlugin( <a class="code" href="./class_m_object.html">MObject</a> obj )</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a>   status;</div>
<div class="line"> <a name="_a114"></a><a class="code" href="./class_m_fn_plugin.html">MFnPlugin</a> plugin( obj, PLUGIN_COMPANY, <span class="stringliteral">"3.0"</span>, <span class="stringliteral">"Any"</span>);</div>
<div class="line"></div>
<div class="line">    status = plugin.registerNode(</div>
<div class="line"> <span class="stringliteral">"footPrint_GeometryOverride"</span>,</div>
<div class="line">                footPrint::id,</div>
<div class="line">                &amp;footPrint::creator,</div>
<div class="line">                &amp;footPrint::initialize,</div>
<div class="line"> <a name="a115"></a><a class="code" href="./class_m_px_node.html#a1d1cfd8ffb84e947f82999c682b666a7aee1b06f2f9885d7d4fd4fda48926f94b">MPxNode::kLocatorNode</a>,</div>
<div class="line">                sUseLegacyDraw ? NULL : (sMakeFootPrintDirLight ? &amp;lightClassification : &amp;footPrint::drawDbClassification)); </div>
<div class="line"> <span class="keywordflow">if</span> (!status) {</div>
<div class="line">        status.<a class="code" href="./class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">"registerNode"</span>);</div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (!sUseLegacyDraw)</div>
<div class="line">    {</div>
<div class="line">        status = <a name="a116"></a><a class="code" href="./class_m_h_w_render_1_1_m_draw_registry.html#a36f6ac92077e5064d897187608c9e548">MHWRender::MDrawRegistry::registerGeometryOverrideCreator</a>(</div>
<div class="line">            footPrint::drawDbClassification,</div>
<div class="line">            footPrint::drawRegistrantId,</div>
<div class="line">            FootPrintGeometryOverride::Creator);</div>
<div class="line"> <span class="keywordflow">if</span> (!status) {</div>
<div class="line">            status.<a class="code" href="./class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">"registerDrawOverrideCreator"</span>);</div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Register a custom selection mask with priority 2 (same as locators</span></div>
<div class="line"> <span class="comment">// by default).</span></div>
<div class="line"> <a name="a117"></a><a class="code" href="./class_m_selection_mask.html#ab4cc6ba8300a9924dd443bb64b736744">MSelectionMask::registerSelectionType</a>(<span class="stringliteral">"footPrintSelection"</span>, 2);</div>
<div class="line">    status = <a name="a118"></a><a class="code" href="./class_m_global.html#a09e405631e7cf680f8ac9d934ad73434">MGlobal::executeCommand</a>(<span class="stringliteral">"selectType -byName \"footPrintSelection\" 1"</span>);</div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> uninitializePlugin( <a class="code" href="./class_m_object.html">MObject</a> obj)</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a>   status;</div>
<div class="line"> <a class="code" href="./class_m_fn_plugin.html">MFnPlugin</a> plugin( obj );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (!sUseLegacyDraw)</div>
<div class="line">    {</div>
<div class="line">        status = <a name="a119"></a><a class="code" href="./class_m_h_w_render_1_1_m_draw_registry.html#a24f600902d1e1a22ccd8985f9eee39a1">MHWRender::MDrawRegistry::deregisterGeometryOverrideCreator</a>(</div>
<div class="line">            footPrint::drawDbClassification,</div>
<div class="line">            footPrint::drawRegistrantId);</div>
<div class="line"> <span class="keywordflow">if</span> (!status) {</div>
<div class="line">            status.<a class="code" href="./class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">"deregisterDrawOverrideCreator"</span>);</div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        status = releaseShaders();</div>
<div class="line"> <span class="keywordflow">if</span> (!status) {</div>
<div class="line">            status.<a class="code" href="./class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">"releaseShaders"</span>);</div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    status = plugin.deregisterNode( footPrint::id );</div>
<div class="line"> <span class="keywordflow">if</span> (!status) {</div>
<div class="line">        status.<a class="code" href="./class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">"deregisterNode"</span>);</div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Deregister custom selection mask</span></div>
<div class="line"> <a name="a120"></a><a class="code" href="./class_m_selection_mask.html#ae82a6cf818deb6b6310ad06e60b269ed">MSelectionMask::deregisterSelectionType</a>(<span class="stringliteral">"footPrintSelection"</span>);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div class="footer-block"><a class="comments-anchor" href="../html/ac.cmtdialog.htm" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
</link></link></link></link></div></body>
</html>
