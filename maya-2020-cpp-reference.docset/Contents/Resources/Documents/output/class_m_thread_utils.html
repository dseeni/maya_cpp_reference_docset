<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
<head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
<title>C++ API Reference: MThreadUtils Class Reference</title>
</head>
<body height="100%"><div class="body_content" id="body-content"><link href="cpp_ref/navtree.css" rel="stylesheet" type="text/css"/><link href="cpp_ref/doxygen.css" rel="stylesheet" type="text/css"/><link href="cpp_ref/tabs.css" rel="stylesheet" type="text/css"/><link href="style/adsk.cpm.css" rel="stylesheet" type="text/css"/><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('class_m_thread_utils.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script>
<div>
<div class="head">
<h1>C++ API Reference: MThreadUtils Class Reference</h1>
</div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<div class="tabs" id="navrow1">
<ul class="tablist">
<li><a href="./index.html"><span>Main Page</span></a></li>
<li><a href="./pages.html"><span>Related Pages</span></a></li>
<li><a href="./modules.html"><span>Modules</span></a></li>
<li><a href="./namespaces.html"><span>Namespaces</span></a></li>
<li class="current"><a href="./annotated.html"><span>Classes</span></a></li>
<li><a href="./examples.html"><span>Examples</span></a></li>
<li>
<div class="MSearchBoxInactive" id="MSearchBox">
<span class="left">
<img alt="" id="MSearchSelect" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()" src="cpp_ref/search/mag_sel.png"/>
<input accesskey="S" id="MSearchField" onblur="searchBox.OnSearchFieldFocus(false)" onfocus="searchBox.OnSearchFieldFocus(true)" onkeyup="searchBox.OnSearchFieldChange(event)" type="text" value="Search"/>
</span><span class="right">
<a href="javascript:searchBox.CloseResultsWindow()" id="MSearchClose"><img alt="" border="0" id="MSearchCloseImg" src="cpp_ref/search/close.png"/></a>
</span>
</div>
</li>
</ul>
</div>
<div class="tabs2" id="navrow2">
<ul class="tablist">
<li><a href="./annotated.html"><span>Class List</span></a></li>
<li><a href="./classes.html"><span>Class Index</span></a></li>
<li><a href="./hierarchy.html"><span>Class Hierarchy</span></a></li>
<li><a href="./functions.html"><span>Class Members</span></a></li>
</ul>
</div>
</div><!-- top -->
<div class="ui-resizable side-nav-resizable" id="side-nav">
<div id="nav-tree">
<div id="nav-tree-contents">
<div class="sync" id="nav-sync"></div>
</div>
</div>
<div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;">
</div>
</div>
<div id="doc-content">
<!-- window showing the filter options -->
<!-- iframe showing the search results (closed by default) -->
<div class="header">
<div class="headertitle">
<div class="title">MThreadUtils Class Reference<div class="ingroups"><a class="el" href="./group___open_maya.html">OpenMaya - API module for common classes</a></div></div> </div>
<div class="summary">
<a href="class_m_thread_utils.html#pub-static-methods">Static Public Member Functions</a> |
<a href="./class_m_thread_utils-members.html">List of all members</a> </div></div><!--header-->
<div class="contents">
<p>Helper methods for threaded plugins.  
 <a href="./class_m_thread_utils.html#details">More...</a></p>
<p><code>#include &lt;MThreadUtils.h&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:aa7633759a74ed00613b7d292a457d5d6"><td align="right" class="memItemLeft" valign="top">static int </td><td class="memItemRight" valign="bottom"><a class="el" href="./class_m_thread_utils.html#aa7633759a74ed00613b7d292a457d5d6">getNumThreads</a> ()</td></tr>
<tr class="memdesc:aa7633759a74ed00613b7d292a457d5d6"><td class="mdescLeft"> </td><td class="mdescRight">Return number of threads currently being used by Maya.  <a href="class_m_thread_utils.html#aa7633759a74ed00613b7d292a457d5d6">More...</a><br/></td></tr>
<tr class="separator:aa7633759a74ed00613b7d292a457d5d6"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:ab857568ad1f4a49da93939d7db7c2a1c"><td align="right" class="memItemLeft" valign="top">static void </td><td class="memItemRight" valign="bottom"><a class="el" href="./class_m_thread_utils.html#ab857568ad1f4a49da93939d7db7c2a1c">syncNumOpenMPThreads</a> ()</td></tr>
<tr class="memdesc:ab857568ad1f4a49da93939d7db7c2a1c"><td class="mdescLeft"> </td><td class="mdescRight">Maya uses the Intel compiler for OpenMP internally.  <a href="class_m_thread_utils.html#ab857568ad1f4a49da93939d7db7c2a1c">More...</a><br/></td></tr>
<tr class="separator:ab857568ad1f4a49da93939d7db7c2a1c"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:aa1dfdf0913670708cae93b9b20aa4b11"><td align="right" class="memItemLeft" valign="top">static int </td><td class="memItemRight" valign="bottom"><a class="el" href="./class_m_thread_utils.html#aa1dfdf0913670708cae93b9b20aa4b11">getCacheLineSize</a> ()</td></tr>
<tr class="memdesc:aa1dfdf0913670708cae93b9b20aa4b11"><td class="mdescLeft"> </td><td class="mdescRight">Return cache line size for current processor.  <a href="class_m_thread_utils.html#aa1dfdf0913670708cae93b9b20aa4b11">More...</a><br/></td></tr>
<tr class="separator:aa1dfdf0913670708cae93b9b20aa4b11"><td class="memSeparator" colspan="2"> </td></tr>
</table>
<a id="details" name="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Helper methods for threaded plugins. </p>
<p><b>Thread count controls</b></p>
<p>The user can control the number of threads currently running in Maya. This is useful for example to run rendering in a single thread when multiple frames are being rendered in parallel by different instances of Maya. All code should respect this thread count, so if a plugin is threaded, it needs to query the current thread count being used by Maya and set that threadcount for itself.</p>
<p>For a plugin-local thread pool using Win32 or pthreads, use the <a class="el" href="./class_m_thread_utils.html#aa7633759a74ed00613b7d292a457d5d6" title="Return number of threads currently being used by Maya. ">getNumThreads()</a> method to check the required number of threads and set the number of threads in the plugin thread pool appropriately.</p>
<p>If using the Maya API <a class="el" href="./class_m_thread_pool.html" title="Methods for creating and managing a thread pool. ">MThreadPool</a> class there is no need to do anything as this is an internal Maya thread pool that respects the user-defined thread count setting.</p>
<p>If using the Intel compiler, there is no need to do anything as the threadcount is set globally for the Intel compiler.</p>
<p>If using OpenMP with gcc on OSX and Linux, or Visual C++ on Windows, it is necessary to call the syncNumOpenMPThreads to ensure the correct threadcount is set in the plugin.</p>
<p><b>Cache line size control</b></p>
<p>The cache line size is important information when code may have false sharing problems. Use the query method to ensure data that will be modified by multiple threads is on separate cache lines. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="aa7633759a74ed00613b7d292a457d5d6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
<tr>
<td class="mlabels-left">
<table class="memname">
<tr>
<td class="memname">OPENMAYA_MAJOR_NAMESPACE_OPEN int getNumThreads </td>
<td>(</td>
<td class="paramname"></td><td>)</td>
<td></td>
</tr>
</table>
</td>
<td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span> </td>
</tr>
</table>
</div><div class="memdoc">
<p>Return number of threads currently being used by Maya. </p>
<p>Users can modify the number of threads being used in Maya thread pools via the threadCount mel command. It is important for plugins to respect this settings, so a plugin should call this method to query the current threadcount when creating it's own threaded region using OpenMP. If the threads are created using the <a class="el" href="./class_m_thread_pool.html" title="Methods for creating and managing a thread pool. ">MThreadPool</a> class, no action needs to be taken since the number of threads in this class always respects the threadCount command number.</p>
<dl class="section return"><dt>Returns</dt><dd>Number of threads being used by Maya for thread pools. </dd></dl>
<dl class="section"><div class="dynheader closed" id="dynsection-example0" onclick="return toggleVisibility(this)" style="cursor:pointer;"><dt><img alt="+" id="dynsection-example0-trigger" src="cpp_ref/closed.png"/> <b>Examples: </b></dt></div><div class="dyncontent" id="dynsection-example0-content" style="display:none;"><dd><a class="el" href="./threading_lock_tests_2threading_lock_tests_8cpp-example.html#a11">threadingLockTests/threadingLockTests.cpp</a>.</dd></div>
</dl>
</div>
</div>
<a class="anchor" id="ab857568ad1f4a49da93939d7db7c2a1c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
<tr>
<td class="mlabels-left">
<table class="memname">
<tr>
<td class="memname">void syncNumOpenMPThreads </td>
<td>(</td>
<td class="paramname"></td><td>)</td>
<td></td>
</tr>
</table>
</td>
<td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span> </td>
</tr>
</table>
</div><div class="memdoc">
<p>Maya uses the Intel compiler for OpenMP internally. </p>
<p>A plugin may be built using VC++ or gcc, both of which have OpenMP thread pools that are incompatible with Intel's. For these thread pools to respect the Maya thread count, it is important to initialize the number of threads explicitly for these implementations of OpenMP. This is done by calling this function in the plugin, which queries the current the threadcount from Maya and applies it to the plugin OpenMP implementation.</p>
<p>This function does not need to be called if the plugin is compiled with the Intel compiler. </p>
<dl class="section"><div class="dynheader closed" id="dynsection-example1" onclick="return toggleVisibility(this)" style="cursor:pointer;"><dt><img alt="+" id="dynsection-example1-trigger" src="cpp_ref/closed.png"/> <b>Examples: </b></dt></div><div class="dyncontent" id="dynsection-example1-content" style="display:none;"><dd><a class="el" href="./threading_lock_tests_2threading_lock_tests_8cpp-example.html#a10">threadingLockTests/threadingLockTests.cpp</a>.</dd></div>
</dl>
</div>
</div>
<a class="anchor" id="aa1dfdf0913670708cae93b9b20aa4b11"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
<tr>
<td class="mlabels-left">
<table class="memname">
<tr>
<td class="memname">int getCacheLineSize </td>
<td>(</td>
<td class="paramname"></td><td>)</td>
<td></td>
</tr>
</table>
</td>
<td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span> </td>
</tr>
</table>
</div><div class="memdoc">
<p>Return cache line size for current processor. </p>
<p>This value can be used for padding to avoid false sharing.</p>
<p>Note that the value is queried explicitly only for processors supporting SSE3. For other processors the cache line size is assumed to be 64 bytes.</p>
<dl class="section return"><dt>Returns</dt><dd>Cache line size in bytes </dd></dl>
<dl class="section"><div class="dynheader closed" id="dynsection-example2" onclick="return toggleVisibility(this)" style="cursor:pointer;"><dt><img alt="+" id="dynsection-example2-trigger" src="cpp_ref/closed.png"/> <b>Examples: </b></dt></div><div class="dyncontent" id="dynsection-example2-content" style="display:none;"><dd><a class="el" href="./threaded_bounding_box_2threaded_bounding_box_8cpp-example.html#a2">threadedBoundingBox/threadedBoundingBox.cpp</a>.</dd></div>
</dl>
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>MThreadUtils.h</li>
<li>MThreadUtils.cpp</li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div class="footer-block"><a class="comments-anchor" href="../html/ac.cmtdialog.htm" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
</div></body>
</html>
