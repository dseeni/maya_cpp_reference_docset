<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
   <head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
      <title>C++ API Reference: dx11Shader/dx11ShaderUniformParamBuilder.cpp</title>
      
	  
      
      
      
      
      
      
      
    

</head>
   <body height="100%"><div class="body_content" id="body-content"><link rel="stylesheet" type="text/css" href="cpp_ref/navtree.css"><link rel="stylesheet" type="text/css" href="cpp_ref/doxygen.css"><link rel="stylesheet" type="text/css" href="cpp_ref/tabs.css"><link rel="stylesheet" type="text/css" href="style/adsk.cpm.css"><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('dx11_shader_2dx11_shader_uniform_param_builder_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script>
      <div>
         <div class="head">
            <h1>C++ API Reference: dx11Shader/dx11ShaderUniformParamBuilder.cpp</h1>
         </div>

<div id="top"><!-- do not remove this div, it is closed by doxygen! -->

<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->

  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="#!/url=./cpp_ref/index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="#!/url=./cpp_ref/pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="#!/url=./cpp_ref/modules.html"><span>Modules</span></a></li>
      <li><a href="#!/url=./cpp_ref/namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="#!/url=./cpp_ref/annotated.html"><span>Classes</span></a></li>
      <li><a href="#!/url=./cpp_ref/examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="cpp_ref/search/mag_sel.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt="">
          <input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="cpp_ref/search/close.png" alt=""></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" class="ui-resizable-handle">
  </div>
</div>

<div id="doc-content">
<!-- window showing the filter options -->


<!-- iframe showing the search results (closed by default) -->


<div class="header">
  <div class="headertitle">
<div class="title">dx11Shader/dx11ShaderUniformParamBuilder.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">// Copyright 2015 Autodesk, Inc.  All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk</span></div>
<div class="line"><span class="comment">// license agreement provided at the time of installation or download,</span></div>
<div class="line"><span class="comment">// or which otherwise accompanies this software in either electronic</span></div>
<div class="line"><span class="comment">// or hard copy form.</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">//+</span></div>
<div class="line"><span class="preprocessor">#if _MSC_VER &gt;= 1700</span></div>
<div class="line"><span class="preprocessor">#pragma warning( disable: 4005 )</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;dx11ShaderUniformParamBuilder.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;dx11Shader.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;dx11ShaderStrings.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;dx11ShaderCompileHelper.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;dx11ShaderSemantics.h&quot;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace</span></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Find a substring, if not found also try for lowercase substring</span></div>
<div class="line">    <span class="keywordtype">int</span> findSubstring(<span class="keyword">const</span> <a name="_a0"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>&amp; haystack, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>&amp; needle)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> at = haystack.<a name="a1"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#aaa76dfd27998dc2ff937d3690d11391c">indexW</a>(needle);</div>
<div class="line">        <span class="keywordflow">if</span>(at &lt; 0)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> needleLowerCase = needle;</div>
<div class="line">            needleLowerCase.<a name="a2"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#a56fd78fe1cd1bc285cc8c336ed977d7e">toLowerCase</a>();</div>
<div class="line">            at = haystack.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aaa76dfd27998dc2ff937d3690d11391c">indexW</a>(needleLowerCase);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> at;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">CUniformParameterBuilder::CUniformParameterBuilder()</div>
<div class="line">    :mEffectVariable(NULL)</div>
<div class="line">    ,mShader(NULL)</div>
<div class="line">    ,mParamType(eUndefined)</div>
<div class="line">    ,mLightType(eNotLight)</div>
<div class="line">    ,mLightIndex(-1)</div>
<div class="line">    ,mUIGroupIndex(-1)</div>
<div class="line">    ,mValidUniformParameter(false)</div>
<div class="line">    ,mUIOrder(-1)</div>
<div class="line">    ,mAnnotationIndex()</div>
<div class="line">{}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> CUniformParameterBuilder::init(ID3DX11EffectVariable* inEffectVariable,dx11ShaderNode* inShader, <span class="keywordtype">int</span> order)</div>
<div class="line">{</div>
<div class="line">    mEffectVariable = inEffectVariable;</div>
<div class="line">    mShader = inShader;</div>
<div class="line">    mUIOrder = order;</div>
<div class="line">    <span class="keywordflow">if</span>(mEffectVariable)</div>
<div class="line">    {</div>
<div class="line">        mEffectVariable-&gt;GetDesc(&amp;mDesc);</div>
<div class="line">        mEffectVariable-&gt;GetType()-&gt;GetDesc(&amp;mDescType);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">    Annotations are constantly evolving. For the latest</span></div>
<div class="line"><span class="comment">    standards, there are two sources of documentation to follow:</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    1- MSDN: http://msdn.microsoft.com/en-us/library/windows/desktop/bb206291%28v=vs.85%29.aspx</span></div>
<div class="line"><span class="comment">             (or search for &quot;DirectX Standard Annotations and Semantics Reference&quot;)</span></div>
<div class="line"><span class="comment">    2- NVidia: http://developer.download.nvidia.com/assets/gamedev/docs/Using_SAS_v1_03.pdf</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    The code also tries to be compatible with annotations from</span></div>
<div class="line"><span class="comment">    previous versions of the standards.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> CUniformParameterBuilder::build()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//assert(mEffectVariable);</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// building the uniform based on the type</span></div>
<div class="line">    <span class="comment">// ---------------------------------------</span></div>
<div class="line">    MUniformParameter::DataType     type        = convertType    ();</div>
<div class="line">    MUniformParameter::DataSemantic semantic    = convertSemantic();</div>
<div class="line"></div>
<div class="line">    updateLightInfoFromSemantic();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If we don&#39;t know what this parameter is, and we&#39;ve been told to hide it, do so</span></div>
<div class="line">    <span class="comment">// NOTE that for now, we only hide simple constants as hiding everything we&#39;re</span></div>
<div class="line">    <span class="comment">// told to hide actually starts hiding textures and things the artist wants to see.</span></div>
<div class="line">    <span class="comment">// ----------------------------------------------------------------------------------</span></div>
<div class="line">    <span class="keywordflow">if</span> (semantic == MUniformParameter::kSemanticUnknown &amp;&amp; (type == MUniformParameter::kTypeFloat || type == MUniformParameter::kTypeString))</div>
<div class="line">    {</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (mDesc.Semantic &amp;&amp; _stricmp(mDesc.Semantic, dx11ShaderSemantic::kSTANDARDSGLOBAL)==0)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">        The UIGroup annotation is used to groups multiple parameters in a single</span></div>
<div class="line"><span class="comment">        collapsible panel in the attribute editor. This helps organize related</span></div>
<div class="line"><span class="comment">        parameters.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">        - All parameters sharing the same UIGroup annotation string will group together</span></div>
<div class="line"><span class="comment">        - The name of the group, as shown as the header of the collapsible panel, will</span></div>
<div class="line"><span class="comment">           be the value of the annotation</span></div>
<div class="line"><span class="comment">        - The order of the panels in the attribute editor will be sorted according to</span></div>
<div class="line"><span class="comment">            the parameter with the lowest UIOrder in that group</span></div>
<div class="line"><span class="comment">        - UIGroups win over UIOrder, this means all parameters will be grouped in a</span></div>
<div class="line"><span class="comment">            single panel even if there are non grouped parameters that have a UIOrder</span></div>
<div class="line"><span class="comment">            that falls within the range of UIOrders for parameters in that group</span></div>
<div class="line"><span class="comment">        - This commands lists all UIGroups: dx11Shader -listUIGroupInformation</span></div>
<div class="line"><span class="comment">        - This command lists all parameters for a group: dx11Shader -listUIGroupParameters &lt;group&gt;</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line">    <span class="keywordflow">if</span> (mUIGroupIndex == -1)</div>
<div class="line">    {</div>
<div class="line">        LPCSTR pszUIGroupName;</div>
<div class="line">        <span class="keywordflow">if</span>( getAnnotation( dx11ShaderAnnotation::kUIGroup, pszUIGroupName) &amp;&amp; *pszUIGroupName)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> uiGroupName(pszUIGroupName);</div>
<div class="line">            mUIGroupIndex = mShader-&gt;getIndexForUIGroupName(uiGroupName, <span class="keyword">true</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">        The name of the parameter in the attribute editor defaults to</span></div>
<div class="line"><span class="comment">        the name of the variable associated with the parameter. If there</span></div>
<div class="line"><span class="comment">        is a UIName attribute on the parameter, and the &#39;kVariableNameAsAttributeName&#39;</span></div>
<div class="line"><span class="comment">        semantic is not set, this name will be used to</span></div>
<div class="line"><span class="comment">        define all three of the parameter short/long/nice name. If the</span></div>
<div class="line"><span class="comment">        UIName contains spaces or other script unfriendly characters,</span></div>
<div class="line"><span class="comment">        those will be replaced by underscores in the short and long names</span></div>
<div class="line"><span class="comment">        used in scripting.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">        Using UIName as attribute name can lead to ambiguity since UIName annotations </span></div>
<div class="line"><span class="comment">        are not required to be unique by the compiler. The MPxHardwareShader class</span></div>
<div class="line"><span class="comment">        will add numbers at the end of the short/long names as required to</span></div>
<div class="line"><span class="comment">        make them unique.</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line">    LPCSTR paramName = NULL;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> varAsAttr = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (mShader)</div>
<div class="line">        varAsAttr = mShader-&gt;getVariableNameAsAttributeName();</div>
<div class="line"></div>
<div class="line">    LPCSTR uiName = NULL ;</div>
<div class="line">    <span class="keywordtype">bool</span> hasUIName = getAnnotation( dx11ShaderAnnotation::kUIName, uiName);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( varAsAttr || !hasUIName )</div>
<div class="line">        paramName = mDesc.Name;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        paramName = uiName;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">        If an integer parameter has a UIFieldNames annotation, then the</span></div>
<div class="line"><span class="comment">        annotation contents will be used to populate a dropdown menu when the</span></div>
<div class="line"><span class="comment">        parameter is shown in the attribute editor. The parameter type is</span></div>
<div class="line"><span class="comment">        changed from integer to enum.</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line">    LPCSTR uiFieldNames = NULL ;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> fieldNames;</div>
<div class="line">    <span class="keywordflow">if</span>(type == MUniformParameter::kTypeInt &amp;&amp; getAnnotation(dx11ShaderAnnotation::kUIFieldNames,uiFieldNames) &amp;&amp; uiFieldNames)</div>
<div class="line">    {</div>
<div class="line">        fieldNames = uiFieldNames;</div>
<div class="line">        type = MUniformParameter::kTypeEnum;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a name="_a3"></a><a class="code" href="#!/url=./cpp_ref/class_m_uniform_parameter.html">MUniformParameter</a> uniform( paramName, type, semantic, mDescType.Rows, mDescType.Columns, (<span class="keywordtype">void</span>*)mEffectVariable);</div>
<div class="line">    mParam = uniform;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If shader author has specified to use var as attribute name and provided a UIName, then</span></div>
<div class="line">    <span class="comment">// tell Maya to use the UIName for the attribute&#39;s &#39;Nice Name&#39;:</span></div>
<div class="line">    <span class="keywordflow">if</span> (varAsAttr &amp;&amp; hasUIName)</div>
<div class="line">        mParam.setUINiceName( uiName );</div>
<div class="line"></div>
<div class="line">    updateRangeFromAnnotation();</div>
<div class="line">    updateUIVisibilityFromAnnotation();</div>
<div class="line">    <span class="keywordflow">if</span> (fieldNames.<a name="a4"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#a580388f31f60c46fac867ca48a48da1e">length</a>())</div>
<div class="line">    {</div>
<div class="line">        mParam.setEnumFieldNames(fieldNames);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">        The UIOrder annotation can be used to make sure all parameters</span></div>
<div class="line"><span class="comment">        appear in a predictable sequence in the attribute editors even</span></div>
<div class="line"><span class="comment">        if the compiler decides to reorder them is the input block.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">        - The content of the annotation is an integer</span></div>
<div class="line"><span class="comment">        - Parameters will be sorted according to increasing values of</span></div>
<div class="line"><span class="comment">          UIOrder annotation</span></div>
<div class="line"><span class="comment">        - The sort is stable, so parameters with identical UIOrder will</span></div>
<div class="line"><span class="comment">          appear in the order the compiler outputs them (which is not as</span></div>
<div class="line"><span class="comment">          stable as the sort)</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line">    getAnnotation(dx11ShaderAnnotation::kUIOrder, mUIOrder);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// set keyable for visible attributes other than textures</span></div>
<div class="line">    mParam.setKeyable(!mParam.UIHidden() &amp;&amp; !mParam.isATexture());</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> result = setParameterValueFromEffect();</div>
<div class="line">    <span class="keywordflow">if</span>(result)</div>
<div class="line">    {</div>
<div class="line">        mValidUniformParameter = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">    This function tests for any annotation that can be used to</span></div>
<div class="line"><span class="comment">    control the visibility of a parameter:</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="keywordtype">void</span> CUniformParameterBuilder::updateUIVisibilityFromAnnotation()</div>
<div class="line">{</div>
<div class="line">    BOOL visible = TRUE;</div>
<div class="line">    <span class="keywordflow">if</span>( getBOOLAnnotation( dx11ShaderAnnotation::kSasUiVisible, visible))</div>
<div class="line">    {</div>
<div class="line">        mParam.setUIHidden(!visible);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        LPCSTR uiTypeValue = NULL;</div>
<div class="line">        <span class="keywordtype">bool</span>  foundUIType = getAnnotation( dx11ShaderAnnotation::kUIType,uiTypeValue);</div>
<div class="line">        <span class="keywordflow">if</span> (foundUIType &amp;&amp; !_stricmp(uiTypeValue, dx11ShaderAnnotationValue::kNone))</div>
<div class="line">        {</div>
<div class="line">            mParam.setUIHidden(<span class="keyword">true</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// As per NVidia SAS docs v1.0.3:</span></div>
<div class="line">        foundUIType = getAnnotation( dx11ShaderAnnotation::kUIWidget,uiTypeValue);</div>
<div class="line">        <span class="keywordflow">if</span> (foundUIType &amp;&amp; !_stricmp(uiTypeValue, dx11ShaderAnnotationValue::kNone))</div>
<div class="line">        {</div>
<div class="line">            mParam.setUIHidden(<span class="keyword">true</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">    These annotations can be used to control the numeric range of</span></div>
<div class="line"><span class="comment">    a slider. The hard min/max are defined as per documented standards,</span></div>
<div class="line"><span class="comment">    and we introduced the soft min/max notion to match the normal</span></div>
<div class="line"><span class="comment">    behavior of Maya attributes. A slider range will be limited to</span></div>
<div class="line"><span class="comment">    values between min and max, but the initial slider displayed in the</span></div>
<div class="line"><span class="comment">    UI will go from soft min to soft max.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="keywordtype">void</span> CUniformParameterBuilder::updateRangeFromAnnotation()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span>(mParam.type())</div>
<div class="line">    {</div>
<div class="line">    <span class="keywordflow">case</span> MUniformParameter::kTypeFloat:</div>
<div class="line">    <span class="keywordflow">case</span> MUniformParameter::kTypeInt:</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">float</span> uiMinFloat = NULL;</div>
<div class="line">            <span class="keywordflow">if</span>(getAnnotation( dx11ShaderAnnotation::kSasUiMin,uiMinFloat) ||</div>
<div class="line">               getAnnotation( dx11ShaderAnnotation::kUIMin,uiMinFloat) ||</div>
<div class="line">               getAnnotation( dx11ShaderAnnotation::kuimin,uiMinFloat) )</div>
<div class="line">            {</div>
<div class="line">                mParam.setRangeMin(uiMinFloat);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">float</span> uiMaxFloat = NULL;</div>
<div class="line">            <span class="keywordflow">if</span>(getAnnotation( dx11ShaderAnnotation::kSasUiMax,uiMaxFloat) ||</div>
<div class="line">               getAnnotation( dx11ShaderAnnotation::kUIMax,uiMaxFloat) ||</div>
<div class="line">               getAnnotation( dx11ShaderAnnotation::kuimax,uiMaxFloat) )</div>
<div class="line">            {</div>
<div class="line">                mParam.setRangeMax(uiMaxFloat);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">float</span> uiSoftMinFloat = NULL;</div>
<div class="line">            <span class="keywordflow">if</span>(getAnnotation( dx11ShaderAnnotation::kSasUiSoftMin,uiSoftMinFloat) ||</div>
<div class="line">               getAnnotation( dx11ShaderAnnotation::kUISoftMin,uiSoftMinFloat) ||</div>
<div class="line">               getAnnotation( dx11ShaderAnnotation::kuisoftmin,uiSoftMinFloat) )</div>
<div class="line">            {</div>
<div class="line">                mParam.setSoftRangeMin(uiSoftMinFloat);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">float</span> uiSoftMaxFloat = NULL;</div>
<div class="line">            <span class="keywordflow">if</span>(getAnnotation( dx11ShaderAnnotation::kSasUiSoftMax,uiSoftMaxFloat) ||</div>
<div class="line">               getAnnotation( dx11ShaderAnnotation::kUISoftMax,uiSoftMaxFloat) ||</div>
<div class="line">               getAnnotation( dx11ShaderAnnotation::kuisoftmax,uiSoftMaxFloat) )</div>
<div class="line">            {</div>
<div class="line">                mParam.setSoftRangeMax(uiSoftMaxFloat);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">    Here we retrieve the initial value for an effect parameter.</span></div>
<div class="line"><span class="comment">    This value will be set as the default value of the corresponding</span></div>
<div class="line"><span class="comment">    uniform parameter attribute and can be used to test if the</span></div>
<div class="line"><span class="comment">    current value of a parameter is different from the default or</span></div>
<div class="line"><span class="comment">    not.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="keywordtype">bool</span> CUniformParameterBuilder::setParameterValueFromEffect()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> length = getLength();</div>
<div class="line">    MUniformParameter::DataType type = mParam.type();</div>
<div class="line">    <span class="keywordflow">switch</span>( type )</div>
<div class="line">    {</div>
<div class="line">    <span class="keywordflow">case</span> MUniformParameter::kTypeFloat:</div>
<div class="line">        {</div>
<div class="line">            std::vector&lt;FLOAT&gt; values;</div>
<div class="line">            values.resize(length);</div>
<div class="line">            FLOAT* Value = &amp;values[0];</div>
<div class="line">            <span class="keywordflow">switch</span>(mDescType.Class)</div>
<div class="line">            {</div>
<div class="line">            <span class="keywordflow">case</span> D3D10_SVC_SCALAR:</div>
<div class="line">                mEffectVariable-&gt;AsScalar()-&gt;GetFloat( Value );</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> D3D10_SVC_VECTOR:</div>
<div class="line">                mEffectVariable-&gt;AsVector()-&gt;GetFloatVector( Value );</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> D3D10_SVC_MATRIX_COLUMNS:</div>
<div class="line">                mEffectVariable-&gt;AsMatrix()-&gt;GetMatrix( Value );</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> D3D10_SVC_MATRIX_ROWS:</div>
<div class="line">                mEffectVariable-&gt;AsMatrix()-&gt;GetMatrixTranspose( Value );</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">            };</div>
<div class="line"></div>
<div class="line">            mParam.setAsFloatArray( Value, length);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> MUniformParameter::kTypeString:</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (length==1)</div>
<div class="line">            {</div>
<div class="line">                LPCSTR Value;</div>
<div class="line">                <span class="keywordflow">if</span>( mEffectVariable-&gt;AsString()-&gt;GetString( &amp;Value) == S_OK)</div>
<div class="line">                {</div>
<div class="line">                    mParam.setAsString( <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>( Value));</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                logUnsupportedTypeWarning(dx11ShaderStrings::kTypeStringVector);</div>
<div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> MUniformParameter::kTypeBool:</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (length==1)</div>
<div class="line">            {</div>
<div class="line"><span class="preprocessor">#if defined(USE_BOOL)</span></div>
<div class="line">                BOOL Value;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">                <span class="keywordtype">bool</span> Value;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">                <span class="keywordflow">if</span>( mEffectVariable-&gt;AsScalar()-&gt;GetBool( &amp;Value) == S_OK)</div>
<div class="line">                {</div>
<div class="line">                    mParam.setAsBool( Value ? <span class="keyword">true</span> : <span class="keyword">false</span>);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                logUnsupportedTypeWarning(dx11ShaderStrings::kTypeBoolVector);</div>
<div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> MUniformParameter::kTypeInt:</div>
<div class="line">    <span class="keywordflow">case</span> MUniformParameter::kTypeEnum:</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (length==1)</div>
<div class="line">            {</div>
<div class="line">                INT Value;</div>
<div class="line">                <span class="keywordflow">if</span>( mEffectVariable-&gt;AsScalar()-&gt;GetInt( &amp;Value) == S_OK)</div>
<div class="line">                {</div>
<div class="line">                    mParam.setAsInt( Value);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                logUnsupportedTypeWarning(dx11ShaderStrings::kTypeIntVector);</div>
<div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">if</span>( type &gt;= MUniformParameter::kType1DTexture &amp;&amp; type &lt;= MUniformParameter::kTypeEnvTexture)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// We have a texture name but no resource view. Try and load in</span></div>
<div class="line">            <span class="comment">// a new texture and get a new resource view.</span></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> textureFile;</div>
<div class="line">            LPCSTR resource;</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> paramName = mParam.name();</div>
<div class="line">            <span class="keywordflow">if</span>( mShader-&gt;getTextureFile( paramName, textureFile ) )</div>
<div class="line">            {</div>
<div class="line">                mParam.setAsString( textureFile );</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( getAnnotation( dx11ShaderAnnotation::kResourceName, resource) &amp;&amp; *resource)</div>
<div class="line">            {</div>
<div class="line">                mParam.setAsString( mShader-&gt;findResource( <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>( resource), CDX11EffectCompileHelper::resolveShaderFileName(mShader-&gt;effectName()) ));</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( getAnnotation( dx11ShaderAnnotation::kSasResourceAddress, resource) &amp;&amp; *resource)</div>
<div class="line">            {</div>
<div class="line">                mParam.setAsString( mShader-&gt;findResource( <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>( resource), CDX11EffectCompileHelper::resolveShaderFileName(mShader-&gt;effectName()) ));</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">MUniformParameter::DataType CUniformParameterBuilder::convertType()</div>
<div class="line">{</div>
<div class="line">    MUniformParameter::DataType     paramType = MUniformParameter::kTypeUnknown;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span>( mDescType.Type) {</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_BOOL:            paramType = MUniformParameter::kTypeBool;   <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_INT:             paramType = MUniformParameter::kTypeInt;    <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_FLOAT:           paramType = MUniformParameter::kTypeFloat;  <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_STRING:          paramType = MUniformParameter::kTypeString; <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_UINT:            paramType = MUniformParameter::kTypeInt;    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_UINT8:</div>
<div class="line">        logUnsupportedTypeWarning(dx11ShaderStrings::kTypeIntUInt8);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_DOUBLE:</div>
<div class="line">        logUnsupportedTypeWarning(dx11ShaderStrings::kTypeDouble);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_RWTEXTURE1D:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_TEXTURE1D:           paramType = MUniformParameter::kType1DTexture;      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_RWTEXTURE2D:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_TEXTURE2D:           paramType = MUniformParameter::kType2DTexture;      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_RWTEXTURE3D:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_TEXTURE3D:           paramType = MUniformParameter::kType3DTexture;      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_TEXTURECUBE:         paramType = MUniformParameter::kTypeCubeTexture;    <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_TEXTURE:</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// The shader hasn&#39;t used a typed texture, so first see if there&#39;s an annotation</span></div>
<div class="line">            <span class="comment">// that tells us which type to use.</span></div>
<div class="line">            <span class="comment">// -------------------------------------</span></div>
<div class="line">            LPCSTR  textureType;</div>
<div class="line">            <span class="keywordflow">if</span>( ( getAnnotation( dx11ShaderAnnotation::kTextureType, textureType) || getAnnotation( dx11ShaderAnnotation::kResourceType, textureType)) &amp;&amp; textureType) {</div>
<div class="line">                <span class="comment">// Grab the type off from the annotation</span></div>
<div class="line">                <span class="comment">// -------------------------------------</span></div>
<div class="line">                <span class="keywordflow">if</span>( !_stricmp( textureType, dx11ShaderAnnotationValue::k1D)) paramType = MUniformParameter::kType1DTexture;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( textureType, dx11ShaderAnnotationValue::k2D)) paramType = MUniformParameter::kType2DTexture;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( textureType, dx11ShaderAnnotationValue::k3D)) paramType = MUniformParameter::kType3DTexture;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( textureType, dx11ShaderAnnotationValue::kCube)) paramType = MUniformParameter::kTypeCubeTexture;</div>
<div class="line">                <span class="keywordflow">else</span> {</div>
<div class="line">                    <a name="_a5"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> args;</div>
<div class="line">                    args.<a name="a6"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(textureType);</div>
<div class="line">                    args.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(mDesc.Name);</div>
<div class="line"></div>
<div class="line">                    mWarnings += dx11ShaderStrings::getString( dx11ShaderStrings::kUnknownTextureSemantic, args );</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span>( paramType == MUniformParameter::kTypeUnknown) {</div>
<div class="line">                <span class="comment">// No explicit type. At this stage, it would be nice to take a look at the</span></div>
<div class="line">                <span class="comment">// sampler which uses the texture and grab the type of that, but I can&#39;t see</span></div>
<div class="line">                <span class="comment">// any way to query for the sampler -&gt; texture bindings through the effect</span></div>
<div class="line">                <span class="comment">// API.</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                paramType = MUniformParameter::kType2DTexture;</div>
<div class="line">                mWarnings += dx11ShaderStrings::getString( dx11ShaderStrings::kNoTextureType, mDesc.Name );</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        }</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_TEXTURE1DARRAY:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_TEXTURE2DARRAY:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_TEXTURE2DMS:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_TEXTURE2DMSARRAY:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_TEXTURECUBEARRAY:</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_RWTEXTURE1DARRAY:</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_RWTEXTURE2DARRAY:</div>
<div class="line">        logUnsupportedTypeWarning(dx11ShaderStrings::kTypeTextureArray);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_VOID:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_SAMPLER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_PIXELSHADER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_VERTEXSHADER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_GEOMETRYSHADER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_RASTERIZER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_DEPTHSTENCIL:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_BLEND:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_BUFFER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_CBUFFER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_TBUFFER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_HULLSHADER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_DOMAINSHADER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_INTERFACE_POINTER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_COMPUTESHADER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_BYTEADDRESS_BUFFER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_RWBYTEADDRESS_BUFFER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_STRUCTURED_BUFFER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_RWSTRUCTURED_BUFFER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_APPEND_STRUCTURED_BUFFER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_CONSUME_STRUCTURED_BUFFER:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_RENDERTARGETVIEW:</div>
<div class="line">    <span class="keywordflow">case</span> D3D10_SVT_DEPTHSTENCILVIEW:</div>
<div class="line">    <span class="keywordflow">case</span> D3D11_SVT_RWBUFFER:</div>
<div class="line">        <span class="comment">// ignored variable definitions</span></div>
<div class="line">        <span class="comment">// ------------------------------</span></div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> paramType;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Convert a DX space into a Maya space</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">MUniformParameter::DataSemantic CUniformParameterBuilder::convertSpace( MUniformParameter::DataSemantic defaultSpace)</div>
<div class="line">{</div>
<div class="line">    MUniformParameter::DataSemantic space = MUniformParameter::kSemanticUnknown;</div>
<div class="line"></div>
<div class="line">    LPCSTR ann;</div>
<div class="line">    <span class="keywordflow">if</span>( getAnnotation( dx11ShaderAnnotation::kSpace, ann) &amp;&amp; ann)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>( !_stricmp( ann, dx11ShaderAnnotationValue::kObject))        space = defaultSpace &gt;= MUniformParameter::kSemanticObjectPos ? MUniformParameter::kSemanticObjectPos   : MUniformParameter::kSemanticObjectDir;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( ann, dx11ShaderAnnotationValue::kWorld))    space = defaultSpace &gt;= MUniformParameter::kSemanticObjectPos ? MUniformParameter::kSemanticWorldPos    : MUniformParameter::kSemanticWorldDir;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( ann, dx11ShaderAnnotationValue::kView))     space = defaultSpace &gt;= MUniformParameter::kSemanticObjectPos ? MUniformParameter::kSemanticViewPos     : MUniformParameter::kSemanticViewDir;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( ann, dx11ShaderAnnotationValue::kCamera))   space = defaultSpace &gt;= MUniformParameter::kSemanticObjectPos ? MUniformParameter::kSemanticViewPos     : MUniformParameter::kSemanticViewDir;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> args;</div>
<div class="line">            args.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(ann);</div>
<div class="line">            args.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(mDesc.Name);</div>
<div class="line"></div>
<div class="line">            mWarnings += dx11ShaderStrings::getString( dx11ShaderStrings::kUnknowSpace, args );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> space;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Convert a DX semantic into a Maya semantic</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">MUniformParameter::DataSemantic CUniformParameterBuilder::convertSemantic( )</div>
<div class="line">{</div>
<div class="line">    MUniformParameter::DataSemantic paramSemantic = MUniformParameter::kSemanticUnknown;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// @@@@ maybe useful to validate</span></div>
<div class="line">    <span class="comment">// MHWRender::MShaderManager::isSupportedShaderSemantic( semantic );</span></div>
<div class="line">    <span class="comment">// Convert all semantics to lower case for faster</span></div>
<div class="line">    <span class="comment">// mtype = MHWRender::MFrameContext::semanticToMatrixType( semantic, &amp;status );</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// First try the explicit semantic</span></div>
<div class="line">    <span class="keywordflow">if</span>( mDesc.Semantic)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(      !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kWorld))                                paramSemantic = MUniformParameter::kSemanticWorldMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kWorldTranspose))                       paramSemantic = MUniformParameter::kSemanticWorldTransposeMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kWorldInverse))                         paramSemantic = MUniformParameter::kSemanticWorldInverseMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kWorldInverseTranspose))                paramSemantic = MUniformParameter::kSemanticWorldInverseTransposeMatrix;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kView))                                 paramSemantic = MUniformParameter::kSemanticViewMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kViewTranspose))                        paramSemantic = MUniformParameter::kSemanticViewTransposeMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kViewInverse))                          paramSemantic = MUniformParameter::kSemanticViewInverseMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kViewInverseTranspose))                 paramSemantic = MUniformParameter::kSemanticViewInverseTransposeMatrix;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kProjection))                           paramSemantic = MUniformParameter::kSemanticProjectionMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kProjectionTranspose))                  paramSemantic = MUniformParameter::kSemanticProjectionTransposeMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kProjectionInverse))                    paramSemantic = MUniformParameter::kSemanticProjectionInverseMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kProjectionInverseTranspose))           paramSemantic = MUniformParameter::kSemanticProjectionInverseTransposeMatrix;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kWorldView))                            paramSemantic = MUniformParameter::kSemanticWorldViewMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kWorldViewTranspose))                   paramSemantic = MUniformParameter::kSemanticWorldViewTransposeMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kWorldViewInverse))                     paramSemantic = MUniformParameter::kSemanticWorldViewInverseMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kWorldViewInverseTranspose))            paramSemantic = MUniformParameter::kSemanticWorldViewInverseTransposeMatrix;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kViewProjection))                       paramSemantic = MUniformParameter::kSemanticViewProjectionMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kViewProjectionTranspose))              paramSemantic = MUniformParameter::kSemanticViewProjectionTransposeMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kViewProjectionInverse))                paramSemantic = MUniformParameter::kSemanticViewProjectionInverseMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kViewProjectionInverseTranspose))       paramSemantic = MUniformParameter::kSemanticViewProjectionInverseTransposeMatrix;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kWorldViewProjection))                  paramSemantic = MUniformParameter::kSemanticWorldViewProjectionMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kWorldViewProjectionTranspose))         paramSemantic = MUniformParameter::kSemanticWorldViewProjectionTransposeMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kWorldViewProjectionInverse))           paramSemantic = MUniformParameter::kSemanticWorldViewProjectionInverseMatrix;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kWorldViewProjectionInverseTranspose))  paramSemantic = MUniformParameter::kSemanticWorldViewProjectionInverseTransposeMatrix;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kViewDirection))                        paramSemantic = MUniformParameter::kSemanticViewDir;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kViewPosition))                         paramSemantic = MUniformParameter::kSemanticViewPos;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kLocalViewer))                          paramSemantic = MUniformParameter::kSemanticLocalViewer;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kViewportPixelSize))                    paramSemantic = MUniformParameter::kSemanticViewportPixelSize;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kBackgroundColor))                      paramSemantic = MUniformParameter::kSemanticBackgroundColor;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kFrame))                                paramSemantic = MUniformParameter::kSemanticFrameNumber;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kFrameNumber))                          paramSemantic = MUniformParameter::kSemanticFrameNumber;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kAnimationTime))                        paramSemantic = MUniformParameter::kSemanticTime;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kTime))                                 paramSemantic = MUniformParameter::kSemanticTime;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kNearClipPlane))                        paramSemantic = MUniformParameter::kSemanticNearClipPlane;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kFarClipPlane))                         paramSemantic = MUniformParameter::kSemanticFarClipPlane;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kColor))                                paramSemantic = MUniformParameter::kSemanticColor;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kLightColor))                           paramSemantic = MUniformParameter::kSemanticColor;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kAmbient))                              paramSemantic = MUniformParameter::kSemanticColor;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kLightAmbientColor))                    paramSemantic = MUniformParameter::kSemanticColor;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kSpecular))                             paramSemantic = MUniformParameter::kSemanticColor;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kLightSpecularColor))                   paramSemantic = MUniformParameter::kSemanticColor;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kDiffuse))                              paramSemantic = MUniformParameter::kSemanticColor;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kNormal))                               paramSemantic = MUniformParameter::kSemanticNormal;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kBump))                                 paramSemantic = MUniformParameter::kSemanticBump;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kEnvironment))                          paramSemantic = MUniformParameter::kSemanticEnvironment;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kPosition))                             paramSemantic = convertSpace( MUniformParameter::kSemanticWorldPos);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kAreaPosition0))                        paramSemantic = convertSpace( MUniformParameter::kSemanticWorldPos);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kAreaPosition1))                        paramSemantic = convertSpace( MUniformParameter::kSemanticWorldPos);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kAreaPosition2))                        paramSemantic = convertSpace( MUniformParameter::kSemanticWorldPos);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kAreaPosition3))                        paramSemantic = convertSpace( MUniformParameter::kSemanticWorldPos);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kDirection))                            paramSemantic = convertSpace( MUniformParameter::kSemanticViewDir);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kShadowMap))                            paramSemantic = MUniformParameter::kSemanticColorTexture;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kShadowColor))                          paramSemantic = MUniformParameter::kSemanticColor;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kShadowFlag))                           paramSemantic = MUniformParameter::kSemanticUnknown;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kShadowMapBias))                        paramSemantic = MUniformParameter::kSemanticUnknown;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kShadowMapMatrix))                      paramSemantic = MUniformParameter::kSemanticUnknown;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kShadowMapXForm))                       paramSemantic = MUniformParameter::kSemanticUnknown;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kStandardsGlobal))                      paramSemantic = MUniformParameter::kSemanticUnknown;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kTranspDepthTexture))                   paramSemantic = MUniformParameter::kSemanticTranspDepthTexture;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kOpaqueDepthTexture))                   paramSemantic = MUniformParameter::kSemanticOpaqueDepthTexture;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kHwSelectionPrimitiveBase))             paramSemantic = MUniformParameter::kSemanticHWSPrimitiveBase;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kHwSelectionPrimitiveCountPerInstance)) paramSemantic = MUniformParameter::kSemanticHWSPrimitiveCountPerInstance;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kHwSelectionObjectLevel))               paramSemantic = MUniformParameter::kSemanticHWSObjectLevel;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kHwSelectionFaceLevel))                 paramSemantic = MUniformParameter::kSemanticHWSFaceLevel;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kHwSelectionEdgeLevel))                 paramSemantic = MUniformParameter::kSemanticHWSEdgeLevel;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kHwSelectionVertexLevel))               paramSemantic = MUniformParameter::kSemanticHWSVertexLevel;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kHwSelectionOccluder))                  paramSemantic = MUniformParameter::kSemanticHWSOccluder;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kHwSelectionFrontCCW))                  paramSemantic = MUniformParameter::kSemanticHWSFrontCCW;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kHwSelectionInstancedDraw))             paramSemantic = MUniformParameter::kSemanticHWSInstancedDraw;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kHwSelectionHighlighting))              paramSemantic = MUniformParameter::kSemanticHWSHighlighting;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            logUnrecognisedSemantic(mDesc.Semantic);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Next, try annotation semantic</span></div>
<div class="line">    <span class="keywordflow">if</span>( paramSemantic == MUniformParameter::kSemanticUnknown)</div>
<div class="line">    {</div>
<div class="line">        LPCSTR sasSemantic;</div>
<div class="line">        <span class="keywordflow">if</span>( getAnnotation( dx11ShaderAnnotation::kSasBindAddress, sasSemantic) &amp;&amp; sasSemantic &amp;&amp; *sasSemantic)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> str( sasSemantic);</div>
<div class="line">            <span class="keywordflow">if</span>(      !_stricmp( sasSemantic, dx11ShaderAnnotationValue::kSas_Skeleton_MeshToJointToWorld_0_))   paramSemantic = MUniformParameter::kSemanticWorldMatrix;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( sasSemantic, dx11ShaderAnnotationValue::kSas_Camera_WorldToView))               paramSemantic = MUniformParameter::kSemanticViewMatrix;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( sasSemantic, dx11ShaderAnnotationValue::kSas_Camera_Projection))                paramSemantic = MUniformParameter::kSemanticProjectionMatrix;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( sasSemantic, dx11ShaderAnnotationValue::kSas_Time_Now))                         paramSemantic = MUniformParameter::kSemanticTime;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( str.rindexW( dx11ShaderAnnotationValue::k_Position) &gt;= 0)                                  paramSemantic = convertSpace( MUniformParameter::kSemanticWorldPos);</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( str.rindexW( dx11ShaderAnnotationValue::k_Direction) &gt;= 0 &amp;&amp;</div>
<div class="line">                     str.rindexW( dx11ShaderAnnotationValue::k_Direction) != str.rindexW( dx11ShaderAnnotationValue::k_Directional))    paramSemantic = convertSpace( MUniformParameter::kSemanticViewDir);</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                logUnrecognisedSemantic(sasSemantic);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Next try control type</span></div>
<div class="line">    <span class="keywordflow">if</span>( paramSemantic == MUniformParameter::kSemanticUnknown)</div>
<div class="line">    {</div>
<div class="line">        LPCSTR sasSemantic;</div>
<div class="line">        <span class="keywordflow">if</span>( (getAnnotation( dx11ShaderAnnotation::kSasUiControl, sasSemantic) || getAnnotation( dx11ShaderAnnotation::kUIWidget, sasSemantic)) &amp;&amp; *sasSemantic)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span>( !_stricmp( sasSemantic, dx11ShaderAnnotationValue::kColorPicker))                           paramSemantic = MUniformParameter::kSemanticColor;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// As a last ditch effort, look for an obvious parameter name</span></div>
<div class="line">    <span class="keywordflow">if</span>( paramSemantic == MUniformParameter::kSemanticUnknown &amp;&amp; !mDesc.Semantic &amp;&amp;</div>
<div class="line">        mDescType.Class == D3D_SVC_VECTOR &amp;&amp; (mDescType.Type == D3D_SVT_FLOAT || mDescType.Type == D3D_SVT_DOUBLE) &amp;&amp;</div>
<div class="line">        mDescType.Rows == 1 &amp;&amp; mDescType.Columns &gt;= 3 &amp;&amp; mDescType.Columns &lt;= 4 )</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> name( mDesc.Name);</div>
<div class="line">        <span class="keywordflow">if</span>(      name.rindexW( dx11ShaderAnnotationValue::kPosition) &gt;= 0)                              paramSemantic = convertSpace( MUniformParameter::kSemanticWorldPos);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( name.rindexW( dx11ShaderAnnotationValue::kDirection) &gt;= 0 &amp;&amp;</div>
<div class="line">                 name.rindexW( dx11ShaderAnnotationValue::kDirection) != name.rindexW( dx11ShaderAnnotationValue::kDirectional))    paramSemantic = convertSpace(  MUniformParameter::kSemanticWorldDir);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( name.rindexW( dx11ShaderAnnotationValue::kColor) &gt;= 0 ||</div>
<div class="line">                 name.rindexW( dx11ShaderAnnotationValue::kColour) &gt;= 0 ||</div>
<div class="line">                 name.rindexW( dx11ShaderAnnotationValue::kDiffuse) &gt;= 0 ||</div>
<div class="line">                 name.rindexW( dx11ShaderAnnotationValue::kSpecular) &gt;= 0 ||</div>
<div class="line">                 name.rindexW( dx11ShaderAnnotationValue::kAmbient) &gt;= 0)                               paramSemantic = MUniformParameter::kSemanticColor;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> paramSemantic;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">    Here we find light specific semantics on parameters. This will be used</span></div>
<div class="line"><span class="comment">    to properly transfer values from a Maya light to the effect. Parameters</span></div>
<div class="line"><span class="comment">    that have semantics that are not light-like will get the light type</span></div>
<div class="line"><span class="comment">    eNotALight and will not participate in light related code paths.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    We also try to detect the light type that best match this parameter based</span></div>
<div class="line"><span class="comment">    on a substring match for point/spot/directional/ambient strings. We can also</span></div>
<div class="line"><span class="comment">    deduce the light type from extremely specialized semantics like cone angle and</span></div>
<div class="line"><span class="comment">    falloff for a spot light or LP0 for an area light.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    We finally try to group light parameters together into a single logical light</span></div>
<div class="line"><span class="comment">    group using either an &quot;Object&quot; annotation or a substring of the parameter name.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    The light group name is one of:</span></div>
<div class="line"><span class="comment">        - The string value of the &quot;Object&quot; annotation</span></div>
<div class="line"><span class="comment">        - The prefix part of a parameter name that contains either &quot;Light&quot;, &quot;light&quot;,</span></div>
<div class="line"><span class="comment">           or a number:</span></div>
<div class="line"><span class="comment">                DirectionalLightColor  -&gt;   DirectionalLight</span></div>
<div class="line"><span class="comment">                scene_light_position   -&gt;   scene_light</span></div>
<div class="line"><span class="comment">                Lamp0Color             -&gt;   Lamp0</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    - All light parameters that share a common light group name will be grouped together</span></div>
<div class="line"><span class="comment">        into a single logical light</span></div>
<div class="line"><span class="comment">    - When a logical light is bound to a scene light, all parameter values will be</span></div>
<div class="line"><span class="comment">        transferred in block from the scene light to the logical light</span></div>
<div class="line"><span class="comment">    - The Attribute Editor will show one extra control per logical light that will allow</span></div>
<div class="line"><span class="comment">        to quickly specify how this logical light should be handled by Maya. Options are</span></div>
<div class="line"><span class="comment">        to explicitely bind a scene light, allow automatic binding to any compatible scene</span></div>
<div class="line"><span class="comment">        light, or ignore scene lights and use values stored in the effect parameters.</span></div>
<div class="line"><span class="comment">    - The Attribute Editor will also group all light parameters in separate panels as if</span></div>
<div class="line"><span class="comment">        they were grouped using the UIGroup annotation. See comments on UIGroup annotation</span></div>
<div class="line"><span class="comment">        for more details.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="keywordtype">void</span> CUniformParameterBuilder::updateLightInfoFromSemantic()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//Check for light type from object type</span></div>
<div class="line">    LPCSTR objectType;</div>
<div class="line">    <span class="keywordflow">if</span>( getAnnotation( dx11ShaderAnnotation::kObject, objectType) &amp;&amp; *objectType)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> objectAnnotation(objectType);</div>
<div class="line">        mLightIndex = mShader-&gt;getIndexForLightName(objectAnnotation, <span class="keyword">true</span>);</div>
<div class="line">        mUIGroupIndex = mShader-&gt;getIndexForUIGroupName(objectAnnotation, <span class="keyword">true</span>);</div>
<div class="line">        <span class="keywordflow">if</span>(objectAnnotation.rindexW(dx11ShaderAnnotationValue::kLight) &gt;= 0 || objectAnnotation.rindexW(dx11ShaderAnnotationValue::kLamp) &gt;= 0)</div>
<div class="line">        {</div>
<div class="line">            mLightType = eUndefinedLight;</div>
<div class="line">            <span class="keywordflow">if</span>(objectAnnotation.rindexW(dx11ShaderAnnotationValue::kPoint) &gt;= 0)</div>
<div class="line">            {</div>
<div class="line">                mLightType = ePointLight;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(objectAnnotation.rindexW(dx11ShaderAnnotationValue::kSpot) &gt;= 0)</div>
<div class="line">            {</div>
<div class="line">                mLightType = eSpotLight;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(objectAnnotation.rindexW(dx11ShaderAnnotationValue::kDirectional) &gt;= 0)</div>
<div class="line">            {</div>
<div class="line">                mLightType = eDirectionalLight;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(objectAnnotation.rindexW(dx11ShaderAnnotationValue::kAmbient) &gt;= 0)</div>
<div class="line">            {</div>
<div class="line">                mLightType = eAmbientLight;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( mDesc.Semantic)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> name( mDesc.Name);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kLightColor))</div>
<div class="line">        {</div>
<div class="line">            mParamType = eLightColor;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kLightEnable))</div>
<div class="line">        {</div>
<div class="line">            mParamType = eLightEnable;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kLightIntensity))</div>
<div class="line">        {</div>
<div class="line">            mParamType = eLightIntensity;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kLightFalloff) ||</div>
<div class="line">                 !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kFalloff))</div>
<div class="line">        {</div>
<div class="line">            mLightType = eSpotLight;</div>
<div class="line">            mParamType = eLightFalloff;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!_stricmp( mDesc.Semantic, dx11ShaderSemantic::kLightDiffuseColor))</div>
<div class="line">        {</div>
<div class="line">            mParamType = eLightDiffuseColor;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!_stricmp( mDesc.Semantic, dx11ShaderSemantic::kLightAmbientColor))</div>
<div class="line">        {</div>
<div class="line">            mParamType = eLightAmbientColor;</div>
<div class="line">            mLightType = eAmbientLight;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!_stricmp( mDesc.Semantic, dx11ShaderSemantic::kLightSpecularColor))</div>
<div class="line">        {</div>
<div class="line">            mParamType = eLightSpecularColor;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!_stricmp( mDesc.Semantic, dx11ShaderSemantic::kShadowMap))</div>
<div class="line">        {</div>
<div class="line">            mParamType = eLightShadowMap;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!_stricmp( mDesc.Semantic, dx11ShaderSemantic::kShadowMapBias))</div>
<div class="line">        {</div>
<div class="line">            mParamType = eLightShadowMapBias;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!_stricmp( mDesc.Semantic, dx11ShaderSemantic::kShadowFlag))</div>
<div class="line">        {</div>
<div class="line">            mParamType = eLightShadowOn;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!_stricmp( mDesc.Semantic, dx11ShaderSemantic::kShadowMapMatrix) ||</div>
<div class="line">                 !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kShadowMapXForm))</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">//View transformation matrix of the light</span></div>
<div class="line">            mParamType = eLightShadowViewProj;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!_stricmp( mDesc.Semantic, dx11ShaderSemantic::kShadowColor))</div>
<div class="line">        {</div>
<div class="line">            mParamType = eLightShadowColor;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!_stricmp( mDesc.Semantic, dx11ShaderSemantic::kHotspot))</div>
<div class="line">        {</div>
<div class="line">            mParamType = eLightHotspot;</div>
<div class="line">            mLightType = eSpotLight;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!_stricmp( mDesc.Semantic, dx11ShaderSemantic::kLightType))</div>
<div class="line">        {</div>
<div class="line">            mParamType = eLightType;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!_stricmp( mDesc.Semantic, dx11ShaderSemantic::kDecayRate))</div>
<div class="line">        {</div>
<div class="line">            mParamType = eDecayRate;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">bool</span> isLight = (mLightType != eNotLight || findSubstring(name, <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>(dx11ShaderAnnotationValue::kLight)) &gt;= 0);</div>
<div class="line">            <span class="keywordflow">if</span>(isLight)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kPosition))</div>
<div class="line">                {</div>
<div class="line">                    mParamType = eLightPosition;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kAreaPosition0))</div>
<div class="line">                {</div>
<div class="line">                    mParamType = eLightAreaPosition0;</div>
<div class="line">                    mLightType = eAreaLight;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kAreaPosition1))</div>
<div class="line">                {</div>
<div class="line">                    mParamType = eLightAreaPosition1;</div>
<div class="line">                    mLightType = eAreaLight;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kAreaPosition2))</div>
<div class="line">                {</div>
<div class="line">                    mParamType = eLightAreaPosition2;</div>
<div class="line">                    mLightType = eAreaLight;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kAreaPosition3))</div>
<div class="line">                {</div>
<div class="line">                    mParamType = eLightAreaPosition3;</div>
<div class="line">                    mLightType = eAreaLight;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kDirection))</div>
<div class="line">                {</div>
<div class="line">                    mParamType = eLightDirection;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kColor))</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">//</span></div>
<div class="line">                    mParamType = eLightColor;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kAmbient))</div>
<div class="line">                {</div>
<div class="line">                    mParamType = eLightAmbientColor;</div>
<div class="line">                    mLightType = eAmbientLight;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kDiffuse))</div>
<div class="line">                {</div>
<div class="line">                    mParamType = eLightDiffuseColor;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !_stricmp( mDesc.Semantic, dx11ShaderSemantic::kSpecular))</div>
<div class="line">                {</div>
<div class="line">                    mParamType = eLightSpecularColor;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">//Compute light index</span></div>
<div class="line">        <span class="keywordflow">if</span>(mParamType != eUndefined &amp;&amp; mLightIndex ==  -1)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">//Check object semantic for index</span></div>
<div class="line">            <span class="comment">//Check name for index</span></div>
<div class="line">            <span class="keywordflow">if</span>(mLightType == eNotLight)</div>
<div class="line">            {</div>
<div class="line">                mLightType = eUndefinedLight;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">char</span>* objectName = name.asChar();</div>
<div class="line">            <span class="keywordtype">int</span> truncationPos = -1;</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">int</span> lightPos = findSubstring(name, <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>(dx11ShaderAnnotationValue::kLight));</div>
<div class="line">            <span class="keywordflow">if</span> (lightPos &gt;= 0)</div>
<div class="line">                truncationPos = lightPos + 5;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span>(truncationPos &lt; 0)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// last effort, see if there is any digit in the parameter name:</span></div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> digitPos = 0;</div>
<div class="line">                <span class="keywordflow">for</span> ( ; digitPos &lt; name.numChars(); ++digitPos)</div>
<div class="line">                    <span class="keywordflow">if</span> ( isdigit(objectName[digitPos]) )</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">if</span> ( digitPos &lt; name.numChars() )</div>
<div class="line">                    truncationPos = digitPos;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (truncationPos &gt;= 0)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Need to also skip any digits found after the &quot;light&quot;</span></div>
<div class="line">                <span class="keywordtype">int</span> maxChars = int(name.numChars());</div>
<div class="line">                <span class="keywordflow">while</span> (truncationPos &lt; maxChars &amp;&amp; isdigit(objectName[truncationPos]))</div>
<div class="line">                    truncationPos++;</div>
<div class="line"></div>
<div class="line">                mLightIndex = mShader-&gt;getIndexForLightName(name.substring(0,truncationPos-1), <span class="keyword">true</span>);</div>
<div class="line">                mUIGroupIndex = mShader-&gt;getIndexForUIGroupName(name.substring(0,truncationPos-1), <span class="keyword">true</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Get semantic string back from enum:</span></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>&amp; CUniformParameterBuilder::getLightParameterSemantic(<span class="keywordtype">int</span> lightParameterType) {</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (lightParameterType &lt; 0 || lightParameterType &gt;= eLastParameterType)</div>
<div class="line">        lightParameterType = eUndefined;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> semanticNames;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!semanticNames.<a name="a7"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>()) {</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kUndefined);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kPosition);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kDirection);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kLightColor);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kLightSpecularColor);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kLightAmbientColor);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kLightDiffuseColor);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kLightRange);          <span class="comment">// Not recognized!</span></div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kFalloff);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kLightAttenuation0);   <span class="comment">// Not recognized!</span></div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kLightAttenuation1);   <span class="comment">// Not recognized!</span></div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kLightAttenuation2);   <span class="comment">// Not recognized!</span></div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kLightTheta);   <span class="comment">// Not recognized!</span></div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kLightPhi);   <span class="comment">// Not recognized!</span></div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kShadowMap);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kShadowMapBias);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kShadowColor);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kShadowMapMatrix);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kShadowFlag);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kLightIntensity);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kHotspot);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kLightEnable);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kLightType);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kDecayRate);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kAreaPosition0);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kAreaPosition1);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kAreaPosition2);</div>
<div class="line">        semanticNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(dx11ShaderSemantic::kAreaPosition3);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> semanticNames[lightParameterType];</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">ID3DX11EffectVariable* CUniformParameterBuilder::findAnnotationByName(ID3DX11EffectVariable *effectVariable, <span class="keyword">const</span> <span class="keywordtype">char</span>* name)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// The latest effect 11 library is very verbose when an annotation</span></div>
<div class="line">    <span class="comment">// is not found by name. This version will stay quiet if the</span></div>
<div class="line">    <span class="comment">// annotation is not found.</span></div>
<div class="line">    <span class="keywordflow">if</span> (mAnnotationIndex.empty())</div>
<div class="line">    {</div>
<div class="line">        D3DX11_EFFECT_VARIABLE_DESC varDesc;</div>
<div class="line">        effectVariable-&gt;GetDesc(&amp;varDesc);</div>
<div class="line">        <span class="keywordflow">for</span> (uint32_t idx = 0; idx &lt; varDesc.Annotations; ++idx)</div>
<div class="line">        {</div>
<div class="line">            ID3DX11EffectVariable* var = effectVariable-&gt;GetAnnotationByIndex(idx);</div>
<div class="line">            <span class="keywordflow">if</span> (var)</div>
<div class="line">            {</div>
<div class="line">                D3DX11_EFFECT_VARIABLE_DESC varDesc;</div>
<div class="line">                var-&gt;GetDesc(&amp;varDesc);</div>
<div class="line">                mAnnotationIndex.<a name="a8"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a3db31367f989449bb9b121cd734dc0df">insert</a>(TAnnotationIndex::value_type(std::string(varDesc.Name), idx));</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        mAnnotationIndex.insert(TAnnotationIndex::value_type(std::string(<span class="stringliteral">&quot;Done!&quot;</span>), 0));</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    TAnnotationIndex::const_iterator index = mAnnotationIndex.find(std::string(name));</div>
<div class="line">    <span class="keywordflow">if</span> (index != mAnnotationIndex.end())</div>
<div class="line">        <span class="keywordflow">return</span> effectVariable-&gt;GetAnnotationByIndex((*index).second);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> CUniformParameterBuilder::getAnnotation(<span class="keyword">const</span> <span class="keywordtype">char</span>* name,LPCSTR&amp; value)</div>
<div class="line">{</div>
<div class="line">    ID3DX11EffectVariable* annotationVariable= findAnnotationByName(mEffectVariable, name);</div>
<div class="line">    <span class="keywordflow">if</span> (annotationVariable) {</div>
<div class="line">        <span class="keywordflow">if</span> (annotationVariable-&gt;AsString()-&gt;GetString(&amp;value)==S_OK) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> CUniformParameterBuilder::getAnnotation(<span class="keyword">const</span> <span class="keywordtype">char</span>* name,<span class="keywordtype">float</span>&amp; value)</div>
<div class="line">{</div>
<div class="line">    ID3DX11EffectVariable* annotationVariable= findAnnotationByName(mEffectVariable, name);</div>
<div class="line">    <span class="keywordflow">if</span> (annotationVariable) {</div>
<div class="line">        <span class="keywordflow">if</span> (annotationVariable-&gt;AsScalar()-&gt;GetFloat(&amp;value)==S_OK) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> CUniformParameterBuilder::getAnnotation(<span class="keyword">const</span> <span class="keywordtype">char</span>* name,<span class="keywordtype">int</span>&amp; value)</div>
<div class="line">{</div>
<div class="line">    ID3DX11EffectVariable* annotationVariable= findAnnotationByName(mEffectVariable, name);</div>
<div class="line">    <span class="keywordflow">if</span> (annotationVariable) {</div>
<div class="line">        <span class="keywordflow">if</span> (annotationVariable-&gt;AsScalar()-&gt;GetInt(&amp;value)==S_OK) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> CUniformParameterBuilder::getBOOLAnnotation(<span class="keyword">const</span> <span class="keywordtype">char</span>* name,BOOL&amp; value)</div>
<div class="line">{</div>
<div class="line">    ID3DX11EffectVariable* annotationVariable= findAnnotationByName(mEffectVariable, name);</div>
<div class="line">    <span class="keywordflow">if</span> (annotationVariable) {</div>
<div class="line"><span class="preprocessor">#if defined(USE_BOOL)</span></div>
<div class="line">        <span class="keywordflow">if</span> (annotationVariable-&gt;AsScalar()-&gt;GetBool(&amp;value)==S_OK) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        <span class="keywordflow">if</span> (annotationVariable-&gt;AsScalar()-&gt;GetBool((<span class="keywordtype">bool</span>*)&amp;value)==S_OK) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> CUniformParameterBuilder::logUnsupportedTypeWarning(<span class="keyword">const</span> <a name="_a9"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_resource_id.html">MStringResourceId</a>&amp; typeId)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> typeStr = dx11ShaderStrings::getString( typeId );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> args;</div>
<div class="line">    args.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(typeStr);</div>
<div class="line">    args.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(mDesc.Name);</div>
<div class="line"></div>
<div class="line">    mWarnings += dx11ShaderStrings::getString( dx11ShaderStrings::kUnsupportedType, args );</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> CUniformParameterBuilder::logUnrecognisedSemantic(<span class="keyword">const</span> <span class="keywordtype">char</span>* pSemantic)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> args;</div>
<div class="line">    args.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(pSemantic);</div>
<div class="line">    args.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>(mDesc.Name);</div>
<div class="line"></div>
<div class="line">    mWarnings += dx11ShaderStrings::getString( dx11ShaderStrings::kUnknowSemantic, args );</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->

      <div class="footer-block"><a href="../html/ac.cmtdialog.htm" class="comments-anchor" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
   </div></body>
</html>
