<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
<head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="MAYAUL" name="product"><meta content="2017" name="release"><meta content="Developer" name="book"><meta content="2016-06-16" name="created"><meta content="GUID-02DEF634-1E7B-48C6-8ACD-2C934CA97887" name="topicid"><meta content="concept" name="topic-type">
<title>shellNode/shellNode.cpp</title>
<meta content="C++" name="topic-subtype"/></meta></meta></meta></meta></meta></meta></meta></head>
<body height="100%"><div class="body_content" id="body-content"><link href="cpp_ref/navtree.css" rel="stylesheet" type="text/css"><link href="cpp_ref/doxygen.css" rel="stylesheet" type="text/css"><link href="cpp_ref/tabs.css" rel="stylesheet" type="text/css"><link href="style/adsk.cpm.css" rel="stylesheet" type="text/css"><script language="javascript">var index = 'index.html';</script><script>$(document).ready(function() { yepnope.injectJs("./scripts/ac_common.js"); });</script><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('shell_node_2shell_node_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>$("div#WidgetFloaterPanels,link[href*='microsofttranslator.com'],script[src*='microsofttranslator.com'],script[src*='bing.com']").remove();</script><script type="text/javascript">$("div#navigation,div#breadcrumbs,div#banner").attr("translate","no"); var mtLocation = ((location && location.href && location.href.indexOf('https') == 0)?'https://ssl.microsofttranslator.com':'http://www.microsofttranslator.com')+'/ajax/v3/WidgetV3.ashx?ctf=True&ui=true&settings=Manual&from=en&hidelanguages='; yepnope.injectJs(mtLocation, function() {}, { charset:'utf-8', type:'text/javascript' } );</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script><!-- begin MT -->
<div class="Dark" id="MicrosoftTranslatorWidget" style="float:right;z-index:100;color:white;background-color:#bbbbbb;height:58px;overflow:hidden"></div>
<div>
<div class="head">
<h1>shellNode/shellNode.cpp</h1>
</div>
<div id="top"><!-- Generated by Doxygen 1.8.10 -->
<div class="tabs" id="navrow1">
<ul class="tablist">
<li><a href="./index.html"><span>MainÂ Page</span></a></li>
<li><a href="./pages.html"><span>Topics</span></a></li>
<li><a href="./modules.html"><span>Modules</span></a></li>
<li><a href="./namespaces.html"><span>Namespaces</span></a></li>
<li><a href="./annotated.html"><span>Classes</span></a></li>
<li><a href="./examples.html"><span>Examples</span></a></li>
</ul>
</div>
</div><!-- top -->
<div class="ui-resizable side-nav-resizable" id="side-nav">
<div id="nav-tree">
<div id="nav-tree-contents">
<div class="sync" id="nav-sync"></div>
</div>
</div>
<div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;">
</div>
</div>
<div id="doc-content">
<div class="header">
<div class="headertitle">
<div class="title">shellNode/shellNode.cpp</div> </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//-</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">// Copyright 1995,2006,2008 Autodesk, Inc. All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk</span></div>
<div class="line"><span class="comment">// license agreement provided at the time of installation or download,</span></div>
<div class="line"><span class="comment">// or which otherwise accompanies this software in either electronic</span></div>
<div class="line"><span class="comment">// or hard copy form.</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">//+</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This plug-in is based, in part, upon the folloing literature:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//      Digital Seashells, M.B. Cortie,</span></div>
<div class="line"><span class="comment">//      Computer and Graphics, Vol. 17, No. 1, pp. 79-84, 1993</span></div>
<div class="line"><span class="comment">// </span></div>
<div class="line"><span class="comment">//      _Shells_, S. Peter Dance,</span></div>
<div class="line"><span class="comment">//      Harper Collins Publishers 1992, ISBN 0 7322 0067 9</span></div>
<div class="line"><span class="comment">// </span></div>
<div class="line"><span class="comment">//      Modeling Seashels, Deborah R. Fowler, Hans Meinhardt et al.</span></div>
<div class="line"><span class="comment">//      Siggraph Proceedings 92, pp. 379-387</span></div>
<div class="line"><span class="comment">// </span></div>
<div class="line"><span class="comment">//      _The Algorithmic Beauty of Sea Shells_, Hans Meinhardt,</span></div>
<div class="line"><span class="comment">//      Springer-Verlag Berlin Heidelberg 1995, ISBN 3 540 57842 0</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// DESCRIPTION:</span></div>
<div class="line"><span class="comment">// </span></div>
<div class="line"><span class="comment">// Produces the dependency graph node "shell". </span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This plug-in demonstrates how to generate a complex mesh object procedurally.</span></div>
<div class="line"><span class="comment">// It also demonstrates how to customize the attribute editor for a node.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// To use the plug-in:</span></div>
<div class="line"><span class="comment">//  </span></div>
<div class="line"><span class="comment">//  (1) Enter the MEL command "shell" to create a new shell node.</span></div>
<div class="line"><span class="comment">//      A mesh object will also be created to display the output.</span></div>
<div class="line"><span class="comment">//  (2) Open the attribute editor for the new shell node to see custom controls</span></div>
<div class="line"><span class="comment">//      for picking various sea shell presets. The attribute editor layout is</span></div>
<div class="line"><span class="comment">//      created by the file "AEShellTemplate.mel" and provides a complex</span></div>
<div class="line"><span class="comment">//      example of how to create an attribute editor template. </span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPxNode.h&gt;</span> </div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MString.h&gt;</span> </div>
<div class="line"><span class="preprocessor">#include &lt;maya/MTypeId.h&gt;</span> </div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPlug.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDataBlock.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDataHandle.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnPlugin.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MAngle.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnUnitAttribute.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnNumericAttribute.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnTypedAttribute.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFloatPoint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFloatPointArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MIntArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDoubleArray.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnMesh.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnMeshData.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MItMeshVertex.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MIOStream.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define Rad(x)  ((x)*FPI/180.0F)</span></div>
<div class="line"><span class="preprocessor">#define Deg(x)  ((x)*180.0F/FPI)</span></div>
<div class="line"><span class="preprocessor">#define FPI 3.14159265358979323846264338327950288419716939937510582F </span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define McheckErr(stat,msg)         \</span></div>
<div class="line"><span class="preprocessor">    if ( MS::kSuccess != stat ) {   \</span></div>
<div class="line"><span class="preprocessor">        cerr &lt;&lt; msg;                \</span></div>
<div class="line"><span class="preprocessor">        return MS::kFailure;        \</span></div>
<div class="line"><span class="preprocessor">    }</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>shellNode : <span class="keyword">public</span> <a name="_a0"></a><a class="code" href="./class_m_px_node.html">MPxNode</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    shellNode();</div>
<div class="line"> <span class="keyword">virtual</span> ~shellNode(); </div>
<div class="line"></div>
<div class="line"> <span class="keyword">virtual</span> <a name="_a1"></a><a class="code" href="./class_m_status.html">MStatus</a> <a name="a2"></a><a class="code" href="./class_m_px_node.html#a5cb7edfa1f67c75588bec1c38b7bf5f8">compute</a>( <span class="keyword">const</span> <a name="_a3"></a><a class="code" href="./class_m_plug.html">MPlug</a>&amp; plug, <a name="_a4"></a><a class="code" href="./class_m_data_block.html">MDataBlock</a>&amp; data );</div>
<div class="line"></div>
<div class="line"> <span class="keyword">static</span> <span class="keywordtype">void</span> *          creator();</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_status.html">MStatus</a>         initialize();</div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span>: </div>
<div class="line"> <span class="keyword">static</span> <a name="_a5"></a><a class="code" href="./class_m_type_id.html">MTypeId</a>     id;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Node attributes</span></div>
<div class="line"> <span class="comment">// ---------------</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// Main shape parameters</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keyword">static</span> <a name="_a6"></a><a class="code" href="./class_m_object.html">MObject</a> alpha;      <span class="comment">// Profile (Helico-spiral) param #1</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> beta;       <span class="comment">// Profile (Helico-spiral) param #2</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> phi;        <span class="comment">// Section Starting point</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> my;         <span class="comment">// Section Slant</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> omega;      <span class="comment">// Section angle around Oz</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> omin;       <span class="comment">// Spiral start angle</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> omax;       <span class="comment">// Spiral end angle</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> od;         <span class="comment">// Spiral angle step</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> smin;       <span class="comment">// Section start angle</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> smax;       <span class="comment">// Section end angle</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> sd;         <span class="comment">// Section angle step</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> A;          <span class="comment">// Distance of section from Z-axis</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> a;          <span class="comment">// Section diameter #1</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> b;          <span class="comment">// Section diameter #2</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> scale;      <span class="comment">// Overall scale</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Nodule 1</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> P;          <span class="comment">// Position on section</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> L;          <span class="comment">// Amplitude (extrusion) of nodule</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> N;          <span class="comment">// Nodules frequency on profile</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> W1;         <span class="comment">// Fatness of nodule</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> W2;         <span class="comment">// Fatness of nodule</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> nstart;     <span class="comment">// Starting point on spiral</span></div>
<div class="line"></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Nodule 2</span></div>
<div class="line"> <span class="comment">// </span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> P2;</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> L2;</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> N2;</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> W12;</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> W22;</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> off2;</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> nstart2;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Nodule 3</span></div>
<div class="line"> <span class="comment">// </span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> P3;</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> L3;</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> N3;</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> W13;</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> W23;</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> off3;</div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> nstart3;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Ribs</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> uamp;       <span class="comment">// Section rib amplitude</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> ufreq;      <span class="comment">// Section rib frequency</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> urib;       <span class="comment">// Section rib/wave percent</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> vamp;       <span class="comment">// Profile rib amplitude</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> vfreq;      <span class="comment">// Profile rib frequency</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> vrib;       <span class="comment">// Profile rib/wave percent</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output mesh</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keyword">static</span> <a class="code" href="./class_m_object.html">MObject</a> outMesh;</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"></div>
<div class="line"> <span class="keyword">struct </span>ShellParams {</div>
<div class="line"> <span class="keywordtype">float</span>   alpha;      <span class="comment">// Profile (Helico-spiral) param #1</span></div>
<div class="line"> <span class="keywordtype">float</span>   beta;       <span class="comment">// Profile (Helico-spiral) param #2</span></div>
<div class="line"> <span class="keywordtype">float</span>   phi;        <span class="comment">// Section Starting point</span></div>
<div class="line"> <span class="keywordtype">float</span>   my;         <span class="comment">// Section Slant</span></div>
<div class="line"> <span class="keywordtype">float</span>   omega;      <span class="comment">// Section angle around Oz</span></div>
<div class="line"> <span class="keywordtype">float</span>   omin;       <span class="comment">// Spiral start angle</span></div>
<div class="line"> <span class="keywordtype">float</span>   omax;       <span class="comment">// Spiral end angle</span></div>
<div class="line"> <span class="keywordtype">float</span>   od;         <span class="comment">// Spiral angle step</span></div>
<div class="line"> <span class="keywordtype">float</span>   smin;       <span class="comment">// Section start angle</span></div>
<div class="line"> <span class="keywordtype">float</span>   smax;       <span class="comment">// Section end angle</span></div>
<div class="line"> <span class="keywordtype">float</span>   sd;         <span class="comment">// Section angle step</span></div>
<div class="line"> <span class="keywordtype">float</span>   A;          <span class="comment">// Distance of section from Z-axis</span></div>
<div class="line"> <span class="keywordtype">float</span>   a;          <span class="comment">// Section diameter #1</span></div>
<div class="line"> <span class="keywordtype">float</span>   b;          <span class="comment">// Section diameter #2</span></div>
<div class="line"> <span class="keywordtype">float</span>   scale;      <span class="comment">// Overall scale</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// Nodule 1</span></div>
<div class="line"> <span class="comment">// --------</span></div>
<div class="line"> <span class="keywordtype">float</span>   P;          <span class="comment">// Position on section</span></div>
<div class="line"> <span class="keywordtype">float</span>   L;          <span class="comment">// Amplitude (extrusion) of nodule</span></div>
<div class="line"> <span class="keywordtype">float</span>   N;          <span class="comment">// Nodules frequency on profile</span></div>
<div class="line"> <span class="keywordtype">float</span>   W1;         <span class="comment">// Fatness of nodule</span></div>
<div class="line"> <span class="keywordtype">float</span>   W2;         <span class="comment">// Fatness of nodule</span></div>
<div class="line"> <span class="keywordtype">float</span>   nstart;     <span class="comment">// Starting point on spiral</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// Nodule 2</span></div>
<div class="line"> <span class="comment">// --------</span></div>
<div class="line"> <span class="keywordtype">float</span>   P2;</div>
<div class="line"> <span class="keywordtype">float</span>   L2;</div>
<div class="line"> <span class="keywordtype">float</span>   N2;</div>
<div class="line"> <span class="keywordtype">float</span>   W12;</div>
<div class="line"> <span class="keywordtype">float</span>   W22;</div>
<div class="line"> <span class="keywordtype">float</span>   off2;</div>
<div class="line"> <span class="keywordtype">float</span>   nstart2;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Nodule 3</span></div>
<div class="line"> <span class="comment">// --------</span></div>
<div class="line"> <span class="keywordtype">float</span>   P3;</div>
<div class="line"> <span class="keywordtype">float</span>   L3;</div>
<div class="line"> <span class="keywordtype">float</span>   N3;</div>
<div class="line"> <span class="keywordtype">float</span>   W13;</div>
<div class="line"> <span class="keywordtype">float</span>   W23;</div>
<div class="line"> <span class="keywordtype">float</span>   off3;</div>
<div class="line"> <span class="keywordtype">float</span>   nstart3;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Ribs</span></div>
<div class="line"> <span class="comment">// ----</span></div>
<div class="line"> <span class="keywordtype">float</span>   uamp;       <span class="comment">// Section rib amplitude</span></div>
<div class="line"> <span class="keywordtype">float</span>   ufreq;      <span class="comment">// Section rib frequency</span></div>
<div class="line"> <span class="keywordtype">float</span>   urib;       <span class="comment">// Section rib/wave percent</span></div>
<div class="line"> <span class="keywordtype">float</span>   vamp;       <span class="comment">// Profile rib amplitude</span></div>
<div class="line"> <span class="keywordtype">float</span>   vfreq;      <span class="comment">// Profile rib frequency</span></div>
<div class="line"> <span class="keywordtype">float</span>   vrib;       <span class="comment">// Profile rib/wave percent</span></div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    ShellParams shellParams;</div>
<div class="line"> <span class="keywordtype">bool</span>        redoTopology;</div>
<div class="line"> <span class="keywordtype">bool</span>        rebuild;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Precomputed shell points</span></div>
<div class="line"> <span class="comment">// </span></div>
<div class="line"> <span class="keywordtype">int</span> ni;</div>
<div class="line"> <span class="keywordtype">int</span> nj;</div>
<div class="line"> <span class="keywordtype">float</span>   **pnts;</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">float</span> GetFloatParameter( <a class="code" href="./class_m_object.html">MObject</a> node, <a class="code" href="./class_m_object.html">MObject</a> attr );</div>
<div class="line"> <span class="keywordtype">float</span> GetAngleParameter( <a class="code" href="./class_m_object.html">MObject</a> node, <a class="code" href="./class_m_object.html">MObject</a> attr );</div>
<div class="line"> <span class="keyword">static</span> <span class="keywordtype">void</span>  addFloatParameter( <a class="code" href="./class_m_object.html">MObject</a> &amp; attr, <a name="_a7"></a><a class="code" href="./class_m_string.html">MString</a> longName, </div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> briefName, <span class="keywordtype">float</span> attrDefault );</div>
<div class="line"> <span class="keyword">static</span> <span class="keywordtype">void</span>  addAngleParameter( <a class="code" href="./class_m_object.html">MObject</a> &amp; attr, <a class="code" href="./class_m_string.html">MString</a> longName, </div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> briefName, <span class="keywordtype">float</span> attrDefault );</div>
<div class="line"> <span class="keywordtype">void</span>  UpdateParameters(); </div>
<div class="line"> <span class="keywordtype">void</span>  RedoTopology();</div>
<div class="line"> <span class="keywordtype">void</span>  Rebuild();</div>
<div class="line"> <span class="keywordtype">float</span> Nodules( <span class="keywordtype">float</span> s, <span class="keywordtype">float</span> o );</div>
<div class="line"> <span class="keywordtype">float</span> Ribs( <span class="keywordtype">float</span> u, <span class="keywordtype">float</span> v );</div>
<div class="line"> <span class="keywordtype">void</span>  Eval( <span class="keywordtype">float</span>   *p, <span class="keywordtype">float</span> o, <span class="keywordtype">float</span> s );</div>
<div class="line"></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_type_id.html">MTypeId</a> shellNode::id( 0x8000b );</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">shellNode::shellNode()</div>
<div class="line"> :  rebuild( true ),</div>
<div class="line">    redoTopology( true ),</div>
<div class="line">    pnts( NULL ),</div>
<div class="line">    ni( 0 ),</div>
<div class="line">    nj( 0 )</div>
<div class="line">{}</div>
<div class="line"></div>
<div class="line">shellNode::~shellNode() {}</div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> shellNode::compute( <span class="keyword">const</span> <a class="code" href="./class_m_plug.html">MPlug</a>&amp; plug, <a class="code" href="./class_m_data_block.html">MDataBlock</a>&amp; data )</div>
<div class="line">{    </div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> returnStatus;</div>
<div class="line"> <span class="keywordtype">int</span> i, j;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Read updated input parameters</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">    UpdateParameters();</div>
<div class="line"> <span class="keywordtype">bool</span> createNewMesh = redoTopology;</div>
<div class="line">    RedoTopology();</div>
<div class="line">    Rebuild();</div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">if</span>( !pnts || ni&lt;2 || nj&lt;2 ) <span class="keywordflow">return</span> <a name="a8"></a><a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (plug == outMesh) {  </div>
<div class="line"> <span class="keywordflow">if</span>( !pnts || ni&lt;2 || nj&lt;2 ) <span class="keywordflow">return</span> <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>;</div>
<div class="line"> </div>
<div class="line"> <a name="_a9"></a><a class="code" href="./class_m_data_handle.html">MDataHandle</a> outputHandle = data.<a name="a10"></a><a class="code" href="./class_m_data_block.html#a5e4082d6ab961bee4ec0281676bb4834">outputValue</a>(outMesh, &amp;returnStatus);</div>
<div class="line">        McheckErr(returnStatus, <span class="stringliteral">"ERROR getting polygon data handle\n"</span>);</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> mesh = outputHandle.<a name="a11"></a><a class="code" href="./class_m_data_handle.html#a301e7b7cdf9f9e1e206651cc6a1b67ec">asMesh</a>();</div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">if</span> ( createNewMesh || mesh.<a name="a12"></a><a class="code" href="./class_m_object.html#ac02f2a4d7312eb91f40980adfd4e31b2">isNull</a>() ) {</div>
<div class="line"> <a name="_a13"></a><a class="code" href="./class_m_fn_mesh_data.html">MFnMeshData</a> dataCreator;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> newOutputData = dataCreator.<a name="a14"></a><a class="code" href="./class_m_fn_mesh_data.html#af1adb4abaf5243c6c0749bcca7b5c418">create</a>(&amp;returnStatus);</div>
<div class="line">            McheckErr(returnStatus, <span class="stringliteral">"ERROR creating outputData"</span>);</div>
<div class="line"> </div>
<div class="line"> <a name="_a15"></a><a class="code" href="./class_m_float_point_array.html">MFloatPointArray</a> vertices;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Build vertices array</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">for</span>( j=0; j&lt;nj; ++j ) {</div>
<div class="line"> <span class="keywordflow">for</span>( i=0; i&lt;ni; ++i ) {</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">float</span> *p= pnts[j] + 3*i;</div>
<div class="line">                    vertices.<a name="a16"></a><a class="code" href="./class_m_float_point_array.html#a9a607c73c20aca58b154cd5d40befbb7">append</a>( <a name="_a17"></a><a class="code" href="./class_m_float_point.html">MFloatPoint</a>(p[0],p[1],p[2]) );</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Build poly vertex count array</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a name="_a18"></a><a class="code" href="./class_m_int_array.html">MIntArray</a> pcounts;</div>
<div class="line">            i= (nj-1)*(ni-1);</div>
<div class="line"> <span class="keywordflow">while</span>( i-- ) {</div>
<div class="line">                pcounts.<a name="a19"></a><a class="code" href="./class_m_int_array.html#a11568087ac2ca16f4106cee62f65afd7">append</a>(4);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Build poly connectivity array</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_int_array.html">MIntArray</a> pconnect;</div>
<div class="line"> <span class="keywordflow">for</span>( j=0; j&lt;nj-1; ++j ) {</div>
<div class="line"> <span class="keywordflow">for</span>( i=0; i&lt;ni-1; ++i ) {</div>
<div class="line"> <span class="keywordtype">int</span> corner= i+j*ni;</div>
<div class="line">                    pconnect.<a class="code" href="./class_m_int_array.html#a11568087ac2ca16f4106cee62f65afd7">append</a>(corner);</div>
<div class="line">                    pconnect.<a class="code" href="./class_m_int_array.html#a11568087ac2ca16f4106cee62f65afd7">append</a>(corner+1);</div>
<div class="line">                    pconnect.<a class="code" href="./class_m_int_array.html#a11568087ac2ca16f4106cee62f65afd7">append</a>(corner+1+ni);</div>
<div class="line">                    pconnect.<a class="code" href="./class_m_int_array.html#a11568087ac2ca16f4106cee62f65afd7">append</a>(corner+ni);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Create some stuff needed by the mesh</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_int_array.html">MIntArray</a>       fec;</div>
<div class="line"> <a name="_a20"></a><a class="code" href="./class_m_double_array.html">MDoubleArray</a>    sp;</div>
<div class="line"> <a class="code" href="./class_m_double_array.html">MDoubleArray</a>    tp;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Build maya poly object</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a name="_a21"></a><a class="code" href="./class_m_fn_mesh.html">MFnMesh</a> meshFn;</div>
<div class="line">            mesh= meshFn.<a name="a22"></a><a class="code" href="./class_m_fn_mesh.html#af9b9e5d33d289134d567c62bad4ca3d5">create</a>(</div>
<div class="line">                nj*ni,              <span class="comment">// number of vertices</span></div>
<div class="line">                (nj-1)*(ni-1),      <span class="comment">// number of polygons</span></div>
<div class="line">                vertices,           <span class="comment">// The points</span></div>
<div class="line">                pcounts,            <span class="comment">// # of vertex for each poly</span></div>
<div class="line">                pconnect,           <span class="comment">// Vertices index for each poly</span></div>
<div class="line">                newOutputData,      <span class="comment">// Dependency graph data object</span></div>
<div class="line">                &amp;returnStatus</div>
<div class="line">            );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Update surface </span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">            outputHandle.<a name="a23"></a><a class="code" href="./class_m_data_handle.html#a2a75482f517f405a641c0eee0bd995ac">set</a>(newOutputData);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line"> <span class="comment">// The topology hasn't changed, so we can just set the points</span></div>
<div class="line"> <span class="comment">// in the existing mesh</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a name="_a24"></a><a class="code" href="./class_m_it_mesh_vertex.html">MItMeshVertex</a> vertIt( mesh, &amp;returnStatus);</div>
<div class="line">            McheckErr(returnStatus, <span class="stringliteral">"ERROR creating iterator\n"</span>);</div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">for</span>( j=0; j&lt;nj; ++j ) {</div>
<div class="line"> <span class="keywordflow">for</span>( i=0; i&lt;ni; ++i ) {</div>
<div class="line"> <span class="keywordflow">if</span> ( vertIt.isDone() ) <span class="keywordflow">break</span>;</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">float</span> *p= pnts[j] + 3*i;</div>
<div class="line">                    vertIt.setPosition( <a name="_a25"></a><a class="code" href="./class_m_point.html">MPoint</a>(p[0],p[1],p[2]) );</div>
<div class="line">                    vertIt.next();</div>
<div class="line">                }</div>
<div class="line"> <span class="keywordflow">if</span> ( vertIt.isDone() ) <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        data.<a name="a26"></a><a class="code" href="./class_m_data_block.html#aceb46f1065ef1cd730c4ab15d61466cc">setClean</a>( plug );</div>
<div class="line">    }   </div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span>* shellNode::creator()</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">new</span> shellNode();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Shell Algorithms //</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="keywordtype">void</span> shellNode::RedoTopology()</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      Adjust our data storage to reflect new parameters</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">if</span>( !redoTopology ) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    redoTopology = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">int</span> oldnj= pnts ? nj : 0;</div>
<div class="line"></div>
<div class="line">    ni= 0;</div>
<div class="line">    nj= 0;</div>
<div class="line"> <span class="keywordflow">for</span>( <span class="keywordtype">float</span> s = shellParams.smin; </div>
<div class="line">         s &lt; shellParams.smax; </div>
<div class="line">         s += shellParams.sd )  </div>
<div class="line">    {</div>
<div class="line">        ni++;   <span class="comment">// Lazy</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">for</span>( <span class="keywordtype">float</span> o = shellParams.omin; </div>
<div class="line">         o &lt; shellParams.omax; </div>
<div class="line">         o += shellParams.od )  </div>
<div class="line">    {</div>
<div class="line">        nj++;   <span class="comment">// Lazy</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>( nj&lt;oldnj ) {</div>
<div class="line"> <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = nj; i &lt; oldnj; ++i ) {</div>
<div class="line"> <span class="keywordflow">if</span>( pnts[i] ) free( pnts[i] );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>( nj!=oldnj) {</div>
<div class="line">        pnts = (<span class="keywordtype">float</span>**) realloc(pnts, nj*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>*));</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>( nj&gt;oldnj ) {</div>
<div class="line">        memset( pnts+oldnj, 0, (nj-oldnj)*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>*) );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;nj;++j) {</div>
<div class="line">        pnts[j] = (<span class="keywordtype">float</span>*) realloc(pnts[j],3*ni*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> shellNode::Rebuild()</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      Rebuild the mesh geometry given the new inputs</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">if</span>( !rebuild ) <span class="keywordflow">return</span>;</div>
<div class="line">    rebuild= 0;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">int</span>     i;</div>
<div class="line"> <span class="keywordtype">int</span>     j;</div>
<div class="line"> <span class="keywordtype">float</span>   s;</div>
<div class="line"> <span class="keywordtype">float</span>   o;</div>
<div class="line"> <span class="keywordtype">float</span>   *p;</div>
<div class="line"></div>
<div class="line">    o= shellParams.omin;</div>
<div class="line"> <span class="keywordflow">for</span>( j=0; j&lt;nj; ++j )</div>
<div class="line">    {</div>
<div class="line">        s= shellParams.smin;</div>
<div class="line">        p= pnts[j];</div>
<div class="line"> <span class="keywordflow">for</span>( i=0; i&lt;ni; ++i )</div>
<div class="line">        {</div>
<div class="line">            Eval( p, o, s );</div>
<div class="line">            s+=shellParams.sd;</div>
<div class="line">            p+=3;</div>
<div class="line">        }</div>
<div class="line">        o+=shellParams.od;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">float</span> SafeCot( <span class="keywordtype">float</span> x )</div>
<div class="line">{</div>
<div class="line"> <span class="keywordtype">float</span> s= sinf(x);</div>
<div class="line"> <span class="keywordflow">return</span> s ? cosf(x)/s : 0.0F;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">float</span> G( <span class="keywordtype">float</span> a, <span class="keywordtype">float</span> n )</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">if</span>( !n ) <span class="keywordflow">return</span> n;</div>
<div class="line"> <span class="keywordtype">float</span> z= 2.0F*FPI;</div>
<div class="line">    a*=n/z;</div>
<div class="line"> <span class="keywordflow">return</span> z/n*(a-floorf(0.5F+a));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">float</span> shellNode::Ribs( <span class="keywordtype">float</span> u, <span class="keywordtype">float</span> v )</div>
<div class="line">{</div>
<div class="line">    ShellParams &amp; sp = shellParams;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">float</span> zu=0.0F;</div>
<div class="line"> <span class="keywordflow">if</span>( sp.uamp )</div>
<div class="line">    {</div>
<div class="line">        zu= sp.uamp*cosf(2.0F*FPI*sp.ufreq*u);</div>
<div class="line"> <span class="keywordflow">if</span>( zu&lt;0 ) zu*= (1.0F-2.0F*sp.urib);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">float</span> zv=0.0F;</div>
<div class="line"> <span class="keywordflow">if</span>( sp.vamp )</div>
<div class="line">    {</div>
<div class="line">        zv= sp.vamp*cosf(2.0F*FPI*sp.vfreq*v);</div>
<div class="line"> <span class="keywordflow">if</span>( zv&lt;0 ) zv*= (1.0F-2.0F*sp.vrib);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> zu+zv;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">float</span> shellNode::Nodules( <span class="keywordtype">float</span> s, <span class="keywordtype">float</span> o )</div>
<div class="line">{</div>
<div class="line">    ShellParams &amp; sp = shellParams;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">float</span> p1;</div>
<div class="line"> <span class="keywordtype">float</span> p2;</div>
<div class="line"> <span class="keywordtype">float</span> k=0.0F;</div>
<div class="line"> <span class="keywordtype">float</span> g=0.0F;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>( sp.L &amp;&amp; sp.N &amp;&amp; o&gt;=sp.nstart )</div>
<div class="line">    {</div>
<div class="line">        g= G(o,sp.N);</div>
<div class="line">        p1= g/sp.W2;</div>
<div class="line">        p2= (s-sp.P)/sp.W1;</div>
<div class="line">        k= sp.L*expf( -4.0F*(p1*p1+p2*p2) );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>( sp.L2 &amp;&amp; sp.N2 &amp;&amp; o&gt;=sp.nstart2 )</div>
<div class="line">    {</div>
<div class="line">        g= G(o+sp.off2,sp.N2); </div>
<div class="line">        p1= g/sp.W22;</div>
<div class="line">        p2= (s-sp.P2)/sp.W12;</div>
<div class="line">        k+= sp.L2*expf( -4.0F*(p1*p1+p2*p2) );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>( sp.L3 &amp;&amp; sp.N3 &amp;&amp; o&gt;= sp.nstart3 )</div>
<div class="line">    {</div>
<div class="line">        g= G(o+sp.off3, sp.N3);</div>
<div class="line">        p1= g/sp.W23;</div>
<div class="line">        p2= (s-sp.P3)/sp.W13;</div>
<div class="line">        k+= sp.L3*expf( -4.0F*(p1*p1+p2*p2) );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> k;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> shellNode::Eval( <span class="keywordtype">float</span> *p, <span class="keywordtype">float</span> o, <span class="keywordtype">float</span> s )</div>
<div class="line">{</div>
<div class="line">    ShellParams &amp; sp = shellParams;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">float</span> ss = sinf(s);</div>
<div class="line"> <span class="keywordtype">float</span> cs = cosf(s);</div>
<div class="line"> <span class="keywordtype">float</span> re = 1.0F/sqrtf(cs*cs/(sp.a*sp.a) </div>
<div class="line">               + ss*ss/(sp.b*sp.b));</div>
<div class="line"> <span class="keywordtype">float</span> sc = sp.scale*expf(o*SafeCot(sp.alpha));</div>
<div class="line"> <span class="keywordtype">float</span> csphi = cosf(s+sp.phi);</div>
<div class="line"> <span class="keywordtype">float</span> ssphi = sinf(s+sp.phi);</div>
<div class="line"> <span class="keywordtype">float</span> sbeta = sinf(sp.beta);</div>
<div class="line"> <span class="keywordtype">float</span> smy = sinf(sp.my);</div>
<div class="line"> <span class="keywordtype">float</span> r = re+Nodules(s,o)+Ribs(s,o);</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">float</span> x = sp.A*sbeta*cosf(o)        </div>
<div class="line">              + r*csphi*cosf(o+sp.omega)    </div>
<div class="line">              - r*smy*ssphi*sinf(o);</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">float</span> y = - sp.A*sbeta*sinf(o)  </div>
<div class="line">              - r*csphi*sinf(o+sp.omega)    </div>
<div class="line">              - r*smy*ssphi*cosf(o);</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">float</span> z = - sp.A*cosf(sp.beta)      </div>
<div class="line">              + r*ssphi*cosf(sp.my);</div>
<div class="line"></div>
<div class="line">    p[0] =  x*sc;</div>
<div class="line">    p[1] = -z*sc;</div>
<div class="line">    p[2] =  y*sc;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Attribute Setup and Maintenance //</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"> <span class="comment">// Main shape parameters</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::alpha;       <span class="comment">// Profile (Helico-spiral) param #1</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::beta;        <span class="comment">// Profile (Helico-spiral) param #2</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::phi;         <span class="comment">// Section Starting point</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::my;          <span class="comment">// Section Slant</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::omega;       <span class="comment">// Section angle around Z</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::omin;        <span class="comment">// Spiral start angle</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::omax;        <span class="comment">// Spiral end angle</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::od;          <span class="comment">// Spiral angle step</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::smin;        <span class="comment">// Section start angle</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::smax;        <span class="comment">// Section end angle</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::sd;          <span class="comment">// Section angle step</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::A;           <span class="comment">// Distance of section from Z-axis</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::a;           <span class="comment">// Section diameter #1</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::b;           <span class="comment">// Section diameter #2</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::scale;       <span class="comment">// Overall scale</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Nodule 1</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::P;           <span class="comment">// Position on section</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::L;           <span class="comment">// Amplitude (extrusion) of nodule</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::N;           <span class="comment">// Nodules frequency on profile</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::W1;          <span class="comment">// Fatness of nodule</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::W2;          <span class="comment">// Fatness of nodule</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::nstart;      <span class="comment">// Starting point on spiral</span></div>
<div class="line"></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Nodule 2</span></div>
<div class="line"> <span class="comment">// </span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::P2;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::L2;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::N2;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::W12;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::W22;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::off2;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::nstart2;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Nodule 3</span></div>
<div class="line"> <span class="comment">// </span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::P3;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::L3;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::N3;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::W13;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::W23;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::off3;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::nstart3;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Ribs</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::uamp;        <span class="comment">// Section rib amplitude</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::ufreq;       <span class="comment">// Section rib frequency</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::urib;        <span class="comment">// Section rib/wave percent</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::vamp;        <span class="comment">// Profile rib amplitude</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::vfreq;       <span class="comment">// Profile rib frequency</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::vrib;        <span class="comment">// Profile rib/wave percent</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// Output mesh</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> shellNode::outMesh;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> shellNode::addFloatParameter( <a class="code" href="./class_m_object.html">MObject</a> &amp; attr, <a class="code" href="./class_m_string.html">MString</a> longName, </div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> briefName, <span class="keywordtype">float</span> attrDefault )</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      Add a float input parameter to the node</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> stat;</div>
<div class="line"> <a name="_a27"></a><a class="code" href="./class_m_fn_numeric_attribute.html">MFnNumericAttribute</a> nAttr;</div>
<div class="line">    attr = nAttr.<a name="a28"></a><a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>( longName, briefName, <a name="a29"></a><a class="code" href="./class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a5686197bafb177bdc82550848416a1ad">MFnNumericData::kFloat</a>, </div>
<div class="line">                         0.0, &amp;stat );</div>
<div class="line"> <span class="keywordflow">if</span> ( stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a> ) <span class="keywordflow">throw</span> stat;</div>
<div class="line"></div>
<div class="line">    stat = nAttr.<a name="a30"></a><a class="code" href="./class_m_fn_numeric_attribute.html#aae3f2fbbbce06e006f1838a1fb6fdcdd">setDefault</a>  ( attrDefault );</div>
<div class="line"> <span class="keywordflow">if</span> ( stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a> ) <span class="keywordflow">throw</span> stat;</div>
<div class="line"></div>
<div class="line">    stat = nAttr.<a name="a31"></a><a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>  ( <span class="keyword">true</span> );</div>
<div class="line"> <span class="keywordflow">if</span> ( stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a> ) <span class="keywordflow">throw</span> stat;</div>
<div class="line"></div>
<div class="line">    stat = nAttr.<a name="a32"></a><a class="code" href="./class_m_fn_attribute.html#afa3d56222eae663308e11edc39e8d153">setCached</a>   ( <span class="keyword">true</span> );</div>
<div class="line"> <span class="keywordflow">if</span> ( stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a> ) <span class="keywordflow">throw</span> stat;</div>
<div class="line"></div>
<div class="line">    stat = nAttr.<a name="a33"></a><a class="code" href="./class_m_fn_attribute.html#a8d2be80de133a200a455bf9e2ac1b709">setStorable</a> ( <span class="keyword">true</span> );</div>
<div class="line"> <span class="keywordflow">if</span> ( stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a> ) <span class="keywordflow">throw</span> stat;</div>
<div class="line"></div>
<div class="line">    stat = addAttribute( attr );</div>
<div class="line"> <span class="keywordflow">if</span> ( stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a> ) <span class="keywordflow">throw</span> stat;</div>
<div class="line"> </div>
<div class="line">    stat = attributeAffects( attr, outMesh );</div>
<div class="line"> <span class="keywordflow">if</span> ( stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a> ) <span class="keywordflow">throw</span> stat;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> shellNode::addAngleParameter( <a class="code" href="./class_m_object.html">MObject</a> &amp; attr, <a class="code" href="./class_m_string.html">MString</a> longName, </div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> briefName, <span class="keywordtype">float</span> attrDefault )</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      Add an angle input parameter to the node</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> stat;</div>
<div class="line"> <a name="_a34"></a><a class="code" href="./class_m_fn_unit_attribute.html">MFnUnitAttribute</a> uAttr;</div>
<div class="line"></div>
<div class="line"> <a name="_a35"></a><a class="code" href="./class_m_angle.html">MAngle</a> defaultAngle( (<span class="keywordtype">double</span>)attrDefault, <a name="a36"></a><a class="code" href="./class_m_angle.html#abceb2331ad056e3c5ad27894199a49edae77f5ca99dc21b7dfd533074906e0a67">MAngle::kDegrees</a> );</div>
<div class="line"> </div>
<div class="line">    attr = uAttr.<a name="a37"></a><a class="code" href="./class_m_fn_unit_attribute.html#a31f804de81a968aa11b510a6231e7874">create</a>( longName, briefName, defaultAngle, &amp;stat );</div>
<div class="line"> <span class="keywordflow">if</span> ( stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a> ) <span class="keywordflow">throw</span> stat;</div>
<div class="line"></div>
<div class="line">    stat = uAttr.<a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>  ( <span class="keyword">true</span> );</div>
<div class="line"> <span class="keywordflow">if</span> ( stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a> ) <span class="keywordflow">throw</span> stat;</div>
<div class="line"></div>
<div class="line">    stat = uAttr.<a class="code" href="./class_m_fn_attribute.html#afa3d56222eae663308e11edc39e8d153">setCached</a>   ( <span class="keyword">true</span> );</div>
<div class="line"> <span class="keywordflow">if</span> ( stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a> ) <span class="keywordflow">throw</span> stat;</div>
<div class="line"></div>
<div class="line">    stat = uAttr.<a class="code" href="./class_m_fn_attribute.html#a8d2be80de133a200a455bf9e2ac1b709">setStorable</a> ( <span class="keyword">true</span> );</div>
<div class="line"> <span class="keywordflow">if</span> ( stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a> ) <span class="keywordflow">throw</span> stat;</div>
<div class="line"></div>
<div class="line">    stat = addAttribute( attr );</div>
<div class="line"> <span class="keywordflow">if</span> ( stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a> ) <span class="keywordflow">throw</span> stat;</div>
<div class="line"> </div>
<div class="line">    stat = attributeAffects( attr, outMesh );</div>
<div class="line"> <span class="keywordflow">if</span> ( stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a> ) <span class="keywordflow">throw</span> stat;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> shellNode::initialize()</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description</span></div>
<div class="line"><span class="comment">//      Set up node attributes</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"> <a name="_a38"></a><a class="code" href="./class_m_fn_typed_attribute.html">MFnTypedAttribute</a>   typedFn;</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a>             stat;</div>
<div class="line"></div>
<div class="line">    outMesh = typedFn.<a name="a39"></a><a class="code" href="./class_m_fn_typed_attribute.html#af785af0a66bd4a4da1d9f7bd74d4de0a">create</a>( <span class="stringliteral">"outMesh"</span>, <span class="stringliteral">"o"</span>, <a name="a40"></a><a class="code" href="./class_m_fn_data.html#a1d1cfd8ffb84e947f82999c682b666a7a19fd562fc0900a60162e6073df36cb62">MFnData::kMesh</a>,</div>
<div class="line">                              &amp;stat ); </div>
<div class="line"> <span class="keywordflow">if</span> ( <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a> != stat ) {</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">"ERROR creating animCube output attribute\n"</span>;</div>
<div class="line"> <span class="keywordflow">return</span> stat;</div>
<div class="line">    }</div>
<div class="line">    typedFn.<a class="code" href="./class_m_fn_attribute.html#a8d2be80de133a200a455bf9e2ac1b709">setStorable</a>(<span class="keyword">false</span>);</div>
<div class="line">    typedFn.<a name="a41"></a><a class="code" href="./class_m_fn_attribute.html#a98bb3089ec3b7442383da68a5ef424c7">setWritable</a>(<span class="keyword">false</span>);</div>
<div class="line">    stat = addAttribute( outMesh );</div>
<div class="line">    McheckErr(stat, <span class="stringliteral">"ERROR adding attribute"</span>);  </div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">try</span> {</div>
<div class="line">        addAngleParameter( alpha,   <span class="stringliteral">"profileParam1"</span>,           <span class="stringliteral">"pp1"</span>,   80.0F );</div>
<div class="line">        addAngleParameter( beta,    <span class="stringliteral">"profileParam2"</span>,           <span class="stringliteral">"pp2"</span>,   90.0F );</div>
<div class="line">        addAngleParameter( phi,     <span class="stringliteral">"sectionStartingPoint"</span>,    <span class="stringliteral">"ssp"</span>,    1.0F );</div>
<div class="line">        addAngleParameter( my,      <span class="stringliteral">"sectionSlant"</span>,            <span class="stringliteral">"ss"</span>,     1.0F );</div>
<div class="line">        addAngleParameter( omega,   <span class="stringliteral">"sectionAngleZ"</span>,           <span class="stringliteral">"saz"</span>,    1.0F );</div>
<div class="line">        addAngleParameter( omin,    <span class="stringliteral">"spiralStartAngle"</span>,        <span class="stringliteral">"sps"</span>,    0.0F );</div>
<div class="line">        addAngleParameter( omax,    <span class="stringliteral">"spiralEndAngle"</span>,          <span class="stringliteral">"spe"</span>, 1200.0F );</div>
<div class="line">        addAngleParameter( od,      <span class="stringliteral">"spiralAngleStep"</span>,         <span class="stringliteral">"spa"</span>,    4.0F );</div>
<div class="line">        addAngleParameter( smin,    <span class="stringliteral">"sectionStartAngle"</span>,       <span class="stringliteral">"ssa"</span>, -190.0F );</div>
<div class="line">        addAngleParameter( smax,    <span class="stringliteral">"sectionEndAngle"</span>,         <span class="stringliteral">"sea"</span>,  190.0F );</div>
<div class="line">        addAngleParameter( sd,      <span class="stringliteral">"sectionAngleStep"</span>,        <span class="stringliteral">"sas"</span>,   17.0F );</div>
<div class="line"></div>
<div class="line">        addFloatParameter( A,       <span class="stringliteral">"distanceFromZ"</span>,           <span class="stringliteral">"dfz"</span>,    1.9F );</div>
<div class="line">        addFloatParameter( a,       <span class="stringliteral">"sectionDiameter1"</span>,        <span class="stringliteral">"sd1"</span>,    1.0F );</div>
<div class="line">        addFloatParameter( b,       <span class="stringliteral">"sectionDiameter2"</span>,        <span class="stringliteral">"sd2"</span>,    0.9F );</div>
<div class="line">        addFloatParameter( scale,   <span class="stringliteral">"scale"</span>,                   <span class="stringliteral">"s"</span>,      0.03F );</div>
<div class="line"></div>
<div class="line">        addAngleParameter( P,       <span class="stringliteral">"positionOnSection1"</span>,      <span class="stringliteral">"ps1"</span>,   10.0F );</div>
<div class="line">        addFloatParameter( L,       <span class="stringliteral">"noduleAmplitude1"</span>,        <span class="stringliteral">"na1"</span>,    1.0F );</div>
<div class="line">        addFloatParameter( N,       <span class="stringliteral">"noduleProfileFrequency1"</span>, <span class="stringliteral">"nf1"</span>,   15.0F );</div>
<div class="line">        addAngleParameter( W1,      <span class="stringliteral">"noduleFatness11"</span>,         <span class="stringliteral">"f11"</span>,  100.0F );</div>
<div class="line">        addAngleParameter( W2,      <span class="stringliteral">"noduleFatness21"</span>,         <span class="stringliteral">"f21"</span>,   20.0F );</div>
<div class="line">        addAngleParameter( nstart,  <span class="stringliteral">"spiralStartingPoint1"</span>,    <span class="stringliteral">"sp1"</span>,    0.0F );</div>
<div class="line"></div>
<div class="line">        addAngleParameter( P2,      <span class="stringliteral">"positionOnSection2"</span>,      <span class="stringliteral">"ps2"</span>,    0.0F );</div>
<div class="line">        addFloatParameter( L2,      <span class="stringliteral">"noduleAmplitude2"</span>,        <span class="stringliteral">"na2"</span>,    0.0F );</div>
<div class="line">        addFloatParameter( N2,      <span class="stringliteral">"noduleProfileFrequency2"</span>, <span class="stringliteral">"nf2"</span>,    0.0F );</div>
<div class="line">        addAngleParameter( W12,     <span class="stringliteral">"noduleFatness12"</span>,         <span class="stringliteral">"f12"</span>,   30.0F );</div>
<div class="line">        addAngleParameter( W22,     <span class="stringliteral">"noduleFatness22"</span>,         <span class="stringliteral">"f22"</span>,   30.0F );</div>
<div class="line">        addAngleParameter( off2,    <span class="stringliteral">"noduleOffset2"</span>,           <span class="stringliteral">"no2"</span>,    0.0F );</div>
<div class="line">        addAngleParameter( nstart2, <span class="stringliteral">"spiralStartingPoint2"</span>,    <span class="stringliteral">"sp2"</span>,    0.0F );</div>
<div class="line"></div>
<div class="line">        addAngleParameter( P3,      <span class="stringliteral">"positionOnSection3"</span>,      <span class="stringliteral">"ps3"</span>,    0.0F );</div>
<div class="line">        addFloatParameter( L3,      <span class="stringliteral">"noduleAmplitude3"</span>,        <span class="stringliteral">"na3"</span>,    0.0F );</div>
<div class="line">        addFloatParameter( N3,      <span class="stringliteral">"noduleProfileFrequency3"</span>, <span class="stringliteral">"nf3"</span>,    0.0F );</div>
<div class="line">        addAngleParameter( W13,     <span class="stringliteral">"noduleFatness13"</span>,         <span class="stringliteral">"f13"</span>,   30.0F );</div>
<div class="line">        addAngleParameter( W23,     <span class="stringliteral">"noduleFatness23"</span>,         <span class="stringliteral">"f23"</span>,   30.0F );</div>
<div class="line">        addAngleParameter( off3,    <span class="stringliteral">"noduleOffset3"</span>,           <span class="stringliteral">"no3"</span>,    0.0F );</div>
<div class="line">        addAngleParameter( nstart3, <span class="stringliteral">"spiralStartingPoint3"</span>,    <span class="stringliteral">"sp3"</span>,    0.0F );</div>
<div class="line"></div>
<div class="line">        addFloatParameter( uamp,    <span class="stringliteral">"sectionRibAmplitude"</span>,     <span class="stringliteral">"sra"</span>,    0.0F );</div>
<div class="line">        addFloatParameter( ufreq,   <span class="stringliteral">"sectionRibFrequency"</span>,     <span class="stringliteral">"srf"</span>,    0.0F );</div>
<div class="line">        addFloatParameter( urib,    <span class="stringliteral">"sectionRibWavePercent"</span>,   <span class="stringliteral">"srw"</span>,    0.0F );</div>
<div class="line">        addFloatParameter( vamp,    <span class="stringliteral">"profileRibAmplitude"</span>,     <span class="stringliteral">"pra"</span>,    0.0F );</div>
<div class="line">        addFloatParameter( vfreq,   <span class="stringliteral">"profileRibFrequency"</span>,     <span class="stringliteral">"prf"</span>,    0.0F );</div>
<div class="line">        addFloatParameter( vrib,    <span class="stringliteral">"profileRibWavePercent"</span>,   <span class="stringliteral">"prw"</span>,    0.0F );</div>
<div class="line">    } <span class="keywordflow">catch</span> ( <a class="code" href="./class_m_status.html">MStatus</a> stat ) {</div>
<div class="line">        fprintf(stderr,<span class="stringliteral">"Attribute Initialize Failed\n"</span>);</div>
<div class="line"> <span class="keywordflow">return</span> stat;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">float</span> shellNode::GetFloatParameter( <a class="code" href="./class_m_object.html">MObject</a> node, <a class="code" href="./class_m_object.html">MObject</a> attr )</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug( node, attr );</div>
<div class="line"> <span class="keywordtype">float</span> value;</div>
<div class="line">    plug.<a name="a42"></a><a class="code" href="./class_m_plug.html#a64f7093bfde5c5eb9d89b32635b772aa">getValue</a>( value );</div>
<div class="line"> <span class="keywordflow">return</span> value;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">float</span> shellNode::GetAngleParameter( <a class="code" href="./class_m_object.html">MObject</a> node, <a class="code" href="./class_m_object.html">MObject</a> attr )</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug( node, attr );</div>
<div class="line"> <a class="code" href="./class_m_angle.html">MAngle</a> angle;</div>
<div class="line">    plug.<a class="code" href="./class_m_plug.html#a64f7093bfde5c5eb9d89b32635b772aa">getValue</a>( angle );</div>
<div class="line"> <span class="keywordflow">return</span> (<span class="keywordtype">float</span>)angle.<a name="a43"></a><a class="code" href="./class_m_angle.html#af8278be30529fafd8925d17dd9dfe65a">asRadians</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define UpdateFloatAttr(ATTR,TOPOLOGY)                          \</span></div>
<div class="line"><span class="preprocessor">    oldValue = shellParams. ATTR;                           \</span></div>
<div class="line"><span class="preprocessor">    shellParams. ATTR = GetFloatParameter( thisObj, ATTR ); \</span></div>
<div class="line"><span class="preprocessor">    if ( shellParams. ATTR != oldValue ) {                  \</span></div>
<div class="line"><span class="preprocessor">        rebuild = true;                                         \</span></div>
<div class="line"><span class="preprocessor">        redoTopology = TOPOLOGY ? true : redoTopology;          \</span></div>
<div class="line"><span class="preprocessor">    }</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define UpdateAngleAttr(ATTR,TOPOLOGY)                          \</span></div>
<div class="line"><span class="preprocessor">    oldValue = shellParams. ATTR;                           \</span></div>
<div class="line"><span class="preprocessor">    shellParams. ATTR = GetAngleParameter( thisObj, ATTR ); \</span></div>
<div class="line"><span class="preprocessor">    if ( shellParams. ATTR != oldValue ) {                  \</span></div>
<div class="line"><span class="preprocessor">        rebuild = true;                                         \</span></div>
<div class="line"><span class="preprocessor">        redoTopology = TOPOLOGY ? true : redoTopology;          \</span></div>
<div class="line"><span class="preprocessor">    }</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> shellNode::UpdateParameters( ) </div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description</span></div>
<div class="line"><span class="comment">//      Read all of the shell parameters and determine what has changed</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> thisObj = thisMObject();</div>
<div class="line"> <span class="keywordtype">float</span> oldValue;</div>
<div class="line"></div>
<div class="line">    UpdateAngleAttr(alpha,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(beta,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(phi,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(my,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(omega,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(A,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(a,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(b,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(scale,<span class="keyword">false</span>);</div>
<div class="line"></div>
<div class="line">    UpdateAngleAttr(P,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(L,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(N,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(W1,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(W2,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(nstart,<span class="keyword">false</span>);</div>
<div class="line"></div>
<div class="line">    UpdateAngleAttr(P2,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(L2,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(N2,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(W12,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(W22,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(off2,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(nstart2,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(P3,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(L3,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(N3,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(W13,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(W23,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(off3,<span class="keyword">false</span>);</div>
<div class="line">    UpdateAngleAttr(nstart3,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(uamp,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(ufreq,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(urib,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(vamp,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(vfreq,<span class="keyword">false</span>);</div>
<div class="line">    UpdateFloatAttr(vrib,<span class="keyword">false</span>);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// These settings change the topology of the geometry</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">    UpdateAngleAttr(omin,<span class="keyword">true</span>);</div>
<div class="line">    UpdateAngleAttr(omax,<span class="keyword">true</span>);</div>
<div class="line">    UpdateAngleAttr(od,<span class="keyword">true</span>);</div>
<div class="line">    UpdateAngleAttr(smin,<span class="keyword">true</span>);</div>
<div class="line">    UpdateAngleAttr(smax,<span class="keyword">true</span>);</div>
<div class="line">    UpdateAngleAttr(sd,<span class="keyword">true</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Plug-in Initialization //</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> initializePlugin( <a class="code" href="./class_m_object.html">MObject</a> obj )</div>
<div class="line">{ </div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a>   status;</div>
<div class="line"> <a name="_a44"></a><a class="code" href="./class_m_fn_plugin.html">MFnPlugin</a> plugin( obj, PLUGIN_COMPANY, <span class="stringliteral">"3.0"</span>, <span class="stringliteral">"Any"</span>);</div>
<div class="line"></div>
<div class="line">    status = plugin.registerNode( <span class="stringliteral">"shell"</span>, shellNode::id, </div>
<div class="line">                         &amp;shellNode::creator, &amp;shellNode::initialize,</div>
<div class="line"> <a name="a45"></a><a class="code" href="./class_m_px_node.html#a1d1cfd8ffb84e947f82999c682b666a7a4b0bfa06b4f203b367a80f14fa6ed4fa">MPxNode::kDependNode</a> );</div>
<div class="line"> <span class="keywordflow">if</span> (!status) {</div>
<div class="line">        status.<a name="a46"></a><a class="code" href="./class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">"registerNode"</span>);</div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> uninitializePlugin( <a class="code" href="./class_m_object.html">MObject</a> obj)</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a>   status;</div>
<div class="line"> <a class="code" href="./class_m_fn_plugin.html">MFnPlugin</a> plugin( obj );</div>
<div class="line"></div>
<div class="line">    status = plugin.deregisterNode( shellNode::id );</div>
<div class="line"> <span class="keywordflow">if</span> (!status) {</div>
<div class="line">        status.<a class="code" href="./class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">"deregisterNode"</span>);</div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div class="footer-block"><a class="comments-anchor" href="../html/ac.cmtdialog.htm" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div><br/></div>
</link></link></link></link></div></body>
</html>
