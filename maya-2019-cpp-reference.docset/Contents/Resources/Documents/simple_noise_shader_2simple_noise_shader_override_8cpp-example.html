<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
<head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><script src="../scripts/utils/adsk.redirect.js" type="text/javascript"></script>
<title>simpleNoiseShader/simpleNoiseShaderOverride.cpp</title>
<meta content="C++" name="topic-subtype"/></head>
<body height="100%"><div class="body_content" id="body-content"><link href="cpp_ref/navtree.css" rel="stylesheet" type="text/css"/><link href="cpp_ref/doxygen.css" rel="stylesheet" type="text/css"/><link href="cpp_ref/tabs.css" rel="stylesheet" type="text/css"/><link href="style/adsk.cpm.css" rel="stylesheet" type="text/css"/><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('simple_noise_shader_2simple_noise_shader_override_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>$("div#WidgetFloaterPanels,link[href*='microsofttranslator.com'],script[src*='microsofttranslator.com'],script[src*='bing.com']").remove();</script><script type="text/javascript">$("div#navigation,div#breadcrumbs,div#banner").attr("translate","no"); var mtLocation = ((location && location.href && location.href.indexOf('https') == 0)?'https://ssl.microsofttranslator.com':'http://www.microsofttranslator.com')+'/ajax/v3/WidgetV3.ashx?ctf=True&ui=true&settings=Manual&from=en&hidelanguages='; yepnope.injectJs(mtLocation, function() {}, { charset:'utf-8', type:'text/javascript' } );</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script><!-- begin MT -->
<div class="Dark" id="MicrosoftTranslatorWidget" style="float:right;z-index:100;color:white;background-color:#bbbbbb;height:58px;overflow:hidden"></div>
<div>
<div class="head">
<h1>simpleNoiseShader/simpleNoiseShaderOverride.cpp</h1>
</div>
<div id="top"><!-- Generated by Doxygen 1.8.10 -->
<div class="tabs" id="navrow1">
<ul class="tablist">
<li><a href="./index.html"><span>MainÂ Page</span></a></li>
<li><a href="./pages.html"><span>Topics</span></a></li>
<li><a href="./modules.html"><span>Modules</span></a></li>
<li><a href="./namespaces.html"><span>Namespaces</span></a></li>
<li><a href="./annotated.html"><span>Classes</span></a></li>
<li><a href="./files.html"><span>Files</span></a></li>
<li><a href="./examples.html"><span>Examples</span></a></li>
</ul>
</div>
</div><!-- top -->
<div class="ui-resizable side-nav-resizable" id="side-nav">
<div id="nav-tree">
<div id="nav-tree-contents">
<div class="sync" id="nav-sync"></div>
</div>
</div>
<div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;">
</div>
</div>
<div id="doc-content">
<div class="header">
<div class="headertitle">
<div class="title">simpleNoiseShader/simpleNoiseShaderOverride.cpp</div> </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//-</span></div>
<div class="line"><span class="comment">// ===========================================================================</span></div>
<div class="line"><span class="comment">// Copyright 2015 Autodesk, Inc.  All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk license</span></div>
<div class="line"><span class="comment">// agreement provided at the time of installation or download, or which</span></div>
<div class="line"><span class="comment">// otherwise accompanies this software in either electronic or hard copy form.</span></div>
<div class="line"><span class="comment">// ===========================================================================</span></div>
<div class="line"><span class="comment">//+</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This is the implementation of MPxShadingNodeOverride that tells Maya</span></div>
<div class="line"><span class="comment">// how to build and manage a VP2 shading fragment for the simpleNoiseShader node</span></div>
<div class="line"><span class="comment">// in the DG.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// In addition to registering fragments and associating a fragment graph with</span></div>
<div class="line"><span class="comment">// the node, this override also manages some additional parameters on the final</span></div>
<div class="line"><span class="comment">// shading effect. Specifically, the fragment defines a texture and sampler</span></div>
<div class="line"><span class="comment">// parameter pair for the noise lookup table. Those parameters are not</span></div>
<div class="line"><span class="comment">// associated with any attributes on the Maya node and thus must be handled</span></div>
<div class="line"><span class="comment">// manually.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// The noise lookup table is a complete copy of Maya's noise table accessed</span></div>
<div class="line"><span class="comment">// through MRenderUtil::valueInNoiseTable(). This is packed into a 3D texture</span></div>
<div class="line"><span class="comment">// which the pixel shader can sample to get noise values to produce a result</span></div>
<div class="line"><span class="comment">// that is consistent with the compute() method of the simpleNoiseShader node.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// A static method handles the definition and registration of the actual</span></div>
<div class="line"><span class="comment">// shading fragments and the final fragment graph. Please see the comments in</span></div>
<div class="line"><span class="comment">// registerFragments() for more details.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include "simpleNoiseShaderOverride.h"</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MViewport2Renderer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFragmentManager.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MTextureManager.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MShaderManager.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MRenderUtil.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Implementation-specific data and helper functions</span></div>
<div class="line"><span class="keyword">namespace</span></div>
<div class="line">{</div>
<div class="line"> <span class="keyword">const</span> <a name="_a0"></a><a class="code" href="./class_m_string.html">MString</a> sFinalFragmentGraphName(<span class="stringliteral">"simpleNoise"</span>);</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_string.html">MString</a> sNoiseLookupTextureName(<span class="stringliteral">"simpleNoiseLookupTexture"</span>);</div>
<div class="line"></div>
<div class="line"> <span class="keyword">const</span> std::vector&lt;float&gt;&amp; GetMayaNoiseTable()</div>
<div class="line">    {</div>
<div class="line"> <span class="comment">// Static so as to only pull the noise data once (it's constant)</span></div>
<div class="line"> <span class="keyword">static</span> std::vector&lt;float&gt; sNoiseData;</div>
<div class="line"> <span class="keywordflow">if</span> (sNoiseData.empty())</div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// Pack entire noise table into an array, remapping from</span></div>
<div class="line"> <span class="comment">// the [-1,1] range to the [0,1] range. The pixel shader</span></div>
<div class="line"> <span class="comment">// will do the inverse operation to extract the real</span></div>
<div class="line"> <span class="comment">// data from the texture.</span></div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dataSize = <a name="a1"></a><a class="code" href="./class_m_render_util.html#a8d8f6680130403e05c24da486597b82c">MRenderUtil::noiseTableSize</a>();</div>
<div class="line">            sNoiseData.resize(dataSize);</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;dataSize; i++)</div>
<div class="line">            {</div>
<div class="line">                sNoiseData[i] = (<a name="a2"></a><a class="code" href="./class_m_render_util.html#a9af45a5223ef6b235a67e607e30e7f84">MRenderUtil::valueInNoiseTable</a>(i) + 1.0f)/2.0f;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        assert(sNoiseData.size() == <a class="code" href="./class_m_render_util.html#a8d8f6680130403e05c24da486597b82c">MRenderUtil::noiseTableSize</a>());</div>
<div class="line"> <span class="keywordflow">return</span> sNoiseData;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a name="_a3"></a><a class="code" href="./class_m_h_w_render_1_1_m_px_shading_node_override.html">MHWRender::MPxShadingNodeOverride</a>* simpleNoiseShaderOverride::creator(</div>
<div class="line"> <span class="keyword">const</span> <a name="_a4"></a><a class="code" href="./class_m_object.html">MObject</a>&amp; obj)</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">new</span> simpleNoiseShaderOverride(obj);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">simpleNoiseShaderOverride::simpleNoiseShaderOverride(<span class="keyword">const</span> <a class="code" href="./class_m_object.html">MObject</a>&amp; obj)</div>
<div class="line">: MPxShadingNodeOverride(obj)</div>
<div class="line">, fObject(obj)</div>
<div class="line">, fNoiseTexture(NULL)</div>
<div class="line">, fNoiseSamplerState(NULL)</div>
<div class="line">, fResolvedNoiseMapName(<span class="stringliteral">""</span>)</div>
<div class="line">, fResolvedNoiseSamplerName(<span class="stringliteral">""</span>)</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">simpleNoiseShaderOverride::~simpleNoiseShaderOverride()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Release texture</span></div>
<div class="line"> <a name="_a5"></a><a class="code" href="./class_m_h_w_render_1_1_m_renderer.html">MHWRender::MRenderer</a>* renderer = <a name="a6"></a><a class="code" href="./class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>();</div>
<div class="line"> <span class="keywordflow">if</span> (renderer)</div>
<div class="line">    {</div>
<div class="line"> <a name="_a7"></a><a class="code" href="./class_m_h_w_render_1_1_m_texture_manager.html">MHWRender::MTextureManager</a>* textureMgr =</div>
<div class="line">            renderer-&gt;<a name="a8"></a><a class="code" href="./class_m_h_w_render_1_1_m_renderer.html#aa3f2ec2984800e2cd8ea09b4ad9f072e">getTextureManager</a>();</div>
<div class="line"> <span class="keywordflow">if</span> (textureMgr)</div>
<div class="line">        {</div>
<div class="line">            textureMgr-&gt;<a name="a9"></a><a class="code" href="./class_m_h_w_render_1_1_m_texture_manager.html#a82d198d9b895a67d774077d67073d22a">releaseTexture</a>(fNoiseTexture);</div>
<div class="line">            fNoiseTexture = NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Release sampler state</span></div>
<div class="line"> <a name="a10"></a><a class="code" href="./class_m_h_w_render_1_1_m_state_manager.html#a1024724a856ce82cecfaf79bc0c6d6c4">MHWRender::MStateManager::releaseSamplerState</a>(fNoiseSamplerState);</div>
<div class="line">    fNoiseSamplerState = NULL;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="./namespace_m_h_w_render.html#ad970d5c990d4803d0e9d73c1ff4fda49">MHWRender::DrawAPI</a> simpleNoiseShaderOverride::supportedDrawAPIs()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <span class="comment">// Support all available draw APIs (all fragments have an implementation for</span></div>
<div class="line"> <span class="comment">// each).</span></div>
<div class="line"> <span class="keywordflow">return</span></div>
<div class="line"> <a name="a11"></a><a class="code" href="./namespace_m_h_w_render.html#ad970d5c990d4803d0e9d73c1ff4fda49a72361be679c1aca1c1be5f9b500a3315">MHWRender::kOpenGL</a> |</div>
<div class="line"> <a name="a12"></a><a class="code" href="./namespace_m_h_w_render.html#ad970d5c990d4803d0e9d73c1ff4fda49a90bc0a1678af7ac4d1e62e2e954be4e5">MHWRender::kDirectX11</a> |</div>
<div class="line"> <a name="a13"></a><a class="code" href="./namespace_m_h_w_render.html#ad970d5c990d4803d0e9d73c1ff4fda49aaebf48c70b63878eff38483392f19fb7">MHWRender::kOpenGLCoreProfile</a>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_string.html">MString</a> simpleNoiseShaderOverride::fragmentName()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <span class="comment">// Reset cached parameter names since the effect is being rebuilt</span></div>
<div class="line">    fResolvedNoiseMapName = <span class="stringliteral">""</span>;</div>
<div class="line">    fResolvedNoiseSamplerName = <span class="stringliteral">""</span>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Return the name of the full fragment graph</span></div>
<div class="line"> <span class="keywordflow">return</span> sFinalFragmentGraphName;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> simpleNoiseShaderOverride::getCustomMappings(</div>
<div class="line"> <a name="_a14"></a><a class="code" href="./class_m_h_w_render_1_1_m_attribute_parameter_mapping_list.html">MHWRender::MAttributeParameterMappingList</a>&amp; mappings)</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Set up some mappings for the noise map parameters on fragment, as there</span></div>
<div class="line"> <span class="comment">// is no correspondence to attributes on the node for them.</span></div>
<div class="line"> <a name="_a15"></a><a class="code" href="./class_m_h_w_render_1_1_m_attribute_parameter_mapping.html">MHWRender::MAttributeParameterMapping</a> mapMapping(</div>
<div class="line"> <span class="stringliteral">"noiseLookupMap"</span>, <span class="stringliteral">""</span>, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line">    mappings.<a name="a16"></a><a class="code" href="./class_m_h_w_render_1_1_m_attribute_parameter_mapping_list.html#a651f7db3e2e91cdb1914be13ff70bffa">append</a>(mapMapping);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_h_w_render_1_1_m_attribute_parameter_mapping.html">MHWRender::MAttributeParameterMapping</a> textureSamplerMapping(</div>
<div class="line"> <span class="stringliteral">"noiseLookupMapSampler"</span>, <span class="stringliteral">""</span>, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line">    mappings.<a class="code" href="./class_m_h_w_render_1_1_m_attribute_parameter_mapping_list.html#a651f7db3e2e91cdb1914be13ff70bffa">append</a>(textureSamplerMapping);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> simpleNoiseShaderOverride::updateShader(</div>
<div class="line"> <a name="_a17"></a><a class="code" href="./class_m_h_w_render_1_1_m_shader_instance.html">MHWRender::MShaderInstance</a>&amp; shader,</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_h_w_render_1_1_m_attribute_parameter_mapping_list.html">MHWRender::MAttributeParameterMappingList</a>&amp; mappings)</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Handle resolved name caching</span></div>
<div class="line"> <span class="keywordflow">if</span> (fResolvedNoiseMapName.length() == 0)</div>
<div class="line">    {</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_h_w_render_1_1_m_attribute_parameter_mapping.html">MHWRender::MAttributeParameterMapping</a>* mapping =</div>
<div class="line">            mappings.<a name="a18"></a><a class="code" href="./class_m_h_w_render_1_1_m_attribute_parameter_mapping_list.html#ad6a8e8b308830e3ee064dedfda768104">findByParameterName</a>(<span class="stringliteral">"noiseLookupMap"</span>);</div>
<div class="line"> <span class="keywordflow">if</span> (mapping)</div>
<div class="line">        {</div>
<div class="line">            fResolvedNoiseMapName = mapping-&gt;<a name="a19"></a><a class="code" href="./class_m_h_w_render_1_1_m_attribute_parameter_mapping.html#ad6ede1f5fccb9110ca5a4a0efa3c94f4">resolvedParameterName</a>();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">if</span> (fResolvedNoiseSamplerName.length() == 0)</div>
<div class="line">    {</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_h_w_render_1_1_m_attribute_parameter_mapping.html">MHWRender::MAttributeParameterMapping</a>* mapping =</div>
<div class="line">            mappings.<a class="code" href="./class_m_h_w_render_1_1_m_attribute_parameter_mapping_list.html#ad6a8e8b308830e3ee064dedfda768104">findByParameterName</a>(<span class="stringliteral">"noiseLookupMapSampler"</span>);</div>
<div class="line"> <span class="keywordflow">if</span> (mapping)</div>
<div class="line">        {</div>
<div class="line">            fResolvedNoiseSamplerName = mapping-&gt;<a class="code" href="./class_m_h_w_render_1_1_m_attribute_parameter_mapping.html#ad6ede1f5fccb9110ca5a4a0efa3c94f4">resolvedParameterName</a>();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Set the parameters on the shader</span></div>
<div class="line"> <span class="keywordflow">if</span> (fResolvedNoiseMapName.length() &gt; 0 &amp;&amp;</div>
<div class="line">        fResolvedNoiseSamplerName.length() &gt; 0)</div>
<div class="line">    {</div>
<div class="line"> <span class="comment">// Set a point-clamp sampler to the shader</span></div>
<div class="line"> <span class="keywordflow">if</span> (!fNoiseSamplerState)</div>
<div class="line">        {</div>
<div class="line"> <a name="_a20"></a><a class="code" href="./class_m_h_w_render_1_1_m_sampler_state_desc.html">MHWRender::MSamplerStateDesc</a> desc;</div>
<div class="line">            desc.<a name="a21"></a><a class="code" href="./class_m_h_w_render_1_1_m_sampler_state_desc.html#a0280d6ae8821c595d0300d0e65ca5adf">filter</a> = <a name="a22"></a><a class="code" href="./class_m_h_w_render_1_1_m_sampler_state.html#ac4b92e6b8c820ded95490092f8bfff74a52e14aff9dd4572590cdbfe29c0b79a9">MHWRender::MSamplerState::kMinMagMipPoint</a>;</div>
<div class="line">            desc.<a name="a23"></a><a class="code" href="./class_m_h_w_render_1_1_m_sampler_state_desc.html#ac29858bdb9a4bcfb0bc83f6ba10bf77e">addressU</a> = desc.<a name="a24"></a><a class="code" href="./class_m_h_w_render_1_1_m_sampler_state_desc.html#a84050ce870bec08011b645ee249aa845">addressV</a> = desc.<a name="a25"></a><a class="code" href="./class_m_h_w_render_1_1_m_sampler_state_desc.html#a7644f0579397d01aaf922218f129983f">addressW</a> =</div>
<div class="line"> <a name="a26"></a><a class="code" href="./class_m_h_w_render_1_1_m_sampler_state.html#ac06d679b414bf6ad84118e6e9712fd58a6f6620cda8602399b533161e40c15fc3">MHWRender::MSamplerState::kTexClamp</a>;</div>
<div class="line">            desc.<a name="a27"></a><a class="code" href="./class_m_h_w_render_1_1_m_sampler_state_desc.html#a3fac86a5d9783d090e70a4053380dfac">minLOD</a> = 0;</div>
<div class="line">            desc.<a name="a28"></a><a class="code" href="./class_m_h_w_render_1_1_m_sampler_state_desc.html#ad63b1a492e238f91644a11ab2808c416">maxLOD</a> = 0;</div>
<div class="line">            fNoiseSamplerState =</div>
<div class="line"> <a name="a29"></a><a class="code" href="./class_m_h_w_render_1_1_m_state_manager.html#a6277961291d22bd82a852c0b9c905570">MHWRender::MStateManager::acquireSamplerState</a>(desc);</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">if</span> (fNoiseSamplerState)</div>
<div class="line">        {</div>
<div class="line">            shader.<a name="a30"></a><a class="code" href="./class_m_h_w_render_1_1_m_shader_instance.html#aa17e2c9a17b86064950103066fa307ef">setParameter</a>(fResolvedNoiseSamplerName, *fNoiseSamplerState);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Generate the noise lookup table texture if necessary</span></div>
<div class="line"> <span class="keywordflow">if</span> (!fNoiseTexture)</div>
<div class="line">        {</div>
<div class="line"> <a class="code" href="./class_m_h_w_render_1_1_m_renderer.html">MHWRender::MRenderer</a>* renderer =</div>
<div class="line"> <a class="code" href="./class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>();</div>
<div class="line"> <a class="code" href="./class_m_h_w_render_1_1_m_texture_manager.html">MHWRender::MTextureManager</a>* textureMgr =</div>
<div class="line">                renderer ? renderer-&gt;<a class="code" href="./class_m_h_w_render_1_1_m_renderer.html#aa3f2ec2984800e2cd8ea09b4ad9f072e">getTextureManager</a>() : NULL;</div>
<div class="line"> <span class="keywordflow">if</span> (textureMgr)</div>
<div class="line">            {</div>
<div class="line"> <span class="comment">// First, search the texture cache to see if another instance of</span></div>
<div class="line"> <span class="comment">// this override has already generated the texture. We can reuse</span></div>
<div class="line"> <span class="comment">// it to save GPU memory since the noise data is constant.</span></div>
<div class="line">                fNoiseTexture =</div>
<div class="line">                    textureMgr-&gt;<a name="a31"></a><a class="code" href="./class_m_h_w_render_1_1_m_texture_manager.html#a3d56d3a0cf7e5930142ae742b43c64b4">findTexture</a>(sNoiseLookupTextureName);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Not in cache, so we need to actually build the texture</span></div>
<div class="line"> <span class="keywordflow">if</span> (!fNoiseTexture)</div>
<div class="line">                {</div>
<div class="line"> <span class="comment">// Get Maya's noise table</span></div>
<div class="line"> <span class="keyword">const</span> std::vector&lt;float&gt;&amp; noiseData = GetMayaNoiseTable();</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Create a 3D texture containing the data</span></div>
<div class="line"> <a name="_a32"></a><a class="code" href="./class_m_h_w_render_1_1_m_texture_description.html">MHWRender::MTextureDescription</a> desc;</div>
<div class="line">                    desc.<a name="a33"></a><a class="code" href="./class_m_h_w_render_1_1_m_texture_description.html#ad1381bd49c9b737ad9e4755ba31fc9fb">setToDefault2DTexture</a>();</div>
<div class="line">                    desc.<a name="a34"></a><a class="code" href="./class_m_h_w_render_1_1_m_texture_description.html#a2582291699b63f6ddc938c371b54344e">fWidth</a> = desc.<a name="a35"></a><a class="code" href="./class_m_h_w_render_1_1_m_texture_description.html#aa3b84951e55674788c9ae0f404a8ee17">fHeight</a> = desc.<a name="a36"></a><a class="code" href="./class_m_h_w_render_1_1_m_texture_description.html#accfe55705bc42a1e0375259fdfb5ab15">fDepth</a> =</div>
<div class="line"> <a name="a37"></a><a class="code" href="./class_m_render_util.html#a8dff67c019e1716dd29b8cf4af2d8f2c">MRenderUtil::noiseTableCubeSide</a>();</div>
<div class="line">                    desc.<a name="a38"></a><a class="code" href="./class_m_h_w_render_1_1_m_texture_description.html#a970a52e15a6db4682fede9dead7982cc">fFormat</a> = <a name="a39"></a><a class="code" href="./namespace_m_h_w_render.html#ab8dcc38685c6e5601a32fb70764742dcac5f91d2dabc7c279fa150ce28a2e63e4">MHWRender::kR32_FLOAT</a>;</div>
<div class="line">                    desc.<a name="a40"></a><a class="code" href="./class_m_h_w_render_1_1_m_texture_description.html#ad905f7a59df4f73faa690967c4d48bdd">fTextureType</a> = <a name="a41"></a><a class="code" href="./namespace_m_h_w_render.html#aaad5d927ce0bd1ecf45d5ddff4e3e030af7be2aba712cc7bc8b08242599c997ce">MHWRender::kVolumeTexture</a>;</div>
<div class="line">                    desc.<a name="a42"></a><a class="code" href="./class_m_h_w_render_1_1_m_texture_description.html#a943c843873579cb41682ad4befe52a4c">fMipmaps</a> = 1;</div>
<div class="line">                    fNoiseTexture = textureMgr-&gt;<a name="a43"></a><a class="code" href="./class_m_h_w_render_1_1_m_texture_manager.html#a04aa3cfef217948abc8edd0f19565f95">acquireTexture</a>(</div>
<div class="line">                        sNoiseLookupTextureName,</div>
<div class="line">                        desc,</div>
<div class="line">                        (<span class="keyword">const</span> <span class="keywordtype">void</span>*)&amp;(noiseData[0]),</div>
<div class="line"> <span class="keyword">false</span>);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Set the texture to the shader instance</span></div>
<div class="line"> <span class="keywordflow">if</span> (fNoiseTexture)</div>
<div class="line">        {</div>
<div class="line"> <a name="_a44"></a><a class="code" href="./struct_m_h_w_render_1_1_m_texture_assignment.html">MHWRender::MTextureAssignment</a> textureAssignment;</div>
<div class="line">            textureAssignment.<a name="a45"></a>texture = fNoiseTexture;</div>
<div class="line">            shader.<a class="code" href="./class_m_h_w_render_1_1_m_shader_instance.html#aa17e2c9a17b86064950103066fa307ef">setParameter</a>(fResolvedNoiseMapName, textureAssignment);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Static fragment registration/deregistration methods called from plugin</span></div>
<div class="line"><span class="comment">// init/unint functions. Only need to be called once.</span></div>
<div class="line"><a name="_a46"></a><a class="code" href="./class_m_status.html">MStatus</a> simpleNoiseShaderOverride::registerFragments()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Get fragment manager for registration</span></div>
<div class="line"> <a name="_a47"></a><a class="code" href="./class_m_h_w_render_1_1_m_fragment_manager.html">MHWRender::MFragmentManager</a>* fragmentMgr =</div>
<div class="line"> <a class="code" href="./class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>()</div>
<div class="line">            ? <a class="code" href="./class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>()-&gt;<a name="a48"></a><a class="code" href="./class_m_h_w_render_1_1_m_renderer.html#a0f42783e8eee6f472d6bbb2acb6b2f2d">getFragmentManager</a>()</div>
<div class="line">            : NULL;</div>
<div class="line"> <span class="comment">// No fragment manager, fail</span></div>
<div class="line"> <span class="keywordflow">if</span> (!fragmentMgr) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"> <span class="comment">// Fragments are already registered, return success</span></div>
<div class="line"> <span class="keywordflow">if</span> (fragmentMgr-&gt;<a name="a49"></a><a class="code" href="./class_m_h_w_render_1_1_m_fragment_manager.html#af82d71b3a71c8752d51d0a9cb6081877">hasFragment</a>(sFinalFragmentGraphName)) <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> fragmentName;</div>
<div class="line"> <span class="keywordtype">char</span>* fragmentBody = NULL;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// ------------------------------------------------------------------------</span></div>
<div class="line"> <span class="comment">// Struct declaration fragment. This fragment provides the declaration of</span></div>
<div class="line"> <span class="comment">// the output structure of the simple noise fragment graph giving support</span></div>
<div class="line"> <span class="comment">// for multiple outputs. The struct fragment must be a part of the final</span></div>
<div class="line"> <span class="comment">// fragment graph in order to ensure that the fragment system includes</span></div>
<div class="line"> <span class="comment">// the declaration of the struct in the final effect.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">    fragmentName = <span class="stringliteral">"simpleNoiseOutput"</span>;</div>
<div class="line">    fragmentBody =</div>
<div class="line"> <span class="stringliteral">"&lt;fragment uiName=\"simpleNoiseOutput\" name=\"simpleNoiseOutput\" type=\"structure\" class=\"ShadeFragment\" version=\"1.0\"&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;description&gt;&lt;![CDATA[Struct output for simple noise shader]]&gt;&lt;/description&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;properties&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;struct name=\"simpleNoiseOutput\" struct_name=\"simpleNoiseOutput\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/properties&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;values&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/values&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;outputs&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;alias name=\"simpleNoiseOutput\" struct_name=\"simpleNoiseOutput\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float3 name=\"outColor\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"outAlpha\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/outputs&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;implementation&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;implementation render=\"OGSRenderer\" language=\"Cg\" lang_version=\"2.1\"&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;function_name val=\"\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;declaration name=\"simpleNoiseOutput\"&gt;&lt;![CDATA[ \r\n"</span></div>
<div class="line"> <span class="stringliteral">"struct simpleNoiseOutput \r\n"</span></div>
<div class="line"> <span class="stringliteral">"{ \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float3 outColor; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float outAlpha; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"}; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       ]]&gt;&lt;/declaration&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/implementation&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;implementation render=\"OGSRenderer\" language=\"HLSL\" lang_version=\"11.0\"&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;function_name val=\"\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;declaration name=\"simpleNoiseOutput\"&gt;&lt;![CDATA[ \r\n"</span></div>
<div class="line"> <span class="stringliteral">"struct simpleNoiseOutput \r\n"</span></div>
<div class="line"> <span class="stringliteral">"{ \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float3 outColor; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float outAlpha; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"}; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       ]]&gt;&lt;/declaration&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/implementation&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;implementation render=\"OGSRenderer\" language=\"GLSL\" lang_version=\"3.0\"&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;function_name val=\"\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;declaration name=\"simpleNoiseOutput\"&gt;&lt;![CDATA[ \r\n"</span></div>
<div class="line"> <span class="stringliteral">"struct simpleNoiseOutput \r\n"</span></div>
<div class="line"> <span class="stringliteral">"{ \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   vec3 outColor; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float outAlpha; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"}; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       ]]&gt;&lt;/declaration&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/implementation&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/implementation&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"&lt;/fragment&gt; \r\n"</span>;</div>
<div class="line"> <span class="keywordflow">if</span> (fragmentName != fragmentMgr-&gt;<a name="a50"></a><a class="code" href="./class_m_h_w_render_1_1_m_fragment_manager.html#a221c1b902178b12d827dcae51fdca4c8">addShadeFragmentFromBuffer</a>(fragmentBody, <span class="keyword">false</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// ------------------------------------------------------------------------</span></div>
<div class="line"> <span class="comment">// Actual noise computation fragment. Based on Maya's "wave" noise type</span></div>
<div class="line"> <span class="comment">// from the 2d procedural noise texture node. Computes a struct output</span></div>
<div class="line"> <span class="comment">// containing both color and alpha to match the outputs of the DG node.</span></div>
<div class="line"> <span class="comment">// Uses a 3D texture loaded with the entire Maya noise table for generating</span></div>
<div class="line"> <span class="comment">// results consistent with the compute() method of the associated node.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">    fragmentName = <span class="stringliteral">"simpleNoiseBase"</span>;</div>
<div class="line">    fragmentBody =</div>
<div class="line"> <span class="stringliteral">"&lt;fragment uiName=\"simpleNoiseBase\" name=\"simpleNoiseBase\" type=\"plumbing\" class=\"ShadeFragment\" version=\"1.0\"&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;description&gt;&lt;![CDATA[Computes simple 2D procedural noise]]&gt;&lt;/description&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;properties&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float2 name=\"uvCoord\" semantic=\"mayaUvCoordSemantic\" flags=\"varyingInputParam\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;texture3 name=\"noiseLookupMap\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;sampler name=\"noiseLookupMapSampler\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"amplitude\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"ratio\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;int name=\"depthMax\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"frequency\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"frequencyRatio\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"time\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;int name=\"numWaves\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/properties&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;values&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"amplitude\" value=\"1.0\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"ratio\" value=\"0.707000\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;int name=\"depthMax\" value=\"3\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"frequency\" value=\"8.0\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"frequencyRatio\" value=\"2.0\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"time\" value=\"0.0\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;int name=\"numWaves\" value=\"5\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/values&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;outputs&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;struct name=\"simpleNoiseBase\" struct_name=\"simpleNoiseOutput\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/outputs&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;implementation&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;implementation render=\"OGSRenderer\" language=\"Cg\" lang_version=\"2.1\"&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;function_name val=\"simpleNoise\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;source&gt;&lt;![CDATA[ \r\n"</span></div>
<div class="line"> <span class="stringliteral">"float simpleNoise_RawNoiseLookup( \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int index, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   texture3D noiseLookupMap, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   sampler3D noiseLookupMapSampler) \r\n"</span></div>
<div class="line"> <span class="stringliteral">"{ \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int3 index3; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   index3.x = index; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   index3.y = (index&gt;&gt; 5); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   index3.z = (index&gt;&gt; 10); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   index3 &amp;= 31; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float3 uvw = float3(index3) / 32.0f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   return (tex3D(noiseLookupMapSampler, uvw).r * 2.0f) - 1.0f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"} \r\n"</span></div>
<div class="line"> <span class="stringliteral">"simpleNoiseOutput simpleNoise( \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float2 uv, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   texture3D noiseLookupMap, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   sampler3D noiseLookupMapSampler, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float amplitude, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float ratio, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int depthMax, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float frequency, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float frequencyRatio, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float time, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int numWaves) \r\n"</span></div>
<div class="line"> <span class="stringliteral">"{ \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   const float M_PI = 3.1415926535897f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   const float M_2PI = 2.0f*M_PI; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   simpleNoiseOutput finalResult; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float timeRatio = sqrt(frequencyRatio); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   uv *= frequency; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float cosine = 0.0f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float noise = 0.0f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int depthId = 0; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int waveId = 0; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int seedOffset = 0; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   while (depthId&lt;depthMax &amp;&amp; waveId&lt;numWaves) { \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       int step = depthId; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       int seed = 50*step; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       float2 dir = float2( \r\n"</span></div>
<div class="line"> <span class="stringliteral">"           simpleNoise_RawNoiseLookup(seed + seedOffset++, noiseLookupMap, noiseLookupMapSampler), \r\n"</span></div>
<div class="line"> <span class="stringliteral">"           simpleNoise_RawNoiseLookup(seed + seedOffset++, noiseLookupMap, noiseLookupMapSampler)); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       float norm = length(dir); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       if (norm &lt;= 0.0f) continue; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       dir /= norm; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       noise += cos(dir.x*uv.x*M_2PI + dir.y*uv.y*M_2PI + M_PI*simpleNoise_RawNoiseLookup(seed + seedOffset++, noiseLookupMap, noiseLookupMapSampler) + time*M_PI); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       ++waveId; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       if (waveId &lt; numWaves) continue; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       noise /= float(numWaves); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       uv *= frequencyRatio; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       time *= timeRatio; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       cosine += amplitude * noise; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       amplitude *= ratio; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       noise = 0.0f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       waveId = 0; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       seedOffset = 0; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       ++depthId; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   } \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   cosine = 0.5f*cosine + 0.5f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float noiseVal = (cosine&gt; 1.0f) ? 1.0f : cosine; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   finalResult.outColor = float3(noiseVal, noiseVal, noiseVal); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   finalResult.outAlpha = noiseVal; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   return finalResult; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"} \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       ]]&gt;&lt;/source&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/implementation&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;implementation render=\"OGSRenderer\" language=\"HLSL\" lang_version=\"11.0\"&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;function_name val=\"simpleNoise\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;source&gt;&lt;![CDATA[ \r\n"</span></div>
<div class="line"> <span class="stringliteral">"float simpleNoise_RawNoiseLookup( \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int index, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   Texture3D noiseLookupMap, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   sampler noiseLookupMapSampler) \r\n"</span></div>
<div class="line"> <span class="stringliteral">"{ \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int3 index3; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   index3.x = index; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   index3.y = (index&gt;&gt; 5); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   index3.z = (index&gt;&gt; 10); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   index3 &amp;= 31; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float3 uvw = float3(index3) / 32.0f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   return (noiseLookupMap.SampleLevel(noiseLookupMapSampler, uvw, 0).r * 2.0f) - 1.0f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"} \r\n"</span></div>
<div class="line"> <span class="stringliteral">"simpleNoiseOutput simpleNoise( \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float2 uv, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   Texture3D noiseLookupMap, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   sampler noiseLookupMapSampler, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float amplitude, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float ratio, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int depthMax, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float frequency, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float frequencyRatio, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float time, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int numWaves) \r\n"</span></div>
<div class="line"> <span class="stringliteral">"{ \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   const float M_PI = 3.1415926535897f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   const float M_2PI = 2.0f*M_PI; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   simpleNoiseOutput finalResult; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float timeRatio = sqrt(frequencyRatio); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   uv *= frequency; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float cosine = 0.0f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float noise = 0.0f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int depthId = 0; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int waveId = 0; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int seedOffset = 0; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   while (depthId&lt;depthMax &amp;&amp; waveId&lt;numWaves) { \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       int step = depthId; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       int seed = 50*step; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       float2 dir = float2( \r\n"</span></div>
<div class="line"> <span class="stringliteral">"           simpleNoise_RawNoiseLookup(seed + seedOffset++, noiseLookupMap, noiseLookupMapSampler), \r\n"</span></div>
<div class="line"> <span class="stringliteral">"           simpleNoise_RawNoiseLookup(seed + seedOffset++, noiseLookupMap, noiseLookupMapSampler)); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       float norm = length(dir); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       if (norm &lt;= 0.0f) continue; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       dir /= norm; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       noise += cos(dir.x*uv.x*M_2PI + dir.y*uv.y*M_2PI + M_PI*simpleNoise_RawNoiseLookup(seed + seedOffset++, noiseLookupMap, noiseLookupMapSampler) + time*M_PI); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       ++waveId; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       if (waveId &lt; numWaves) continue; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       noise /= float(numWaves); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       uv *= frequencyRatio; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       time *= timeRatio; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       cosine += amplitude * noise; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       amplitude *= ratio; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       noise = 0.0f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       waveId = 0; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       seedOffset = 0; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       ++depthId; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   } \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   cosine = 0.5f*cosine + 0.5f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float noiseVal = (cosine&gt; 1.0f) ? 1.0f : cosine; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   finalResult.outColor = float3(noiseVal, noiseVal, noiseVal); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   finalResult.outAlpha = noiseVal; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   return finalResult; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"} \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       ]]&gt;&lt;/source&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/implementation&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;implementation render=\"OGSRenderer\" language=\"GLSL\" lang_version=\"3.0\"&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;function_name val=\"simpleNoise\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;source&gt;&lt;![CDATA[ \r\n"</span></div>
<div class="line"> <span class="stringliteral">"float simpleNoise_RawNoiseLookup( \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int index, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   sampler3D noiseLookupMapSampler) \r\n"</span></div>
<div class="line"> <span class="stringliteral">"{ \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   ivec3 index3; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   index3.x = index; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   index3.y = (index &gt;&gt; 5); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   index3.z = (index &gt;&gt; 10); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   index3 &amp;= 31; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   vec3 uvw = vec3(index3) / 32.0f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   return (texture(noiseLookupMapSampler, uvw).r * 2.0f) - 1.0f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"} \r\n"</span></div>
<div class="line"> <span class="stringliteral">"simpleNoiseOutput simpleNoise( \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   vec2 uv, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   sampler3D noiseLookupMapSampler, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float amplitude, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float ratio, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int depthMax, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float frequency, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float frequencyRatio, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float time, \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int numWaves) \r\n"</span></div>
<div class="line"> <span class="stringliteral">"{ \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   const float M_PI = 3.1415926535897f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   const float M_2PI = 2.0f*M_PI; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   simpleNoiseOutput finalResult; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float timeRatio = sqrt(frequencyRatio); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   uv *= frequency; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float cosine = 0.0f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float noise = 0.0f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int depthId = 0; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int waveId = 0; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   int seedOffset = 0; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   while (depthId&lt;depthMax &amp;&amp; waveId&lt;numWaves) { \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       int step = depthId; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       int seed = 50*step; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       vec2 dir = vec2( \r\n"</span></div>
<div class="line"> <span class="stringliteral">"           simpleNoise_RawNoiseLookup(seed + seedOffset++, noiseLookupMapSampler), \r\n"</span></div>
<div class="line"> <span class="stringliteral">"           simpleNoise_RawNoiseLookup(seed + seedOffset++, noiseLookupMapSampler)); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       float norm = length(dir); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       if (norm &lt;= 0.0f) continue; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       dir /= norm; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       noise += cos(dir.x*uv.x*M_2PI + dir.y*uv.y*M_2PI + M_PI*simpleNoise_RawNoiseLookup(seed + seedOffset++, noiseLookupMapSampler) + time*M_PI); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       ++waveId; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       if (waveId &lt; numWaves) continue; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       noise /= float(numWaves); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       uv *= frequencyRatio; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       time *= timeRatio; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       cosine += amplitude * noise; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       amplitude *= ratio; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       noise = 0.0f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       waveId = 0; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       seedOffset = 0; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       ++depthId; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   } \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   cosine = 0.5f*cosine + 0.5f; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   float noiseVal = (cosine &gt; 1.0f) ? 1.0f : cosine; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   finalResult.outColor = vec3(noiseVal, noiseVal, noiseVal); \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   finalResult.outAlpha = noiseVal; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   return finalResult; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"} \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       ]]&gt;&lt;/source&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/implementation&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/implementation&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"&lt;/fragment&gt; \r\n"</span>;</div>
<div class="line"> <span class="keywordflow">if</span> (fragmentName != fragmentMgr-&gt;<a class="code" href="./class_m_h_w_render_1_1_m_fragment_manager.html#a221c1b902178b12d827dcae51fdca4c8">addShadeFragmentFromBuffer</a>(fragmentBody, <span class="keyword">false</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// ------------------------------------------------------------------------</span></div>
<div class="line"> <span class="comment">// Full, final graph made up of previously registered fragments. A picture</span></div>
<div class="line"> <span class="comment">// which flows from top to bottom.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="comment">//                         simpleNoiseBase</span></div>
<div class="line"> <span class="comment">//                                |</span></div>
<div class="line"> <span class="comment">//                        simpleNoiseOutput</span></div>
<div class="line"> <span class="comment">//                                |</span></div>
<div class="line"> <span class="comment">//                          &lt;FINAL RESULT&gt;</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="comment">// Maya's shader translation system will take this graph and connect UV</span></div>
<div class="line"> <span class="comment">// information where appropriate.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="comment">// From Maya's point of view, this graph is fully representative of the</span></div>
<div class="line"> <span class="comment">// associated shading node in the DG. All inputs and outputs on this graph</span></div>
<div class="line"> <span class="comment">// are matched to inputs and outputs on the DG node. Connections to other</span></div>
<div class="line"> <span class="comment">// nodes (input or output) will be mirrored by connections to other</span></div>
<div class="line"> <span class="comment">// fragments using the matching parameters.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">    fragmentName = sFinalFragmentGraphName;</div>
<div class="line">    fragmentBody =</div>
<div class="line"> <span class="stringliteral">"&lt;fragment_graph name=\"simpleNoise\" ref=\"simpleNoise\" class=\"FragmentGraph\" version=\"1.0\"&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;fragments&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;fragment_ref name=\"simpleNoiseBase\" ref=\"simpleNoiseBase\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;fragment_ref name=\"simpleNoiseOutput\" ref=\"simpleNoiseOutput\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/fragments&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;connections&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;connect from=\"simpleNoiseBase.simpleNoiseBase\" to=\"simpleNoiseOutput.simpleNoiseOutput\" name=\"simpleNoiseOutput\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/connections&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;properties&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float2 name=\"uvCoord\" ref=\"simpleNoiseBase.uvCoord\" semantic=\"mayaUvCoordSemantic\" flags=\"varyingInputParam\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;texture3 name=\"noiseLookupMap\" ref=\"simpleNoiseBase.noiseLookupMap\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;sampler name=\"noiseLookupMapSampler\" ref=\"simpleNoiseBase.noiseLookupMapSampler\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"amplitude\" ref=\"simpleNoiseBase.amplitude\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"ratio\" ref=\"simpleNoiseBase.ratio\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;int name=\"depthMax\" ref=\"simpleNoiseBase.depthMax\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"frequency\" ref=\"simpleNoiseBase.frequency\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"frequencyRatio\" ref=\"simpleNoiseBase.frequencyRatio\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"time\" ref=\"simpleNoiseBase.time\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;int name=\"numWaves\" ref=\"simpleNoiseBase.numWaves\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/properties&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;values&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"amplitude\" value=\"1.0\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"ratio\" value=\"0.707000\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;int name=\"depthMax\" value=\"3\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"frequency\" value=\"8.0\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"frequencyRatio\" value=\"2.0\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;float name=\"time\" value=\"0.0\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;int name=\"numWaves\" value=\"5\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/values&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;outputs&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"       &lt;struct name=\"simpleNoiseOutput\" ref=\"simpleNoiseOutput.simpleNoiseOutput\" /&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"   &lt;/outputs&gt; \r\n"</span></div>
<div class="line"> <span class="stringliteral">"&lt;/fragment_graph&gt; \r\n"</span>;</div>
<div class="line"> <span class="keywordflow">if</span> (fragmentName != fragmentMgr-&gt;<a name="a51"></a><a class="code" href="./class_m_h_w_render_1_1_m_fragment_manager.html#a2264caab6f1d9736fe2e7ccc195e8340">addFragmentGraphFromBuffer</a>(fragmentBody)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> simpleNoiseShaderOverride::deregisterFragments()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Get fragment manager for deregistration</span></div>
<div class="line"> <a class="code" href="./class_m_h_w_render_1_1_m_fragment_manager.html">MHWRender::MFragmentManager</a>* fragmentMgr =</div>
<div class="line"> <a class="code" href="./class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>()</div>
<div class="line">            ? <a class="code" href="./class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>()-&gt;<a class="code" href="./class_m_h_w_render_1_1_m_renderer.html#a0f42783e8eee6f472d6bbb2acb6b2f2d">getFragmentManager</a>()</div>
<div class="line">            : NULL;</div>
<div class="line"> <span class="comment">// No fragment manager, fail</span></div>
<div class="line"> <span class="keywordflow">if</span> (!fragmentMgr) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Remove fragments from library on plugin unload</span></div>
<div class="line"> <span class="keywordflow">if</span> (!fragmentMgr-&gt;<a name="a52"></a><a class="code" href="./class_m_h_w_render_1_1_m_fragment_manager.html#a0986b6896f4fad94fc61ff750583187f">removeFragment</a>(<span class="stringliteral">"simpleNoiseOutput"</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"> <span class="keywordflow">if</span> (!fragmentMgr-&gt;<a class="code" href="./class_m_h_w_render_1_1_m_fragment_manager.html#a0986b6896f4fad94fc61ff750583187f">removeFragment</a>(<span class="stringliteral">"simpleNoiseBase"</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"> <span class="keywordflow">if</span> (!fragmentMgr-&gt;<a class="code" href="./class_m_h_w_render_1_1_m_fragment_manager.html#a0986b6896f4fad94fc61ff750583187f">removeFragment</a>(sFinalFragmentGraphName)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div class="footer-block"><a class="comments-anchor" href="../html/ac.cmtdialog.htm" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
</div></body>
</html>
